var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&s(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&s(e,a,t[a]);return e},o=(e,n)=>t(e,a(n)),c=(e,t)=>{var a={};for(var s in e)l.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&n)for(var s of n(e))t.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a};import{i as m,a as u,e as d,b as p,u as E,c as h,d as g,f as v,r as f,R as y,M as x,L as k,D as b,S as C,A as N,U as S,B as w,g as _,h as I,F as $,j as P,I as F,k as O,l as T,m as D,n as L,o as q,p as R,q as V,s as G,T as A,t as M,C as U,v as H,E as B,w as K,x as j,y as z,z as Y,G as J,H as W,J as Q,K as X,P as Z,N as ee,O as te,Q as ae,V as ne,W as le,X as re,Y as se,Z as ie,_ as oe,$ as ce,a0 as me,a1 as ue,a2 as de,a3 as pe,a4 as Ee,a5 as he,a6 as ge,a7 as ve,a8 as fe,a9 as ye,aa as xe,ab as ke,ac as be,ad as Ce,ae as Ne,af as Se,ag as we,ah as _e,ai as Ie,aj as $e,ak as Pe,al as Fe,am as Oe,an as Te,ao as De,ap as Le,aq as qe,ar as Re,as as Ve,at as Ge,au as Ae,av as Me,aw as Ue,ax as He,ay as Be,az as Ke,aA as je,aB as ze,aC as Ye,aD as Je,aE as We,aF as Qe,aG as Xe,aH as Ze,aI as et,aJ as tt,aK as at,aL as nt,aM as lt,aN as rt,aO as st,aP as it,aQ as ot,aR as ct,aS as mt,aT as ut}from"./vendor.83f93ba9.js";const dt={en:{translation:{classpath:{single:"Classpath"},strategy:{create:"New",single:"Alert Rule",multiple:"Alert Rules"},personalInfo:"Profile",n9e:"DiDi Nightingale","输入有误":"Incorrect input","修改密码成功":"Changed the password successfully","旧密码":"Old password","请输入旧密码":"Enter the old password","新密码":"New password","请输入新密码":"Enter a new password","再次输入新密码":"Enter a new password again","确认修改":"Update","自定义头像需以http开头":"The custom portrait needs to start at http","自定义头像":"Custom portrait","信息保存成功":"Saved successfully","用户名":"Username","显示名":"Display name","请输入显示名":"Enter a display name","邮箱":"Email","请输入邮箱":"Enter email","手机":"Mobile","请输入手机号":"Enter mobile number","请输入":"Enter ","更多联系方式":"More contacts","联系方式不能为空":"Contact information can not be blank","请选择联系方式":"Select contact","值不能为空":"Value can not be blank","请输入值":"Enter value","更换头像":"Change portrait","头像URL":"Portrait URL","个人中心":"Personal Center","个人信息":"Setting","修改密码":"Change password","秘钥管理":"Token management","Token更新成功":"Token updated successfully","Token创建成功":"Token created successfully","操作":"Action","重新生成":"Regenerate","生成":"Generate","该分享链接无图表数据":"The shared link has no graph data.","任意标签/资源分组":"Any Label / Classpath","必须要有一个变量名":"Var name required","变量名重复":"Duplicate variable name","变量名包含非法字符":"The variable name contains illegal characters","资源分组路径含有非法字符":"The Classpath contains illegal characters","变量名":"Variable name","标签或资源分组":"Label or Classpath","默认值":"Default value","添加大盘变量":"Add dashboard variables","添加变量":"Add variable","完成":"Finish","新建图表":"New chart","标题":"Title","图表名称":"Name required","配置方式":"Mode","指标":"Metrics","请选择指标":"Select metrics","请输入监控指标(输入4个以上字符发起检索)":"Enter a metric(search after 4 char)","资源分组":"Classpaths","请选择资源分组":"Select classpath","前缀匹配":"Prefix","请输入Promql":"Enter PromQL","阈值":"Threshold","下钻链接":"Drill URL","列":" Column","新增图表":"New Chart","一键规整":"Arrange","修改":"Edit","上移":"Move up","下移":"Move down","是否删除分类":"Delete group","删除":"Delete","编辑图表":"Edit Chart","是否删除图表":"Delete the chart","删除图表":"Delete","删除分组成功":"Group deleted successfully","新增图表分组":"New Chart Group","新建分组":"New Chart Group","更新分组名称":"Edit group name","分组名称":"Name","请输入名称":"Please enter the name","克隆大盘成功":"Cloned successfully","新建大盘成功":"Created successfully","大盘名称":"Name","分类标签":"Tags","更新时间":"Update Time","发布人":"Publisher","克隆":"Clone","是否删除大盘":"Sure to delete the dashboard?","删除大盘成功":"Deleted successfully","您的网络发生异常，无法连接服务器":"Cannot connect to the server, retry later please","导入":"Import","未选择任何大盘":"No dashboard chosen","导出":"Export","监控大盘":"Dashboards","新建大盘":"New Dashboard","导入内置大盘":"Import built-in dashboard","更多操作":"More","克隆监控大盘":"Clone dashboard","创建新监控大盘":"New Dashboard","请输入大盘名称":"Enter dashboard name","大盘":"Dashboard","时间":"Time","值":"Value","告警详情":"Event Detail","策略名称:":"Rule name","通知结果":"Notice","已触发":"Triggered","已屏蔽":"Muted","表达式":"Expression","级别":"Level","策略名称":"Rule name","标签":"Tags","通知":"Notification","状态":"Status","发生时间":"When","屏蔽":"Mute","是否忽略告警?":"Sure to ignore the event?","忽略":"Ignore","未恢复告警事件":"Triggered Events","策略名称、标签、资源分组":"Rule name, tag, classpath","告警级别":"Level","告警状态":"Status","是否批量忽略告警?":"Sure to ignore the events?","已忽略告警":"Ignored successfully","批量忽略":"Batch Ignore","滴滴夜莺":"N9E","请输入用户名":"Enter a username","请输入密码":"Enter a password","登录":"Sign in","已选择":"Selected ","项":"","用户名、邮箱或电话":"User name, email or phone number","用户创建成功":"User created successfully","用户信息修改成功":"User Modified","团队创建成功":"Team created successfully","团队信息修改成功":"Team updated successfully","密码重置成功":"Password reset successfully","添加成功":"Added successfully","取消":"Cancel","确认":"Confirm","确认并搜索":"Confirm and search","用户删除成功":"User deleted successfully","团队删除成功":"Team deleted successfully","创建团队":"New Team","成员删除成功":"Deleted member successfully","确定":"OK","确定要删除么？":"Sure to delete it?","密码":"Password","请输入密码!":"Please enter the password!","确认密码":"Confirm password","请确认密码!":"Please confirm the password!","团队名称":"Team Name","团队名称不能为空！":"Team name can not be blank!","备注":"Remark","管理员":"Administrator","普通用户":"Ordinary users","游客":"Visitors","用户名不能为空！":"User name can not be blank!","角色":"Role","角色不能为空！":"Role is required","启用":"Enable","编辑":"Edit","重置密码":"Reset Password","是否删除该用户":"Sure to delete the user?","是否删除该成员":"Sure to delete the member?","禁用成功":"Disabled successfully","启用成功":"Enabled successfully","用户管理":"Users","用户名、邮箱或手机":"User name, email or mobile phone","创建":"Create","创建并关闭":"Create and close","创建用户":"Create User","团队管理":"Team Management","搜索团队名称":"Team name","是否删除该团队":"Sure to delete the team?","成员名、邮箱或手机":"Name, email or mobile","添加成员":"Add Member","选择监控指标添加图表":"Select the metric to add the chart","即时看图":"Explorer","监控指标":"Metric","筛选标签":"Tags","配置":"Configuration","每张图最多展示":"Maximum","条线":"lines per chart","重置":"Reset","分享图表":"Share","资源标识":"Resource ID","资源名称":"Name","资源信息或标签":"Resource information or labels","请选择标签":"Select a tag","删除指标成功":"Deleted successfully","创建指标成功":"Created successfully","请勾选需要导出的指标":"Please check the metrics you need to export","编辑成功":"Edit successfully","指标名称":"Metric","释义":"Description","确定删除该指标?":"Sure to delete this metric?","保存":"Save","指标释义":"Summary","指标名称或释义":"Search","不能为空":"Cannot be blank","已发送":"Sent","近":"Near","day-events":"Day Events","天未恢复的":"Days Events","进入事件管理":"Go to events page","一分钟自动刷新":"One minute refresh","指标TOP":"Metric TOP","个":"","资源总量":"Resources","策略总量":"Rules","大盘总量":"Dashboards","用户总量":"Users","团队总量":"Teams","统计数据":"Statistics","导入规则":"Import Rules","导出规则":"Export rules","请输入导入信息":"Please input import json","是否确定删除资源分组?":"Sure to delete classpath?","分组名称前缀匹配(聚合展示所有相关分组的内容)":"Prefix matching (aggregation displays all relevant grouping content)","count(对符合规则的日志进行计数)":"count(count the matching lines)","histogram(对符合规则的日志抓取出的数字计算统计值)":"histogram","秒":"s","不符合输入规范（格式为key=value）":"format should be 'key=value'","资源":"Resources","看图":"Explorer","端口":"Port","进程":"Process","插件":"Plugin","日志":"Log","端口号":"Port","进程标识":"Process identification","日志路径":"Log path","采集名称":"Collect rule","采集频率":"Step","修改人":"Modifier","修改时间":"Last update","是否删除该采集策略?":"Sure to delete this collection rule?","是否删除该告警规则?":"Sure to delete this alert rule?","删除成功":"Deleted successfully","挂载资源":"Bind Resources","请输入资源标识":"Input resource identifications, one resource per line","请输入资源标识，每行一个":"Input resource identifications, one resource per line","新建资源分组":"New","编辑资源分组":"Edit classpath","刷新":"Refresh","资源分组路径":"Classpath","资源分组路径必填":"Classpath cannot be blank","请填写资源分组路径":"Input classpath","资源分组备注":"Remark","创建进程采集":"New collection","进程采集详情":"Collection rule(Process)","更新":"Update","采集规则成功":" collection rule successfully","进程监控指标":"Metric","所属资源分组":"Classpath","资源分组必填":"Classpath is required","采集名称必填":"Rule name required","请输入采集配置的名称":"Please enter rule name","采集方式":"Method","采集方式必填":"Collection mode is required","命令行":"cmdline","进程名":"name","该项必填":"Required","取 /proc/$pid/cmdline 中的部分子串，可以唯一标识进程即可":"Take some substrings from /proc/$pid/cmdline to uniquely identify the process","取  /proc/$pid/status 中 name 的值":"Take the value of name in /proc/$pid/status","采集频率必填":"Step required","附加标签":"Append tags","格式为key=value回车分隔":"The format is key=value, use Enter to separate","创建端口采集":"New collection","端口采集详情":"Collection rule(Port)","端口监控指标":"Metric","端口协议":"Port Protocol","端口协议必填":"Port protocol required","端口号必填":"Port required","请输入端口号":"Enter port","连接超时":"Connection timeout","连接超时必填":"Connection timeout required","创建插件采集":"New Collection","插件采集详情":"Collection rule(Plugin)","插件采集成功":" collection successfully ","插件路径":"Plugin filepath","插件路径必填":"Plugin filepath required","参数":"Parameters","请输入参数":"Enter parameters","环境变量":"Env variables","变量":"Variable","标准输入(Stdin)":"Standard input (Stdin)","创建日志采集":"New collection","日志采集详情":"Collection rule(Log)","指标名称必填":"Metric required","计算方法":"Calculation method","计算方法必填":"Calculation method required","日志路径必填":"Log path required","匹配正则":"Main regexp","匹配正则必填":"Main regexp required","请输入正则表达式匹配日志关键字，histogram会提取第一个括号内的值":"Enter regexp to match logs, histogram will use first substring value","耗时计算：中的数值会用于计算曲线值流量计数：每匹配到该正则，曲线值+1":"Time-consuming calculation: the values in the calculation are used to calculate the number of curved-value flowmeters: for each match to the regular, the curves are + 1","tagName 填写说明\\r\\n\n              1. 不允许包含host、trigger、include\n              2. 不允许包含如下4个特殊字符\n              tagValue 填写说明\n              1.必须包含括号。括号中的正则内容被用作tagValue的取值，必须可枚举。\n              2.不允许包含如下4个特殊字符=,:@":"TagName  Fill in the instructions \n              1.  No host, no, no, no, no. \n              2.  Not allowed to include the following 4 special characters \n              tagValue  Fill in instructions \n              1. Must contain parentheses. The regular content in parentheses is used as a value for tagValue, and must be enumerated. \n              2. The following 4 special characters are not allowed =,: @","验证":"Verify","请输入一行待监控的完整日志":"Enter a full line of logs to be monitored","通过":"Success","失败":"Failure","屏蔽时间":"Mute time","选择时间":"Choose times","克隆到其他资源分组":"Cloning to other classpath","选择资源分组":"Select classpaths","克隆成功":"Cloned successfully","分组不可为空":"Group can not be blank","是否确认永久删除资源":"Sure to delete the resource ?","无":"None","资源详情":"Basic Information","请选择所属资源分组":"Select the classpaths","彻底删除资源":"Delete","两种情况会有彻底删除资源的需求":"There are two cases to delete resources","资源对应的设备已经下线了，永远都不会有新的监控数据上报了":"The resource has been offline","资源的ident(唯一标识)发生变化，老的ident需要手工清理掉":"The ident of the resource changes","未选择任何规则":"No rules chosen","是否批量删除规则?":"Sure to delete the rules?","组件采集信息":"Component Collection","端口信息":"Port","复制已选项":"Copied successfully","复制":"Copied ","条数据到剪贴板":" records","请先选择资源标识":"Select the resource logo first","是否移除该资源?":"Remove this resource from the classpath?","移除":"Unbind","您未选用任何资源":"No resources chosen","资源管理":"Resources","周期内所有点":"all","在统计周期 $n 秒内（初次上报的指标，统计周期内只有一个值，如要限制点数，可选择happen函数）每个值都 $v":"All the values $v in $n seconds (To limit the number of points, use the happen function)","发生次数":"happen","统计周期 $n 秒内至少有 $m 次值 $v":"There are at least $m times in $n seconds with the value $v","最大值":"max","统计周期 $n 秒内的最大值 $v":"The maximum value $v in $n seconds","最小值":"min","统计周期 $n 秒内的最小值 $v":"The minimum value $v in $n seconds","均值":"avg","统计周期 $n 秒内的均值 $v":"The average value $v in $n seconds","求和":"sum","统计周期 $n 秒内的所有值求和 $v":"The sum value $v in $n seconds","突增突降值":"diff","最新值与其之前 $n 秒内的任意值之差 (区分正负) $v":"(the difference between the latest value and any previous value of $n seconds) divided by the corresponding historical value (positive and negative) $v %","突增突降率":"pdiff","(最新值与其之前 $n 秒的任意值之差)除以对应历史值 (区分正负) $v ％":"(Latest value before  $n  The difference between any value of the second (divided by the corresponding historical value)  (distinguishing between positive and negative)  $v  %","同比变化率":"c_avg_rate_abs","最近 $n 秒平均值相对 $m 天前同周期平均值变化率 $v ％":"The change rate of last $n seconds average relative to $m days average in the same period $v %","同比变化率(区分正负)":"c_avg_rate","同比变化值":"c_avg_abs","最近 $n 秒平均值相对 $m 天前同周期平均值变化值 $v":"The change value of last $n seconds average relative to $m days average in the same period $v","同比变化值(区分正负)":"c_avg","3-sigma离群点检测":"stddev","统计周期 $n 秒内波动值过大，超过了 $m 个标准差范围":"The statistical period fluctuates too much in $n seconds, exceeding $m standard deviation range","新建告警屏蔽":"New mute rule","告警屏蔽":"Mute Rules","请检查":"Please check ","中的空格":" space","新建告警屏蔽成功":"Mute rule created successfully","屏蔽指标":"Mute metric","请输入指标名称":"Input metric","请输入资源标识的正则表达式":"Input a regexp for the resource identification","屏蔽标签":"Mute tags","请输入屏蔽标签(请用回车分割)":"Input mute tags (use Enter to split)","屏蔽原因":"Mute Cause","请填写屏蔽原因":"Enter mute cause","屏蔽标识、资源标识、屏蔽标签不能同时为空":"The metric, ID, tags coult not be empty at the same time","暂无":"None","告警策略详情":"Alert Strategy Details","解除成功":"Removed successfully","开始:":"Start:","结束:":"End:","创建人":"Creator","确定解除该告警屏蔽?":"Sure to remove the mute rule?","解除":"Remove","屏蔽策略":"Mute Rules","指标名称、资源标识、标签、屏蔽原因":"Metric, resource id, tag, mute cause","是否确定删除该策略分组?":"Sure to delete the alert group?","名称":"Name","告警接收者":"Recipients","未选择任何采集策略":"No rules selected","是否批量删除告警规则?":"Sure to delete the alert rules?","请输入告警策略名称":"Search rule name","新建告警策略":"New alert rule","导入内置策略":"Import built-in rules","策略":" rules","请输入标签key":"Enter the tag key","请输入标签value":"Enter the tag value","预览":"Preview","请输入指标":"Enter metric","请输入百分比":"Enter percentages","新建策略分组":"New rule group","新建子节点":"New child node","编辑策略组":"Edit rule Group","策略组名称":"Name","策略组名称必填":"Group name required","请填写策略组名称":"Please enter group name","管理团队":"Manage teams","请选择团队":"Select teams","告警策略":"Alert Rules","请输入分钟数":"Enter minutes","秒（告警恢复后持续观察":"Seconds (continued observation after alarm recovery)","秒，未再触发阈值才发送恢复通知）":"Seconds, no more trigger threshold to send recovery notice)","保存成功":"Successfully saved","创建成功":"Created successfully","克隆失败":"Cloning failed","保存失败":"Unable to save","创建失败":"Failed to create","周一":"Monday","周二":"Tuesday","周三":"Wednesday","周四":"Thursday","周五":"Friday","周六":"Saturday","周日":"Sunday","基本配置":"Basic configuration","策略名称不能为空":"Rule name required","请输入策略名称":"Enter the rule name","一级报警":"Level 1","二级报警":"Level 2","三级报警":"Level 3","触发模式":"Trigger mode","统计周期":"Step","触发条件":"Condition","资源过滤":"Resource filter","标签过滤":"Tag filter","执行频率":"Exec interval","请输入Promeql":"Enter Promeql","请输入附加标签，格式为key=value":"Enter an additional tag in a key=value format","生效配置":"Enable configuration","立即启用":"Enable","是":"Yes","否":"No","生效时间":"Time","通知配置":"Notification configuration","静默恢复":"Silent recovery","不发送恢复通知":"Do not send a recovery notice","通知媒介":"Media","报警接收团队":"Notify teams","报警接收人":"Notify users","报警回调":"Callback","通知自己开发的系统（请确认是夜莺服务端可访问的地址）":"Notify your system (make sure n9e-server could access the address)","其他配置":"Other configuration","预案链接":"Runbook","监控看图":"Metrics","策略配置":"Monitors","未恢复告警":"Unrecovered","用户":"Users","团队":"Teams","团队列表":"Team list","新建团队":"New","退出":"Logout","收藏的":"Favorite ","分组":"","所有":"All ","一行一个":"One per line","策略分组":"Rule Groups","新建":"New ","请输入日志路径，支持*通配符":"Please enter logs filepath, support wildcards","1小时":"1 hour","2小时":"2 hours","6小时":"6 hours","12小时":"12 hours","1天":"1 day","2天":"2 days","7天":"1 week","14天":"2 weeks","30天":"30 days","90天":"90 days","永久":"forever","清除":"clear","预览图":"Preview Chart","批量删除":"Delete","修改告警接受者":"Update recipients","修改通知媒介":"Update medias","策略启用控制":"Update status","是否启停":"Enable","修改附加标签":"Update append tags","修改附加标签成功":"Update append tags successfully",append_tags:"Tags","请先选择策略":"Select some rules","不符合输入规范(格式为key=value)":" format should be 'key=value'","编辑用户信息":"Edit user","编辑团队信息":"Edit team","基本信息":"Basic info","预案手册":"Runbook","预警值":"Threshold","维护备注":"Update remark","维护标签":"Update tags","修改备注":"Update remark","修改标签":"Update tags","暂无数据":"None","告警历史":"All Events","全部告警":"All","全量告警历史":"History Alert Events","恢复":"Recovery","告警":"Alert","key, value必填":"key,value required","key重复":"Duplicate key"}},zh:{translation:{"新建资源分组":"新建资源分组","端口号":"端口号",classpath:{single:"资源分组"},append_tags:"修改附加标签",strategy:{create:"新建策略分组",single:"告警策略",multiple:"告警策略"},personalInfo:"个人信息","day-events":"天未恢复的",n9e:"滴滴夜莺","周期内所有点":"周期内所有点 - all","发生次数":"发生次数 - happen","最大值":"最大值 - max","最小值":"最小值 - min","均值":"均值 - avg","求和":"求和 - sum","突增突降值":"突增突降值 - diff","突增突降率":"突增突降率 - pdiff","同比变化率":"同比变化率 - c_avg_rate_abs","同比变化率(区分正负)":"同比变化率(区分正负) - c_avg_rate","同比变化值":"同比变化值 - c_avg_abs","同比变化值(区分正负)":"同比变化值(区分正负) - c_avg","3-sigma离群点检测":"3-sigma离群点检测 - stddev"}}};m.use(u).init({resources:dt,lng:localStorage.getItem("language")||"zh",interpolation:{escapeValue:!1}});var pt,Et;(Et=pt||(pt={})).HttpError="HttpError",Et.InterfaceError="InterfaceError";class ht extends Error{constructor(e,t){super(e),this.message=e,this.data=t,this.name=pt.InterfaceError}}const gt={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},vt=d({errorHandler:e=>{const{response:t}=e;if(t&&t.status){const e=t.status in gt&&gt[t.status]||t.statusText,{status:a,url:n}=t;p.error({message:`请求错误${a}${n}`,description:e})}else if(!t){const{data:t}=e;p.error({message:(null==t?void 0:t.err)||"您的网络发生异常，无法连接服务器"})}throw new Error},credentials:"include"});var ft,yt,xt,kt,bt,Ct;vt.interceptors.request.use(((e,t)=>{let a=i({},t.headers);return window.location.pathname.startsWith("/chart/")||(a["X-CSRF-TOKEN"]=localStorage.getItem("csrfToken")||""),{url:e,options:o(i({},t),{headers:a})}})),vt.interceptors.response.use((e=>{const{status:t,statusText:a}=e;if(200===t)return e.clone().json().then((e=>{if(""===e.err)return e.dat&&"[object Null]"===Object.prototype.toString.call(e.dat.list)&&(e.dat.list=[]),o(i({},e),{success:!0});throw new ht(e.err,e)}));if(401!==t&&452!==t||(location.href="/login"+("/"!=location.pathname?"?redirect="+location.pathname:"")),404===t)return e.clone().json().then((e=>{p.error({message:(null==e?void 0:e.err)||"您的网络发生异常，无法连接服务器"})}));throw new Error}),{global:!1}),(yt=ft||(ft={})).Get="Get",yt.Post="Post",yt.Put="Put",yt.Delete="Delete",(kt=xt||(xt={}))[kt.Add=0]="Add",kt[kt.Delete=1]="Delete",(Ct=bt||(bt={}))[Ct.Favorite=0]="Favorite",Ct[Ct.Common=1]="Common";const Nt=((e,t)=>{switch(t){case"dev":return e.DEV;case"development":return e.TEST;case"production":return e.PRODUCTION;default:return e.TEST||e.DEV}})({DEV:"http://10.86.76.13:8085",TEST:"http://localhost:8765",PRODUCTION:""},"production"),St=function(e,t){return vt(`${Nt}/api/n9e/auth/login`,{method:ft.Post,data:{username:e,password:t}})},wt=function(){return vt(`${Nt}/api/n9e/csrf`,{method:ft.Get})},_t=function(){return vt(`${Nt}/api/n9e/auth/logout`,{method:ft.Get})},{SubMenu:It}=x,$t=()=>{const{t:e,i18n:t}=E();h((e=>e.account));const a=g(),n=v(),[l,r]=f.exports.useState(!1);return"/login"===n.pathname||n.pathname.startsWith("/chart/")?null:y.createElement("div",{style:{display:"flex",flexDirection:"column"}},y.createElement("div",{className:"home "+(l?"collapse":"")},y.createElement("div",{className:"name",onClick:()=>a.push("/overview"),key:"overview"},y.createElement("img",{src:l?"/image/logo.svg":"/image/logo-l.svg",alt:"",className:"logo"}))),y.createElement(x,{theme:"dark",inlineCollapsed:l,onClick:({key:e})=>{if("logout"===e&&_t().then((e=>{a.push("/login")})),"changeLanguage"===e){let e="en"==t.language?"zh":"en";t.changeLanguage(e),localStorage.setItem("language",e)}e.startsWith("/")&&a.push(e)},mode:"inline"},y.createElement(It,{key:"1",icon:y.createElement(k,null),title:e("监控看图")},y.createElement(x.Item,{key:"/metric/explorer"},e("即时看图")),y.createElement(x.Item,{key:"/dashboard"},e("监控大盘")),y.createElement(x.Item,{key:"/indicator"},e("指标释义"))),y.createElement(x.Item,{key:"/resource",icon:y.createElement(b,null)},e("资源管理")),y.createElement(It,{icon:y.createElement(C,null),title:e("策略配置")},y.createElement(x.Item,{key:"/strategy"},e("告警策略")),y.createElement(x.Item,{key:"/shield"},e("屏蔽策略"))),y.createElement(It,{icon:y.createElement(N,null),title:e("告警历史")},y.createElement(x.Item,{key:"/event"},e("未恢复告警")),y.createElement(x.Item,{key:"/history-events"},e("全部告警"))),y.createElement(It,{icon:y.createElement(S,null),title:e("用户管理")},y.createElement(x.Item,{key:"/manage/user"},e("用户")),y.createElement(x.Item,{key:"/manage/group"},e("团队")))),y.createElement(w,{type:"text",onClick:()=>{r(!l)},className:"collapseBtn"},y.createElement(l?_:I)))};function Pt(){const{t:e}=E(),[t]=$.useForm(),a=g(),n=v(),l=n.search&&new URLSearchParams(n.search).get("redirect"),r=P(),s=async()=>{try{await t.validateFields(),i()}catch{console.log(e("输入有误"))}},i=async()=>{let{username:e,password:n}=t.getFieldsValue();await r({type:"account/login",username:e,password:n})||a.push(l||"/overview")};return y.createElement("div",{className:"login-warp"},y.createElement("div",{className:"banner"},y.createElement("div",{className:"banner-bg"},y.createElement("img",{src:"/image/logo-l.svg",className:"logo",width:"132"}))),y.createElement("div",{className:"login-panel"},y.createElement("div",{className:"login-main"},y.createElement("div",{className:"login-title"},"Nightingale"),y.createElement($,{form:t,layout:"vertical",requiredMark:!0},y.createElement($.Item,{required:!0,name:"username",rules:[{required:!0,message:e("请输入用户名")}]},y.createElement(F,{placeholder:e("请输入用户名"),prefix:y.createElement(S,{className:"site-form-item-icon"})})),y.createElement($.Item,{required:!0,name:"password",rules:[{required:!0,message:e("请输入密码")}]},y.createElement(F,{type:"password",placeholder:e("请输入密码"),onPressEnter:s,prefix:y.createElement(O,{className:"site-form-item-icon"})})),y.createElement($.Item,null,y.createElement(w,{type:"primary",onClick:s},e("登录")))))))}const Ft=({icon:e,title:t,rightArea:a,children:n,customArea:l,showBack:r})=>{const{t:s,i18n:i}=E(),o=g();let{profile:c}=h((e=>e.account));const m=y.createElement(x,null,y.createElement(x.Item,{onClick:()=>{o.push("/account/profile/info")}},s("个人信息")),y.createElement(x.Item,{onClick:()=>{_t().then((e=>{o.push("/login")}))}},s("退出")));return y.createElement("div",{className:"page-wrapper"},l?y.createElement("div",{className:"page-top-header"},l):y.createElement("div",{className:"page-top-header"},y.createElement("div",{className:"page-header-content"},y.createElement("div",{className:"page-header-title"},r&&y.createElement(T,{onClick:()=>window.history.back(),style:{marginRight:"5px"}}),e,t),y.createElement("div",{className:"page-header-right-area"},y.createElement("span",{className:"language",onClick:()=>{let e="en"==i.language?"zh":"en";i.changeLanguage(e),localStorage.setItem("language",e)}},"zh"==i.language?"En":"中"),y.createElement(D,{overlay:m,trigger:["click"]},y.createElement("span",{className:"avator"},y.createElement("img",{src:c.portrait||"/image/avatar1.png",alt:""}),y.createElement("span",{className:"display-name"},c.nickname||c.username),y.createElement(L,null)))))),n&&n)},Ot=e=>{var t=e,{onSearch:a}=t,n=c(t,["onSearch"]);E();const[l,r]=f.exports.useState("");return y.createElement(F,i({prefix:y.createElement(q,null),value:l,onChange:e=>{r(e.target.value),""===e.target.value&&a&&a("")},onPressEnter:e=>{a&&a(l)}},n))};class Tt extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return console.log(e,"error"),{hasError:!0}}componentDidCatch(e,t){console.log(e,t)}render(){return this.state.hasError?null:this.props.children}}const Dt=["pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"],Lt=["red","orange","blue"],qt=[{num:5,unit:"Minutes",shortUnit:"m"},{num:15,unit:"Minutes",shortUnit:"m"},{num:30,unit:"Minutes",shortUnit:"m"},{num:1,unit:"Hour",shortUnit:"h"},{num:2,unit:"Hours",shortUnit:"h"},{num:6,unit:"Hours",shortUnit:"h"},{num:12,unit:"Hours",shortUnit:"h"},{num:1,unit:"Day",shortUnit:"d"},{num:1,unit:"Week",shortUnit:"w"},{num:1,unit:"Month",shortUnit:"M"}],Rt=e=>!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then,Vt=function(e,t="download.txt"){const a=document.createElement("a"),n=new Blob([Array.isArray(e)?e.join("\r\n"):e],{type:"text/plain"});a.href=URL.createObjectURL(n),a.download=t,document.body.appendChild(a),a.click()},Gt=(e,t)=>{const a=document.createElement("textarea");a.style.border="0",a.style.padding="0",a.style.margin="0",a.style.position="absolute",a.style.left="-9999px";const n=window.pageYOffset||document.documentElement.scrollTop;let l;a.style.top=`${n}px`,a.setAttribute("readonly",""),a.value=e,document.body.appendChild(a),a.select();try{l=document.execCommand("copy"),e.includes("\n")?R.success(`${t("复制")}${e.split("\n").length}${t("条数据到剪贴板")}`):R.success(t("复制到剪贴板"))}catch(r){R.error(t("复制失败")),l=!1}return l&&document.body.removeChild(a),l};var At=y.forwardRef((function(e,t){const{t:a}=E(),[n,l]=f.exports.useState(!1),r=t=>{e.noModal||l(!0)};f.exports.useEffect((()=>{void 0!==e.isClose&&e.isClose&&(l(!1),e.setParentClose&&e.setParentClose(!1))}));const s=()=>{if(e.handleOk){const t=e.handleOk();Rt(t)?t.then((e=>{e&&l(!1)})):l(!1)}},c=()=>{l(!1),e.handleCancel&&e.handleCancel()};return f.exports.useImperativeHandle(t,(()=>({showModal:r,handleCancel:c}))),y.createElement(y.Fragment,null,e.customizeButton?y.createElement("span",{onClick:r},e.customizeButton):e.menuButton?y.createElement("li",{className:"ant-dropdown-menu-item",onClick:r},e.menuButton):y.createElement(w,i({onClick:r,type:"primary"},e.buttonProps),e.buttonName),y.createElement(V,o(i({destroyOnClose:!0,maskClosable:!1,title:e.modalName,visible:n,zIndex:1001,onOk:e.onOk||s,onCancel:c},e.modalProps),{footer:e.muteTimePromiseOK?[y.createElement(w,{onClick:()=>{if(e.muteTimePromiseOK){const t=e.muteTimePromiseOK();Rt(t)?t.then((e=>{e&&l(!1)})):l(!1)}},type:"primary",danger:!0},a("清除")),y.createElement(w,{onClick:c},a("取消")),y.createElement(w,{type:"primary",onClick:s},a("确定"))]:void 0}),e.children))}));const Mt={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},Ut=({children:e,setFields:t,form:a,layout:n="vertical"})=>(E(),f.exports.useEffect((()=>{t&&t(a)}),[]),y.createElement($,o(i({},Mt),{preserve:!1,form:a,layout:n}),e));function Ht(e){E();const[t]=$.useForm(),a=P(),[n,l]=f.exports.useState(!1);return y.createElement(At,{noModal:e.noModal,menuButton:e.menuButton,modalName:e.modalName,handleOk:()=>t.validateFields().then((t=>{l(!0);const n=e.beforePromiseOk?e.beforePromiseOk(t):t;return e.handlePromiseOk(n).then((n=>(console.log(n),n.success&&e.afterPromiseOk&&e.afterPromiseOk(n.dat,t,a),l(!1),n.success))).catch((e=>{l(!1)}))})).catch((e=>{console.warn(e),l(!1)})),modalProps:i({confirmLoading:n},e.modalProps),customizeButton:e.customizeButton,muteTimePromiseOK:e.muteTimePromiseOK?()=>{if(e.muteTimePromiseOK)return l(!0),e.muteTimePromiseOK().then((t=>(t.success&&e.afterPromiseOk&&e.afterPromiseOk(),l(!1),t.success))).catch((e=>{l(!1)}))}:void 0},y.createElement(Ut,{setFields:e.setFields,form:t,layout:e.formLayout},"function"!=typeof e.children?e.children:e.children(t)))}const Bt=function(e){return vt(`${Nt}/api/n9e/classpaths`,{method:ft.Post,data:e})},Kt=function(e,t=1){return vt(`${Nt}/api/n9e/classpaths`,{method:ft.Get,params:{query:e,limit:30,p:t}})},jt=function(e,t=1,a){return vt(`${Nt}/api/n9e/classpaths`,{method:ft.Get,params:{query:a,limit:e,p:t}})},zt=function(){return vt(`${Nt}/api/n9e/classpaths/favorites`,{method:ft.Get})},Yt=function(e){return vt(`${Nt}/api/n9e/classpath/${e}/favorites`,{method:ft.Post,data:{id:e}})},Jt=function(e){return vt(`${Nt}/api/n9e/classpath/${e}/favorites`,{method:ft.Delete,data:{id:e}})},Wt=function(e){return vt(`${Nt}/api/n9e/classpath/${e}`,{method:ft.Delete})},Qt=function(e){return vt(`${Nt}/api/n9e/classpath/${e.id}`,{method:ft.Put,data:e})},Xt=function(e){return vt(`${Nt}/api/n9e/classpath/${e.id}/resources`,{method:ft.Get,params:o(i({},e),{id:void 0})})},Zt=function(e){return vt(`${Nt}/api/n9e/resources`,{method:ft.Get,params:{qres:e}})},ea=function(e,t){return vt(`${Nt}/api/n9e/classpath/${e}/resources`,{method:ft.Delete,data:t})},ta=function(e){return vt(`${Nt}/api/n9e/classpath/${e.id}/resources`,{method:ft.Post,data:e.data})},aa=function(e){return vt(`${Nt}/api/n9e/resource/${e}`,{method:ft.Get})},na=function(e){return vt(`${Nt}/api/n9e/resources/note`,{method:ft.Put,data:e})},la=function(e){return vt(`${Nt}/api/n9e/resources/tags`,{method:ft.Put,data:e})},ra=function(e){return vt(`${Nt}/api/n9e/resources/mute`,{method:ft.Put,data:e})},sa=function(e){return vt(`${Nt}/api/n9e/collect-rules`,{method:ft.Post,data:e})},ia=function(e){return vt(`${Nt}/api/n9e/v2/collect-rules`,{method:ft.Post,data:e})},oa=function(e){return vt(`${Nt}/api/n9e/collect-rule/${e.id}`,{method:ft.Put,data:e})},ca=function(e){return function(t){return vt(`${Nt}/api/n9e/classpath/${t.id}/collect-rules`,{method:ft.Get,params:o(i({},t),{type:e})})}},ma=function(e){return vt(`${Nt}/api/n9e/collect-rules`,{method:ft.Delete,data:{ids:e}})};function ua(e){var t=e,{payload:a,defaultVisible:n=!1,renderContent:l,renderTrigger:r,renderFooter:s,onConfirm:o,onMounted:m,beforeClose:u}=t,d=c(t,["payload","defaultVisible","renderContent","renderTrigger","renderFooter","onConfirm","onMounted","beforeClose"]);const{t:p}=E(),h=f.exports.useRef(),[g,v]=f.exports.useState(!1),[x,k]=f.exports.useState(!1),[b,C]=f.exports.useState({});f.exports.useEffect((()=>{if(!g)return;const e=null==m?void 0:m(_);return()=>{null==e||e()}}),[g]);const N=()=>{v(!1)},S=()=>{u?u(_).then((()=>{N()})):N()},_={payload:a,ref:h,open:()=>{v(!0)},close:N,innerContext:b,setInnerContext:C},I=y.createElement("div",{style:{textAlign:"left"}},y.createElement(w,{style:{marginRight:8},type:"primary",loading:x,onClick:()=>{k(!0),o(_).then((()=>{N()})).finally((()=>{k(!1)}))}},p("保存")),y.createElement(w,{onClick:S},p("取消")));return y.createElement(y.Fragment,null,r(_),y.createElement(G,i({footer:s?s(_):I,className:"App",visible:g,onClose:S,destroyOnClose:!0},d),y.createElement("div",null,l(_))))}var da=y.forwardRef((function(e,t){var a=e,{fetchHandle:n,fetchParams:l={},needPagination:r=!0,pageSize:s,feQueryKey:m="query",feFixedKey:u="id",feQueryParams:d=[],fePaging:p=!1,autoFetch:h=!0,initFetch:g=!1,onFetchList:v,paginationProps:x}=a,k=c(a,["fetchHandle","fetchParams","needPagination","pageSize","feQueryKey","feFixedKey","feQueryParams","fePaging","autoFetch","initFetch","onFetchList","paginationProps"]);E();const[b,C]=f.exports.useState([]),[N,S]=f.exports.useState([]),[w,_]=f.exports.useState([]),[I,$]=f.exports.useState(!1),[P,F]=f.exports.useState(1),[O,T]=f.exports.useState(!1),[D,L]=f.exports.useState(0),[q,R]=f.exports.useState((()=>s||15)),[V,G]=f.exports.useState({});f.exports.useEffect((()=>{h&&(M(),$(!0))}),[]),f.exports.useEffect((()=>{!h&&g&&(M(),$(!0))}),[g]),f.exports.useEffect((()=>{if(I)if(p){const e=N.slice((P-1)*q,P*q);_(e),v&&v(e)}else M()}),[P,q]),f.exports.useEffect((()=>{p?(V[u]&&V[u]===l[u]?(U(b),F(1)):1===P?I&&M():F(1),G(l)):1===P?I&&M():F(1)}),[JSON.stringify(l)]);const M=async()=>{T(!0);const{success:e,dat:t}=await n(o(i({},l),{p:P,limit:q}));var a;e&&(!p&&(a=t,Array.isArray(a.list))?(C(t.list||[]),L(t.total),v&&v(t.list||[])):(C(t||[]),U(t||[]))),T(!1)},U=e=>{if(Array.isArray(e)){const t=l[m]||"",a=e.filter((e=>{let a=!1;return""!==t&&Array.isArray(d)&&0!==d.length?(d.forEach((n=>{const l=H(n,e);"string"==typeof l&&(a=a||-1!==l.indexOf(t))})),a):(a=!0,a)}));S(a),L(a.length);const n=a.slice((P-1)*q,P*q);_(n),v&&v(n)}else S([]),L(0),_([]),v&&v([])},H=(e,t)=>{const a=()=>{const a=e.indexOf("."),n=e.slice(0,a);return t[n]?H(e.slice(a+1,e.length),t[n]):""},n=()=>{let a=e.indexOf("[");if(a<=0)return"";let n=e.indexOf("]");const l=e.slice(0,a),r=t[l];if(Array.isArray(r)&&r.length){if(-1!==n){const a=e.match(/\[(\w+)\]/);if(a.length<2)return"";{const l=a[1];return r[l]?n===e.length-1?r[l]:H(e.slice(n+1,e.length),t[l]):""}}return""}return""};return-1!==e.indexOf(".")&&-1!==e.indexOf("[")?e.indexOf(".")<e.indexOf("[")?a():n():-1!==e.indexOf(".")?a():-1!==e.indexOf("[")?n():t[e]||""},B=()=>{M()};return f.exports.useImperativeHandle(t,(()=>({refreshList:B}))),y.createElement(A,i({dataSource:p?w:b,pagination:i({showTotal:e=>`Total ${e} items`,current:P,pageSize:q,onChange:F,total:D,showSizeChanger:!0,onShowSizeChange:(e,t)=>{R(t),F(1)}},x),loading:O},k))}));const{confirm:pa}=V,Ea=({activeKey:e,currentKey:t})=>{const[a,n]=f.exports.useState(!1),l=P(),[r,s]=f.exports.useState([]),[o,c]=f.exports.useState([]),[m,u]=f.exports.useState(""),[d,p]=f.exports.useState(""),[g,v]=f.exports.useState([]),{t:x}=E(),k=f.exports.useRef(null),{group:{common:b},resourceData:{resourceDetail:C},currentGroup:N,prefix:S}=h((e=>e.resource));f.exports.useEffect((()=>{e===t&&!a&&(null==N?void 0:N.id)&&n(!0)}),[e,t,a,N]),f.exports.useEffect((()=>{s([]),c([])}),[null==N?void 0:N.id]);const _=[{title:y.createElement("div",null,x("资源标识"),y.createElement(M,{placement:"top",title:x("复制已选项")},y.createElement(U,{onClick:()=>{""===d?R.warning(x("请先选择资源标识")):Gt(d,x)}}))),dataIndex:"ident",filterIcon:"copy",render:(e,t)=>{const a=In({record:t,dispatch:l,ref:k},x);return y.createElement("div",null,y.createElement(ua,i({},a)))}},{title:x("资源名称"),dataIndex:"alias"},{title:x("标签"),dataIndex:"tags",ellipsis:!0,render:(e,t)=>y.createElement("span",null,t.tags?t.tags.split(" ").map((e=>y.createElement(H,{key:e,color:"blue"},e))):"")},{title:x("备注"),dataIndex:"note",ellipsis:!0,render:(e,t)=>y.createElement("span",null,t.note||"")},{title:x("操作"),dataIndex:"operator",width:200,render:(e,t)=>y.createElement("div",{className:"table-operator-area"},y.createElement(Ht,i({},Ln({etime:t.mute_etime,btime:t.mute_btime},[t.id],(()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}),x))),y.createElement("div",{className:"table-operator-area-warning",onClick:()=>{(null==N?void 0:N.id)&&pa({title:x("是否移除该资源?"),icon:y.createElement(B,null),onOk:()=>{ea(null==N?void 0:N.id,[t.ident]).then((()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}))},onCancel(){}})}},x("移除")))}],I=f.exports.useCallback((()=>({fetchParams:{id:(null==N?void 0:N.id)||"",query:m,prefix:S},fetchHandle:Xt,autoFetch:!1,initFetch:a,columns:_,rowKey:"ident",rowSelection:{selectedRowKeys:r,onChange:(e,t)=>{let a=t.map((e=>e.id));v(a);let n=[];for(const r of t)n.push(r.ident.trim());let l=n.join("\n").trim();p(l),s(e),c(t)}}})),[null==N?void 0:N.id,a,r,m,S,x]),$=o.map((e=>e.tags)).filter((e=>e)),F=f.exports.useMemo((()=>y.createElement("ul",{className:"ant-dropdown-menu"},y.createElement("li",{className:"ant-dropdown-menu-item"},r.length?y.createElement(Ht,i({},Ln({etime:0,btime:0},g,(()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}),x))):y.createElement("div",{onClick:()=>{R.warning(x("您未选用任何资源"))}},x("屏蔽时间"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{r.length?pa({title:x("是否移除该资源?"),icon:y.createElement(B,null),onOk:()=>{(null==N?void 0:N.id)&&ea(null==N?void 0:N.id,o.map((e=>e.ident))).then((()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}))},onCancel(){}}):R.warning(x("您未选用任何资源"))}},y.createElement("span",null,x("移除"))),y.createElement("li",{className:"ant-dropdown-menu-item"},r.length?y.createElement(Ht,i({},Rn(g,(()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}),x))):y.createElement("div",{onClick:()=>{R.warning(x("您未选用任何资源"))}},x("维护备注"))),y.createElement("li",{className:"ant-dropdown-menu-item"},r.length?y.createElement(Ht,i({},Vn($.length>0?Array.from(new Set($.join(" ").split(" "))):[],g,(()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}),x))):y.createElement("div",{onClick:()=>{R.warning(x("您未选用任何资源"))}},x("维护标签"))))),[r,g,x]);return y.createElement("div",null,y.createElement("div",{className:"table-search-area"},y.createElement(Ot,{style:{width:"400px"},placeholder:x("资源信息或标签"),onSearch:e=>{u(e)}}),y.createElement("div",{className:"table-search-area-right"},y.createElement(Ht,i({},_n([(null==N?void 0:N.id)||""],(()=>{var e;null==(e=null==k?void 0:k.current)||e.refreshList()}),x))),y.createElement(D,{overlay:F,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation(),style:{marginLeft:8}},x("更多操作"),y.createElement(L,{style:{marginLeft:2}}))))),y.createElement(da,i({ref:k},I())))},{TextArea:ha}=F,ga=(e,t,a,n,l)=>({customizeButton:y.createElement("div",null,t("import"===e?"导入规则":"导出规则")),modalName:t("import"===e?"导入规则":"导出规则"),handlePromiseOk:t=>{if("import"!==e)return Promise.resolve();try{const e=JSON.parse((null==t?void 0:t.data)||"[]");return ia(e.map((e=>o(i({},e),{classpath_id:l}))))}catch(a){return Promise.resolve()}},afterPromiseOk:(t,a)=>{"import"===e&&n&&n()},setFields:t=>{"export"===e&&t.setFieldsValue({data:a||""})},formLayout:"horizontal",children:y.createElement(y.Fragment,null,y.createElement("p",{style:{color:"#999"}},"export"===e&&y.createElement("a",{onClick:()=>{Vt(a||[""],"Download.json")}},"Download.json")),y.createElement($.Item,{name:"data",key:"data",wrapperCol:{span:24},rules:[{required:!0,message:t("请输入导入信息"),validateTrigger:"trigger"}]},y.createElement(ha,{rows:4})))}),va=function(e){return vt(`${Nt}/api/n9e/dashboards`,{method:ft.Get,params:e})},fa=function(e){return vt(`${Nt}/api/n9e/dashboards/import`,{method:ft.Post,data:e})},ya=function(e){return vt(`${Nt}/api/n9e/dashboard/${e}`,{method:ft.Get})},xa=function(e,t){return vt(`${Nt}/api/n9e/dashboard/${e}`,{method:ft.Put,data:t})},ka=function(e){return vt(`${Nt}/api/n9e/chart-groups`,{method:ft.Put,data:e})},ba=function(e){const t=e.map((e=>o(i({},e),{configs:JSON.stringify(e.configs)})));return vt(`${Nt}/api/n9e/charts/configs`,{method:ft.Put,data:t})},Ca=function(e){return vt(`${Nt}/api/n9e/check-promql`,{method:ft.Get,params:{promql:e}})},Na=function(e){return vt(`${Nt}/api/n9e/tpl/list?tpl_type=${e}`,{method:ft.Get})},Sa=function(e,t){return vt(`${Nt}/api/n9e/tpl/content?tpl_type=${e}&tpl_name=${t}`,{method:ft.Get})},{confirm:wa}=V;var _a=y.forwardRef((function({activeKey:e,currentKey:t,createModalProps:a,searchPlaceHolder:n,fetchHandle:l,columns:r},s){const{currentGroup:o,prefix:c}=h((e=>e.resource)),{t:m}=E(),[u,d]=f.exports.useState([]),[p,g]=f.exports.useState([]),[v,x]=f.exports.useState(""),[k,b]=f.exports.useState(!1),C=f.exports.useRef(null);f.exports.useEffect((()=>{e===t&&!k&&(null==o?void 0:o.id)&&b(!0)}),[e,t,k,o]),f.exports.useEffect((()=>{k&&N()}),[c]),f.exports.useEffect((()=>{d([])}),[null==o?void 0:o.id]);const N=()=>{C.current.refreshList()};f.exports.useImperativeHandle(s,(()=>({refreshList:N})));const[S,_]=f.exports.useState([]);f.exports.useEffect((()=>{Kt().then((e=>{_(e.dat.list)}))}),[JSON.stringify(u)]);const I=f.exports.useCallback((()=>({fetchParams:{id:(null==o?void 0:o.id)||"",query:v,prefix:c},fetchHandle:l,autoFetch:!1,initFetch:k,feQueryParams:["name","note","data.port","data.param"],columns:r,rowKey:"id",pageSize:10,fePaging:!0,rowSelection:{selectedRowKeys:u,selectedRows:p,onChange:(e,t)=>{d(e),g(t)}}})),[null==o?void 0:o.id,k,u,v,c]),$=f.exports.useMemo((()=>y.createElement("ul",{className:"ant-dropdown-menu"},y.createElement("li",{className:"ant-dropdown-menu-item"},y.createElement(Ht,i({},ga("import",m,JSON.stringify(p,null,2),N,null==o?void 0:o.id)))),y.createElement("li",{className:"ant-dropdown-menu-item"},u.length?y.createElement(Ht,i({},ga("export",m,JSON.stringify(p,null,2)))):y.createElement("div",{onClick:()=>{R.warning(m("未选择任何规则"))}},m("导出规则"))),y.createElement("li",{className:"ant-dropdown-menu-item"},u.length?y.createElement(Ht,i({},qn(p,S,m))):y.createElement("div",{onClick:()=>{R.warning(m("未选择任何规则"))}},m("克隆到其他资源分组"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{u.length?wa({title:m("是否批量删除规则?"),onOk:()=>{ma(u).then((()=>{R.success(m("删除成功")),N()}))},onCancel(){}}):R.warning(m("未选择任何规则"))}},y.createElement("span",null,m("删除"))))),[u]);return y.createElement("div",null,y.createElement("div",{className:"table-search-area"},y.createElement(Ot,{style:{width:"400px"},placeholder:n,onSearch:e=>{x(e)}}),y.createElement("div",{className:"table-search-area-right"},a?y.createElement(Ht,i({},a)):null,y.createElement("div",{className:"table-more-options"},y.createElement(D,{overlay:$,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation(),style:{marginLeft:8}},m("更多操作"),y.createElement(L,{style:{marginLeft:2}})))))),y.createElement(da,i({ref:C},I())))}));const Ia=e=>{var t,a,n;const{t:l}=E(),r=h((e=>e.resource)),s=f.exports.useRef(null),o=()=>{s.current.refreshList()},c=i({fetchHandle:ca("port"),searchPlaceHolder:"",columns:wn({classpath_name:(null==(t=null==r?void 0:r.currentGroup)?void 0:t.path)||""},o,"port",l),createModalProps:Fn(l,{classpath_name:(null==(a=null==r?void 0:r.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==r?void 0:r.currentGroup)?void 0:n.id)||0,type:"port"},o)},e);return y.createElement(_a,i({ref:s},c))},$a=e=>{var t,a,n;const{t:l}=E(),r=h((e=>e.resource)),s=f.exports.useRef(null),o=()=>{s.current.refreshList()},c=i({fetchHandle:ca("process"),columns:wn({classpath_name:(null==(t=null==r?void 0:r.currentGroup)?void 0:t.path)||""},o,"process",l),createModalProps:Pn(l,{classpath_name:(null==(a=null==r?void 0:r.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==r?void 0:r.currentGroup)?void 0:n.id)||0,type:"process"},o)},e);return y.createElement(_a,i({ref:s},c))},Pa=e=>{var t,a,n;const{t:l}=E(),r=h((e=>e.resource)),s=f.exports.useRef(null),o=()=>{s.current.refreshList()},c=i({fetchHandle:ca("script"),columns:wn({classpath_name:(null==(t=null==r?void 0:r.currentGroup)?void 0:t.path)||""},o,"script",l),createModalProps:On(l,{classpath_name:(null==(a=null==r?void 0:r.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==r?void 0:r.currentGroup)?void 0:n.id)||0,type:"script"},o)},e);return y.createElement(_a,i({ref:s},c))},Fa=e=>{var t,a,n;const{t:l}=E(),r=h((e=>e.resource)),s=f.exports.useRef(null),o=()=>{s.current.refreshList()},c=i({fetchHandle:ca("log"),columns:wn({classpath_name:(null==(t=null==r?void 0:r.currentGroup)?void 0:t.path)||""},o,"log",l),createModalProps:Tn(l,{classpath_name:(null==(a=null==r?void 0:r.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==r?void 0:r.currentGroup)?void 0:n.id)||0,type:"log"},o)},e);return y.createElement(_a,i({ref:s},c))};var Oa,Ta,Da,La,qa,Ra;(Ta=Oa||(Oa={}))[Ta.Need=1]="Need",Ta[Ta.UnNeed=0]="UnNeed",(La=Da||(Da={})).CmdLine="cmdline",La.Name="name",(Ra=qa||(qa={})).TCP="tcp",Ra.UDP="udp";const Va=({value:e,editType:t,selectProps:a,validator:n,onChange:l})=>{const{t:r}=E(),[s,o]=f.exports.useState(!1),[c,m]=f.exports.useState(e),[u,d]=f.exports.useState(e);f.exports.useEffect((()=>{m(e),d(e)}),[e]);const p=e=>{let t=!0;!n||(t=n(e)||!1,t)?d(e):R.error(`"${e}${r('"不符合输入规范（格式为key=value）')}`)},h=()=>{d(c),o(!1)},g=()=>{o(!1),l&&l(u),m(u)};return y.createElement(y.Fragment,null,s?(console.log(u),y.createElement(y.Fragment,null,"input"===t?y.createElement(F,{value:u,onChange:e=>{p(e.target.value)}}):y.createElement(j,i({onChange:p,value:u},a)),y.createElement(w,{style:{margin:"0 8px"},size:"small",onClick:h},r("取消")),y.createElement(w,{size:"small",type:"primary",onClick:g},r("保存")))):(()=>{let e;return Array.isArray(u)&&"select"===t&&(e=(null==a?void 0:a.options)?null==a?void 0:a.options.filter((e=>u.includes(e.value))).map(((e,t)=>y.createElement(H,{key:t,color:"blue"},e.label))):u.map((e=>y.createElement(H,{key:e,color:"blue"},e)))),y.createElement("div",{style:{display:"flex",alignItems:"center"},className:"hoverInput"},y.createElement("div",{style:{minHeight:32,marginRight:10}},"select"===t?e:u),y.createElement(K,{onClick:()=>{o(!0)}}))})())},{confirm:Ga}=V,Aa=({refs:e})=>{var t,a,n;const{t:l}=E(),{group:{common:r},resourceData:{resourceDetail:s,resourceDetailLoading:o}}=h((e=>e.resource)),c=P();return y.createElement("div",{className:"detail-content"},y.createElement(z,{spinning:o},y.createElement(Y,{title:l("资源详情")},y.createElement(J,{align:"middle",className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("资源名称"),"："),y.createElement(W,{offset:1},null!=(t=null==s?void 0:s.alias)?t:"")),y.createElement(J,{className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("资源标识"),"："),y.createElement(W,{offset:1},null!=(a=null==s?void 0:s.ident)?a:"")),y.createElement(J,{align:"middle",className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("标签"),"："),y.createElement(W,{offset:1},y.createElement(Va,{value:""==(null==s?void 0:s.tags)?[]:null==s?void 0:s.tags.split(" "),editType:"select",onChange:async t=>{var a;if(null==s?void 0:s.id){const{success:n}=await la({ids:[null==s?void 0:s.id],tags:t.join(" ")});n&&(c({type:"resource/getResourceItem",id:(null==s?void 0:s.id)||""}),null==(a=null==e?void 0:e.current)||a.refreshList())}},validator:e=>{let t=e[e.length-1];return!(t&&!/\w+=\w+/.test(t))},selectProps:{mode:"tags",allowClear:!0,placeholder:l("格式为key=value回车分隔")}}))),y.createElement(J,{align:"middle",className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("资源分组"),"："),y.createElement(W,{offset:1},y.createElement(Va,{value:(null==s?void 0:s.classpath_ids)||[],editType:"select",onChange:async t=>{var a,n;if(null==s?void 0:s.id){const{success:l}=await(n={res_idents:(null==s?void 0:s.ident)?[null==s?void 0:s.ident]:[],classpath_ids:t},vt(`${Nt}/api/n9e/resources/classpaths`,{method:ft.Put,data:n}));l&&(c({type:"resource/getResourceItem",id:(null==s?void 0:s.id)||""}),null==(a=null==e?void 0:e.current)||a.refreshList())}},selectProps:{mode:"multiple",allowClear:!0,placeholder:l("请选择所属资源分组"),options:r.map((e=>({value:e.id,label:e.path,children:y.createElement(H,{color:"blue"},e.path)})))}}))),y.createElement(J,{align:"middle",className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("备注"),"："),y.createElement(W,{offset:1},y.createElement(Va,{value:null!=(n=null==s?void 0:s.note)?n:"",editType:"input",onChange:async t=>{var a;if(null==s?void 0:s.id){const{success:n}=await na({ids:[null==s?void 0:s.id],note:t});n&&(c({type:"resource/getResourceItem",id:(null==s?void 0:s.id)||""}),null==(a=null==e?void 0:e.current)||a.refreshList())}}}))),y.createElement(J,{align:"middle",className:"row-style"},y.createElement(W,{span:3,style:{textAlign:"right"}},l("屏蔽时间"),"："),y.createElement(W,{offset:1},(()=>{const e=(null==s?void 0:s.mute_btime)||0,t=(null==s?void 0:s.mute_etime)||0;return 0===e&&0===t?y.createElement("div",null):y.createElement(y.Fragment,null,Q(1e3*e).format("YYYY-MM-DD HH:mm:ss")," - ",Q(1e3*t).format("YYYY-MM-DD HH:mm:ss"))})()),y.createElement(W,{offset:1},y.createElement(Ht,i({},Ln({etime:(null==s?void 0:s.mute_etime)||0,btime:(null==s?void 0:s.mute_btime)||0},[null==s?void 0:s.id],(()=>{var t;c({type:"resource/getResourceItem",id:(null==s?void 0:s.id)||""}),null==(t=null==e?void 0:e.current)||t.refreshList()}),l,y.createElement(K,{className:"detail-mute-time"}))))))),y.createElement(Y,{title:l("彻底删除资源"),style:{marginTop:40}},y.createElement("p",null,l("两种情况会有彻底删除资源的需求")),y.createElement("p",null,l("1.")," ",l("资源对应的设备已经下线了，永远都不会有新的监控数据上报了")),y.createElement("p",null,l("2.")," ",l("资源的ident(唯一标识)发生变化，老的ident需要手工清理掉")),y.createElement(w,{onClick:()=>{if(s){const{id:t,alias:a}=s;Ga({zIndex:2001,title:`${l("是否确认永久删除资源")}?${a}`,icon:y.createElement(B,null),onOk:()=>{(function(e){return vt(`${Nt}/api/n9e/resource/${e}`,{method:ft.Delete})})(t).then((()=>{var t;null==(t=null==e?void 0:e.current)||t.refreshList()}))},onCancel(){}})}},className:"clear-button",style:{float:"right"}},l("彻底删除资源")))))},Ma=function(e){return vt(`${Nt}/api/n9e/tag-pairs`,{method:ft.Post,data:e})},Ua=function(e){return vt(`${Nt}/api/n9e/tag-metrics`,{method:ft.Post,data:e})},Ha=function(e){return vt(`${Nt}/api/n9e/charts/tmps`,{method:ft.Post,data:e})},{Option:Ba}=j;var Ka=f.exports.forwardRef((({onChange:e,idents:t,multiple:a=!0,value:n},l)=>{const{t:r}=E(),[s,i]=f.exports.useState([]),[o,c]=f.exports.useState([]),[m,u]=f.exports.useState([]);f.exports.useEffect((()=>{d()}),[JSON.stringify(t)]),f.exports.useEffect((()=>{n&&i(n)}),[n]);const d=(e="")=>{if(e.length>0&&e.length<4)return;Ua({limit:150,metric:e,idents:t}).then((e=>{e.dat.metrics&&(c(e.dat.metrics),u(e.dat.metrics.concat(m)))}))},p=t=>{if(i(t),a){let a=t.map((e=>m.find((t=>t.name===e))));e(a)}else e(t)},h=X.exports.debounce((e=>{d(e)}),500),g=()=>{p([])};return f.exports.useImperativeHandle(l,(()=>({reset:g}))),y.createElement(y.Fragment,null,y.createElement(j,{mode:a?"multiple":void 0,style:{width:"100%"},placeholder:r("请输入监控指标(输入4个以上字符发起检索)"),value:s,onChange:p,onSearch:h,onDeselect:()=>{s.length<=1&&d()},showSearch:!0,dropdownClassName:"overflow-586"},o.map(((e,t)=>y.createElement(Ba,{key:t,value:e.name},e.name," ",e.description)))))}));const{Option:ja}=j;var za,Ya,Ja=f.exports.forwardRef(((e,t)=>{const{t:a}=E(),[n,l]=f.exports.useState([]),[r,s]=f.exports.useState([]);f.exports.useEffect((()=>{i(void 0)}),[e.metrics]);const i=t=>{let a=e.metrics.map((e=>({metric:e})));0!==a.length&&Ma({limit:3e3,params:a,tags:t}).then((e=>{e.dat.tags&&l(e.dat.tags)}))},o=t=>{s(t),e.onChange(t);let a=t.map((e=>{let[t,a]=e.split("=");return{key:t,value:a}}));i(a)},c=()=>{o([])};return f.exports.useImperativeHandle(t,(()=>({reset:c}))),y.createElement(j,{mode:"multiple",style:{width:"100%"},value:r,placeholder:a("请选择标签"),onChange:o},n.map(((e,t)=>y.createElement(ja,{key:t,value:e},e))))}));function Wa(e){E();const{tagInfo:t,onOk:a}=e,{tagKey:n,tagValue:l,selectValue:r}=t,[s,o]=f.exports.useState(""),[c,m]=f.exports.useState(!1),[u,d]=f.exports.useState([]),[p,h]=f.exports.useState(0),g={onChange:(e,t)=>{d(t.map((e=>e.name)))}},v=e=>{o(e)},x=()=>{let e=u.map((e=>({key:n,value:e})));a({tagKey:n,data:e}),m(!1),h(e.length)};return y.createElement(Z,{content:(e=>{const{t:t}=E();return y.createElement(y.Fragment,null,y.createElement(Ot,{placeholder:t("请输入搜索关键词"),allowClear:!0,onSearch:v}),y.createElement(A,{className:"tag-table",style:{width:"300px"},rowSelection:i({type:"checkbox"},g),pagination:{pageSize:5,simple:!0},columns:[{title:"Name",dataIndex:"name"}],rowKey:"name",dataSource:e.filter((e=>e.includes(s))).map((e=>({name:e})))}),y.createElement(w,{onClick:x,size:"small",type:"primary",className:"tag-apply"},"Apply"))})(l),title:n,trigger:"click",visible:c,onVisibleChange:e=>{m(e)}},y.createElement(H,{onClick:()=>m(!0)},n," ",y.createElement("span",{className:"tag-num"},p>0?p:"")," ",y.createElement(L,null)))}function Qa(e){let t={};return e.map((e=>e.split("="))).forEach((([e,a])=>{t[e]?t[e].tagValue.push(a):t[e]={tagKey:e,tagValue:[a],selectValue:[],filter:""}})),Object.keys(t).map((e=>t[e]))}function Xa(e){E();const{options:t,onChange:a}=e,{metric:n,tags:l,start:r,end:s,limit:i,idents:o}=t,[c,m]=f.exports.useState([]),[u,d]=f.exports.useState([]);f.exports.useEffect((()=>{Ma({params:Array.isArray(n)?n.map((e=>({metric:e,idents:o}))):[{metric:n,idents:o}],tags:l,limit:i,start:r,end:s}).then((e=>{e.dat&&e.dat.tags&&m(Qa(e.dat.tags))}))}),[i,n,l]);const p=e=>{let t=u.filter((t=>t.key!==e.tagKey)).concat(e.data);d(t),a(t)};return y.createElement(y.Fragment,null,Object.keys(c).map(((e,t)=>y.createElement(Wa,{key:t,tagInfo:c[t],onOk:p}))))}function Za(e){return!!(e&&e.start&&e.end)}(Ya=za||(za={})).Line="line",Ya.Pie="pie",Ya.Bar="bar";const en=(e,t)=>void 0===e?"":Q(e).format(t);function tn(e){E();const{open:t,onChange:a}=e,[n,l]=f.exports.useState(),[r,s]=f.exports.useState(),[i,o]=f.exports.useState(),c=(e,t)=>Q(e).isBefore(t,"date"),m=(e,t,a)=>{return!(!t||!a)&&(n=t,Q(e).isAfter(n,"date")&&c(e,a));var n};return y.createElement(y.Fragment,null,t&&y.createElement(ee,{base:Q(),startDay:n,endDay:r,showMonthCnt:2,customDayClass:e=>n&&!r&&i&&m(e,n,i)?"calendar__day--range":"",onChange:e=>{let t,i;t=n,i=r,n?r?(t=e,i=void 0):c(e,n)?t=e:i=e:t=e,l(t),s(i),a({startDate:t,endDate:i})},onMouseOver:e=>{o(e)},disableDay:e=>Q(e).isAfter(Q(),"date")}))}const{Option:an}=j;function nn(e){E();const{onChange:t,initValue:a}=e,[n,l]=f.exports.useState(""),[r,s]=f.exports.useState(!1),[i,o]=f.exports.useState(!1);return f.exports.useEffect((()=>{a?(e=>{if(Za(e)){const{start:t,end:a}=e;l(`${Q(1e3*t).format("YY-MM-DD")}  --  ${Q(1e3*a).format("YY-MM-DD")}`)}else{const t=qt.findIndex((t=>t.num===(null==e?void 0:e.num)&&t.unit===e.unit));l(t)}})(a):(l(3),t(qt[3]))}),[]),f.exports.useEffect((()=>{function e(e){console.log("hideTheCalendar"),e.preventDefault(),[].findIndex.call(e.path,(e=>"calendar"===e.className))<0&&s(!1)}return r&&document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}}),[r]),y.createElement("div",{className:i?"range-picker calendar":"range-picker"},y.createElement("span",{className:i?"tag from-calendar show":"tag from-calendar"},"5m"),y.createElement(j,{className:"select",value:n,onChange:e=>{e>qt.length-1?s(!0):(l(e),t(qt[e]),o(!1))},dropdownStyle:{marginLeft:"60px"}},qt.map(((e,t)=>y.createElement(an,{key:t,value:t}," ",y.createElement("span",{className:"tag"},e.num,e.shortUnit),"Past ",e.num," ",e.unit))),y.createElement(an,{key:qt.length,value:qt.length}," ",y.createElement("span",{className:"tag"},y.createElement("b",null,y.createElement(te,null))),"Select from calendar"," ")),y.createElement(tn,{open:r,onChange:e=>{e.startDate&&e.endDate&&(s(!1),l(`${en(e.startDate,"YY-MM-DD")}  --  ${en(e.endDate,"YY-MM-DD")}`),t({start:Q(e.startDate).unix(),end:Q(e.endDate).unix()}))}}))}function ln(e){const{t:t}=E(),{onChange:a,showLabel:n}=e,[l,r]=f.exports.useState(!0);return y.createElement("div",{className:"desc-sort"},n&&t(l?"降序":"升序"),y.createElement("div",{className:"desc-sort-icon",onClick:()=>{r(!l),a(!l)}},y.createElement(ae,{style:{color:!1===l?"blue":""}}),y.createElement(ne,{style:{color:!0===l?"blue":"",marginTop:"-0.3em"}})))}var rn=f.exports.memo((function(e){const{t:t}=E(),{options:a,barControl:n,rightBar:l,title:r}=e,[s,c]=f.exports.useState(!1),m=f.exports.useRef(null),u=v(),{metric:d,description:p="",tags:h,range:g,limit:x,idents:k,classpath_id:b,classpath_prefix:C,prome_ql:N,yplotline:S,xplotline:_,step:I}=a,[$,P]=f.exports.useState([]),[F,O]=f.exports.useState(!1),[T,D]=f.exports.useState("desc"),[L,q]=f.exports.useState("origin"),[R,V]=f.exports.useState(null),{start:G,end:A}=(e=>{let t=e||g;if(t){if(Za(t)){const{start:e,end:a}=t;return{start:e,end:a}}return(e=>{const{num:t,shortUnit:a}=e;let n=Q().unix();return{start:Q().subtract(t,a).unix(),end:n}})(t)}return{start:0,end:0}})(g),U=(e=[])=>{let t=e;h&&h.length>0&&(t=h.concat(t));let a=Array.isArray(d)?d.map((e=>({metric:e,classpath_id:b,classpath_prefix:void 0===C?void 0:C?1:0,prome_ql:N,tags:t&&t.length>0?t:void 0,idents:k}))):Array.isArray(N)?N.map((e=>({metric:d,classpath_id:b,classpath_prefix:void 0===C?void 0:C?1:0,prome_ql:e,tags:t&&t.length>0?t:void 0,idents:k}))):[{metric:d,classpath_id:b,classpath_prefix:C?1:0,prome_ql:N,tags:t&&t.length>0?t:void 0,idents:k}];var n;(n={params:a,start:G,end:A,limit:x,step:I},vt(`${Nt}/api/n9e/query`,{method:ft.Post,data:n})).then((e=>{const t=[];e.dat.forEach((e=>{t.push({name:e.metric,data:e.values.map((e=>e.v))})}));const a=[];e.dat.forEach((e=>{const{metric:t,values:n,tags:l}=e,r=n.map((e=>({timestamp:1e3*e.t,value:e.v})));a.push({name:(t?`【${t}】`:"")+l,data:r})}));let n=R?{series:a,tooltip:{precision:L,shared:F,sharedSortDirection:T},yAxis:o(i({},R.options.yAxis),{plotLines:S?[{value:S,color:"red"}]:void 0}),xAxis:o(i({},R.options.xAxis),{plotLines:_?[{value:1e3*_,color:"red"}]:void 0})}:{timestamp:"x",xkey:"timestamp",ykey:"value",chart:{renderTo:m.current},yAxis:{plotLines:S?[{value:S,color:"red"}]:void 0},xAxis:{plotLines:_?[{value:1e3*_,color:"red"}]:void 0},series:a,tooltip:{precision:L,shared:F,sharedSortDirection:T}};R?R.update(n):V(new ie(n))}))};f.exports.useEffect((()=>{U($)}),[a,F,T,L]),f.exports.useEffect((()=>()=>{R&&R.destroy()}),[R]);const H=y.createElement(y.Fragment,null,y.createElement(M,{title:t("tooltip中展示所有曲线的值")},y.createElement(le,{onChange:e=>{O(e.target.checked)}},"Multi")),y.createElement(M,{title:y.createElement(y.Fragment,null,y.createElement("span",null,t("SI格式化:")),y.createElement("a",{type:"link",href:"https://en.wikipedia.org/wiki/Metric_prefix#List_of_SI_prefixes",target:"_blank"},t("文档")))},y.createElement(le,{onChange:e=>{q(e.target.checked?"short":"origin")}},"Format")),y.createElement(ln,{onChange:e=>{D(e?"desc":"asc")}}));return y.createElement("div",{className:"chart-wrapper"},(r||l||p||d)&&y.createElement("div",{className:"chart-title"},r?y.createElement("div",{className:"chart-title-label"},r):y.createElement("div",{className:"chart-title-label"},d," ",p),y.createElement("div",{className:"chart-title-right-bar"},l,!u.pathname.startsWith("/chart/")&&y.createElement(w,{type:"link",size:"small",onClick:async e=>{e.preventDefault();let{dat:t}=await Ha([{configs:JSON.stringify({title:r,options:a,barControl:n})}]);window.open("/chart/"+t)}},y.createElement(re,null)))),!n&&y.createElement("div",{className:"chart-filter"},y.createElement(se,{className:"refresh",spin:s,onClick:e=>{s||(c(!0),U($),setTimeout((()=>{c(!1)}),1e3))}}),H,!N&&y.createElement(Xa,{options:o(i({},a),{start:G,end:A,idents:k}),onChange:e=>{P(e),U(e)}})),"multiOrSort"===n&&y.createElement("div",{className:"chart-filter"},H),y.createElement("div",{ref:m,className:"chart-content"}))}),(function(e,t){return e.cached&&e.options.range===t.options.range&&e.options.step===t.options.step}));function sn({onSelect:e}){const{t:t}=E(),[a,n]=f.exports.useState([]),{currentGroup:l}=h((e=>e.resource)),[r,s]=f.exports.useState(""),i=[{title:t("资源标识"),dataIndex:"ident"},{title:t("资源名称"),dataIndex:"alias"}];return y.createElement("div",null,y.createElement("div",{className:"table-search-area"},y.createElement(Ot,{placeholder:t("资源信息或标签"),onSearch:e=>{s(e)}})),y.createElement(da,{columns:i,rowKey:"ident",fetchParams:{id:(null==l?void 0:l.id)||"",query:r},fetchHandle:Xt,rowSelection:{selectedRowKeys:a,onChange:t=>{n(t),e&&e(t)}},paginationProps:{simple:!0},onFetchList:t=>{const a=t.map((e=>e.ident));n(a),e&&e(a)}}))}function on(e){E();const{onClick:t,className:a}=e,[n,l]=f.exports.useState(!1);return y.createElement(w,{className:a?a+" reload-icon":"reload-icon",loading:n,onClick:e=>{n||(l(!0),t(),setTimeout((()=>{l(!1)}),1e3))},icon:y.createElement(se,{className:"refresh",spin:n})})}const cn=[15,30,60,120,300].map((e=>({label:e,value:e})));function mn(e){const{onChange:t,initialValue:a}=e,[n,l]=f.exports.useState(String(a)),[r,s]=f.exports.useState(Number(a));return y.createElement("div",{className:"resolution"},y.createElement("span",{className:"label"},"Step"),y.createElement(oe,{options:cn,value:n,style:{width:60},onChange:e=>l(e),onSelect:e=>{const a=Number(e);s(a),t(a)},onKeyDown:e=>{if(13===e.keyCode){const e=Number(n);Number.isInteger(e)&&e>0&&(s(e),t(e))}},onBlur:e=>{const a=Number(e.target.value);Number.isInteger(a)&&a>0?(s(a),t(a)):l(""+r)},placeholder:"Step"}))}const{Option:un}=j;function dn({resourceGroupId:e,isIdent:t}){const{t:a,i18n:n}=E(),[l,r]=f.exports.useState([]),s=f.exports.useRef(null),c=f.exports.useRef(null),[m,u]=f.exports.useState(1),[d,p]=f.exports.useState(15),[h,g]=f.exports.useState({start:0,end:0}),[v,x]=f.exports.useState([]),[b,C]=f.exports.useState({range:{start:0,end:0},limit:3e3,metric:"",description:""}),N=(e={},t)=>{let a=t||h;C(o(i(i({},b),e),{range:a}))},S=y.createElement("div",{className:"explore"},y.createElement(J,null,y.createElement(W,{className:"left",span:8},t?y.createElement(sn,{onSelect:e=>{r(e)}}):null,y.createElement("div",{className:"panel"},y.createElement("div",{className:"title"},a("监控指标")),y.createElement(Ka,{idents:l,onChange:e=>{x(e.reverse())},ref:s})),t?null:y.createElement("div",{className:"panel"},y.createElement("div",{className:"title"},a("筛选标签")),y.createElement(Ja,{metrics:v.map((e=>e.name)),onChange:e=>{let t=e.map((e=>{let[t,a]=e.split("=");return{key:t,value:a}}));N({tags:t})},ref:c})),y.createElement("div",{className:"panel"},y.createElement("div",{className:"title"},a("配置")),y.createElement("div",null,a("每张图最多展示"),y.createElement(j,{className:"echart-line-num",defaultValue:"50",size:"small",onChange:e=>{N({limit:e})}},y.createElement(un,{value:50},"50"),y.createElement(un,{value:100},"100"),y.createElement(un,{value:200},"200"),y.createElement(un,{value:500},"500")),a("条线"))),y.createElement(w,{type:"primary",onClick:()=>{s.current.reset(),c.current.reset()},style:{marginTop:"10px"}},a("重置")),y.createElement(w,{type:"primary",disabled:0===v.length,onClick:async()=>{let e=v.map(((e,t)=>({options:o(i({},b),{metric:e.name,description:e.description})}))).map((e=>({configs:JSON.stringify(e)}))),{dat:t}=await Ha(e);window.open("/chart/"+t)},style:{marginTop:"10px"}},a("分享图表"))),y.createElement(W,{className:"right",span:16},y.createElement("div",{className:"header"},y.createElement("div",{className:"header-left"},y.createElement(nn,{onChange:e=>{g(e),N({},e)}}),y.createElement(mn,{onChange:e=>p(e),initialValue:d}),y.createElement(on,{onClick:()=>{N({},i({},h))}})),y.createElement(ce.Group,{value:m,onChange:e=>{u(e.target.value)}},y.createElement(ce.Button,{value:4},"XS"),y.createElement(ce.Button,{value:3},"S"),y.createElement(ce.Button,{value:2},"M"),y.createElement(ce.Button,{value:1},"L"))),y.createElement("div",{className:"chart-list"},y.createElement(J,{gutter:15},v.length>0?v.map(((e,t)=>y.createElement(W,{key:e.name,span:24/m},y.createElement(rn,{cached:!0,options:o(i({},b),{step:d,idents:l.length>0?l:void 0,metric:e.name,description:e.description})})))):y.createElement("h2",{className:"holder"},y.createElement(me,{style:{fontSize:"30px"}}),y.createElement("span",null,a("选择监控指标添加图表"))))))));return t?y.createElement("div",null,S):y.createElement(Ft,{title:a("即时看图"),icon:y.createElement(k,null)},S)}const{RangePicker:pn}=de,En=Date.now(),hn=({value:e,onChange:t})=>{const{t:a}=E(),[n,l]=f.exports.useState(0),[r,s]=f.exports.useState(0),[i,o]=f.exports.useState(0),c=[{value:36e5,label:a("1小时")},{value:72e5,label:a("2小时")},{value:216e5,label:a("6小时")},{value:432e5,label:a("12小时")},{value:864e5,label:a("1天")},{value:1728e5,label:a("2天")},{value:6048e5,label:a("7天")},{value:12096e5,label:a("14天")},{value:2592e6,label:a("30天")},{value:7776e6,label:a("90天")},{value:6048e9,label:a("永久")}];f.exports.useEffect((()=>{(null==e?void 0:e.btime)&&(null==e?void 0:e.etime)?(o(1e3*e.etime),s(1e3*e.btime),l(1e3*(e.etime-e.btime))):(s(En),o(En+c[0].value),l(c[0].value),m(En,En+c[0].value))}),[null==e?void 0:e.btime,null==e?void 0:e.etime]);const m=(e,a)=>{t&&t({btime:Math.floor(e/1e3),etime:Math.floor(a/1e3)})};return y.createElement("div",null,y.createElement(ce.Group,{value:n,style:{marginBottom:8},onChange:e=>{l(e.target.value),m(En,En+e.target.value)}},c.map((e=>y.createElement(ce.Button,{key:e.label,value:e.value},e.label)))),y.createElement("div",null,6048e9!=n&&y.createElement(pn,{allowClear:!1,value:[ue(r),ue(i)],format:"YYYY-MM-DD HH:mm:ss",onChange:(e,t)=>{let a=e[0],n=e[1];m(a.valueOf(),n.valueOf()),l(-1)},showTime:!0})))},gn=e=>{var t=e,{value:a,onChange:n,isKeyValue:l=!0,placeText:r}=t;c(t,["value","onChange","isKeyValue","placeText"]);const{t:s}=E(),[i,o]=f.exports.useState([]),[m,u]=f.exports.useState(!1),d=`${r}${s("名")}`,p=`${r}${s("值")}`;f.exports.useEffect((()=>{let e=[];if(l)e=(null==a?void 0:a.split(" ").filter((e=>{if(-1===e.indexOf("="))return!1;{const[t,a]=e.split("=");return!(!t||!a)}})).map((e=>{const[t,a]=e.split("=");return{key:t,value:a}})))||[{key:"",value:""}];else if(!l&&a)try{Object.keys(a).forEach((t=>{e.push({key:t,value:a[t]})})),m&&e.push({key:"",value:""}),u(!1)}catch(t){}o(e)}),[a]);const h=()=>{if(n)if(l){let e="";i.forEach((t=>{const{key:a,value:n}=t;a&&n&&(e+=`${a}=${n} `)})),n(e)}else{const e={};i.forEach((t=>{const{key:a,value:n}=t;a&&(e[a]=n),i.length>0&&!a&&!n&&u(!0)})),n(e)}},g=e=>{i.splice(e,1),o([...i])},v=()=>{i.push({key:"",value:""}),o([...i])};return y.createElement(y.Fragment,null,i.length>0?i.map(((e,t)=>y.createElement(J,{key:t},y.createElement(W,null,y.createElement(F,{addonBefore:d,value:e.key,placeholder:l?"tagKey":`${s("请输入")}${r}${s("名")}`,style:{width:180},onChange:e=>((e,t)=>{if(i[t].key=e.target.value,o([...i]),l)h();else{const{key:e,value:a}=i[t];e&&a&&h()}})(e,t)})),l?y.createElement(W,{span:2},y.createElement("span",{style:{textAlign:"center",width:"100%",display:"inline-block",height:32,lineHeight:"32px"}},"=")):null,y.createElement(W,{offset:l?0:2},y.createElement(F,{addonBefore:p,value:e.value,placeholder:l?"tagValue":`${s("请输入")}${r}${s("值")}`,style:{width:180},width:200,onChange:e=>((e,t)=>{if(i[t].value=e.target.value,o([...i]),l)h();else{const{key:e,value:a}=i[t];e&&a&&h()}})(e,t)})),y.createElement(W,{offset:1,style:{marginBottom:t===i.length-1?0:24,lineHeight:"32px"}},t===i.length-1&&e.value&&e.key?y.createElement(y.Fragment,null,y.createElement(pe,{style:{marginRight:"8px"},onClick:()=>{g(t),h()}}),y.createElement(Ee,{onClick:()=>v()})):y.createElement(pe,{onClick:()=>{g(t),h()}}))))):y.createElement(Ee,{onClick:()=>v()}))},{confirm:vn}=V,{TextArea:fn}=F,{Option:yn}=j,xn={wrapperCol:{xs:{span:24},sm:{span:16}}},kn=[15,30,60,90,120,300,600,1800,3600],bn=({onChange:e=(()=>{}),value:t=0})=>{const{t:a}=E();return y.createElement(y.Fragment,null,y.createElement(he,{style:{width:150},min:1,onChange:e,value:t})," ",a("秒"))},Cn=({onChange:e=(()=>{}),value:t=""})=>{const{t:a}=E();return y.createElement(y.Fragment,null,y.createElement(j,{style:{width:150},onChange:e,value:t},kn.map((e=>y.createElement(yn,{key:e,value:e},e))))," ",a("秒"))},Nn=(e,t)=>{let a=e[e.length-1];if(a&&!/\w+=\w+/.test(a)){let a=e.pop();R.error(`"${a}${t('"不符合输入规范（格式为key=value）')}`)}},Sn=e=>[{key:"resource",title:e("资源"),component:Ea},{key:"explorer",title:e("看图"),component:dn},{key:"port",title:e("端口"),component:Ia},{key:"service",title:e("进程"),component:$a},{key:"plugin",title:e("插件"),component:Pa},{key:"log",title:e("日志"),component:Fa}],wn=({classpath_name:e},t,a,n)=>{const l=new Map([["port",n("端口号")],["process",n("进程标识")],["script",n("插件路径")],["log",n("日志路径")]]),r=[{title:n("采集名称"),dataIndex:"name",render:(l,r)=>y.createElement(Ht,i({},Dn.get(a)(n,o(i({},r),{type:a,classpath_name:e}),t,!1)))},{title:l.get(a),dataIndex:"data",render:(e,t)=>{let n;try{n=JSON.parse(e)}catch(l){n={}}switch(a){case"port":return y.createElement(y.Fragment,null,null==n?void 0:n.port);case"process":return y.createElement(y.Fragment,null,null==n?void 0:n.param);case"script":return(null==n?void 0:n.path)&&(null==n?void 0:n.path.length)>20?y.createElement(M,{placement:"top",title:null==n?void 0:n.path},null==n?void 0:n.path.substring(0,20),"+..."):y.createElement(y.Fragment,null,null==n?void 0:n.path);case"log":return y.createElement(y.Fragment,null,null==n?void 0:n.file_path)}}},{title:n("采集频率"),dataIndex:"step",render:(e,t)=>y.createElement(y.Fragment,null,t.step,"s")},{title:n("备注"),dataIndex:"note",render:e=>y.createElement(y.Fragment,null,e||"")},{title:n("修改人"),dataIndex:"update_by"},{title:n("修改时间"),dataIndex:"update_at",render:e=>y.createElement(y.Fragment,null,Q(1e3*e).format("YYYY-MM-DD HH:mm:ss"))},{title:n("操作"),dataIndex:"operator",render:(l,r)=>y.createElement("div",{className:"table-operator-area"},y.createElement(Ht,i({},Dn.get(a)(n,o(i({},r),{type:a,classpath_name:e}),t,!0,!0))),y.createElement("div",{className:"table-operator-area-warning",onClick:()=>{vn({title:n("是否删除该采集策略?"),onOk:()=>{ma([r.id]).then((()=>{R.success(n("删除成功")),t&&t()}))},onCancel(){}})}},n("删除")))}];return"log"===a&&r.splice(2,1),r},_n=(e,t,a)=>({customizeButton:y.createElement(w,{type:"primary",onClick:()=>{}},a("挂载资源")),modalName:a("挂载资源"),handlePromiseOk:ta,beforePromiseOk:t=>({data:t.data.split("\n"),id:e[0]}),afterPromiseOk:(e,a,n)=>{t()},formLayout:"vertical",children:e=>y.createElement(y.Fragment,null,y.createElement($,{form:e,layout:"vertical",preserve:!1},y.createElement($.Item,{name:"data",label:a("资源标识"),rules:[{required:!0,message:a("请输入资源标识")}]},y.createElement(fn,{placeholder:a("请输入资源标识，每行一个")}))))}),In=({record:e,dispatch:t,ref:a},n)=>({title:y.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},y.createElement("span",null,e.ident),y.createElement(U,{style:{marginLeft:8,cursor:"pointer"},onClick:()=>{Gt(e.ident,n)}})),payload:{dispatch:t,data:e},renderTrigger:({open:t,payload:{dispatch:a}})=>y.createElement("span",{style:{cursor:"pointer",color:"#1473ff",marginRight:16},onClick:()=>{a({type:"resource/getResourceItem",id:e.id}),t()}},e.ident),footer:"",renderContent:()=>y.createElement(Aa,{refs:a}),onConfirm:()=>{var e;return null==(e=null==a?void 0:a.current)||e.refreshList(),Promise.resolve()},width:900}),$n=(e,t,a=!0)=>({modalName:a?e("新建")+e("classpath.single"):e("编辑资源分组"),customizeButton:a?y.createElement("a",{type:"primary"},e("新建资源分组")):y.createElement(K,{title:e("刷新"),style:{marginLeft:"8px",fontSize:"14px"}}),handlePromiseOk:a?Bt:Qt,afterPromiseOk:(e,t,a)=>{a({type:"resource/getGroup",sign:"refresh"})},setFields:async e=>{a||e.setFieldsValue(i({},t))},children:y.createElement(y.Fragment,null,y.createElement($.Item,{name:"path",key:"path",label:e("资源分组路径"),wrapperCol:{span:24},rules:[{required:!0,message:e("资源分组路径必填")}]},y.createElement(F,null)),y.createElement($.Item,{wrapperCol:{span:24},name:"note",key:e("备注"),label:e("资源分组备注")},y.createElement(F,null)),y.createElement($.Item,{name:"id",key:"id",noStyle:!0}))}),Pn=(e,t,a,n=!0,l=!1)=>({customizeButton:n?l?y.createElement("div",{className:"table-operator-area-normal"},e("克隆")):y.createElement(w,{type:"primary"},e("创建进程采集")):y.createElement("div",{className:"table-active-text"},null==t?void 0:t.name),modalName:e(n?"创建进程采集":"进程采集详情"),handlePromiseOk:n?sa:oa,formLayout:"horizontal",setFields:async e=>{if(!n||l){let n;try{n=JSON.parse((null==t?void 0:t.data)||"{}")}catch(a){n={}}e.setFieldsValue(o(i({},t),{method:(null==n?void 0:n.method)||Da.CmdLine,param:(null==n?void 0:n.param)||0,append_tags:""==(null==t?void 0:t.append_tags)?[]:(null==t?void 0:t.append_tags).split(" "),prefix_match:(null==t?void 0:t.prefix_match)===Oa.Need||!1}))}else e.setFieldsValue(i({},t))},beforePromiseOk:e=>(e.data=JSON.stringify({method:e.method,param:e.param}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?Oa.Need:Oa.UnNeed,e),modalProps:{width:800},afterPromiseOk:()=>{a&&a(),R.success(`${e(n?"创建":"更新")}${e("采集规则成功")}`)},children:a=>y.createElement(y.Fragment,null,y.createElement($.Item,{label:e("进程监控指标"),key:"intric"},y.createElement("div",null,"proc_num")),y.createElement($.Item,{label:e("所属资源分组"),rules:[{required:!0,message:e("资源分组必填")}],name:"classpath_id",key:"classpath_id"},y.createElement("div",null,(null==t?void 0:t.classpath_name)||"")),y.createElement($.Item,{valuePropName:"checked",label:e("前缀匹配"),name:"prefix_match",key:"prefix_match"},y.createElement(le,null)),y.createElement($.Item,{label:e("采集名称"),rules:[{required:!0,message:e("采集名称必填")}],name:"name",key:"name"},y.createElement(F,{placeholder:e("请输入采集配置的名称")})),y.createElement($.Item,{label:e("采集方式"),rules:[{required:!0,message:e("采集方式必填")}],name:"method",key:"method",initialValue:Da.CmdLine},y.createElement(ce.Group,{buttonStyle:"solid"},y.createElement(ce.Button,{value:Da.CmdLine},e("命令行")),y.createElement(ce.Button,{value:Da.Name},e("进程名")))),y.createElement($.Item,{noStyle:!0,shouldUpdate:!0,style:{marginBottom:0}},(()=>y.createElement($.Item,o(i({},xn),{name:"param",key:"param",rules:[{required:!0,message:e("该项必填")}],label:"cmdline"===a.getFieldsValue().method?e("命令行"):e("进程名")}),y.createElement(F,{placeholder:"cmdline"===a.getFieldsValue().method?e("取 /proc/$pid/cmdline 中的部分子串，可以唯一标识进程即可"):e("取  /proc/$pid/status 中 name 的值")})))),y.createElement($.Item,{label:e("采集频率"),rules:[{required:!0,message:e("采集频率必填")}],name:"step",key:"step",initialValue:15},y.createElement(Cn,null)),y.createElement($.Item,{label:e("附加标签"),style:{marginTop:20},name:"append_tags"},y.createElement(j,{mode:"tags",onChange:t=>Nn(t,e),placeholder:e("格式为key=value回车分隔"),dropdownStyle:{display:"none"}})),y.createElement($.Item,{label:e("备注"),name:"note",key:"note"},y.createElement(F,null)),y.createElement($.Item,{noStyle:!0,name:"type",key:"type"}),y.createElement($.Item,{noStyle:!0,name:"id",key:"id"}))}),Fn=(e,t,a,n=!0,l=!1)=>({customizeButton:n?l?y.createElement("div",{className:"table-operator-area-normal"},e("克隆")):y.createElement(w,{type:"primary"},e("创建端口采集")):y.createElement("div",{className:"table-active-text"},null==t?void 0:t.name),modalName:e(n?"创建端口采集":"端口采集详情"),handlePromiseOk:n?sa:oa,formLayout:"horizontal",setFields:async e=>{if(!n||l){let n;try{n=JSON.parse((null==t?void 0:t.data)||"{}")}catch(a){n={}}e.setFieldsValue(o(i({},t),{port:(null==n?void 0:n.port)||0,timeout:null==n?void 0:n.timeout,protocol:(null==n?void 0:n.protocol)||qa.TCP,append_tags:""==(null==t?void 0:t.append_tags)?[]:(null==t?void 0:t.append_tags).split(" "),prefix_match:(null==t?void 0:t.prefix_match)===Oa.Need||!1}))}else e.setFieldsValue(i({},t))},beforePromiseOk:e=>(e.data=JSON.stringify({port:e.port,protocol:e.protocol,timeout:e.timeout}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?Oa.Need:Oa.UnNeed,e),afterPromiseOk:()=>{a&&a(),R.success(`${e(n?"创建":"更新")}${e("采集规则成功")}`)},modalProps:{width:800},children:y.createElement(y.Fragment,null,y.createElement($.Item,{label:e("端口监控指标"),key:"intric"},y.createElement("div",null,"proc_port_listen")),y.createElement($.Item,{label:e("所属资源分组"),rules:[{required:!0,message:e("资源分组必填")}],name:"classpath_id",key:"classpath_id"},y.createElement("div",null,(null==t?void 0:t.classpath_name)||"")),y.createElement($.Item,{valuePropName:"checked",label:e("前缀匹配"),name:"prefix_match",key:"prefix_match"},y.createElement(le,null)),y.createElement($.Item,{label:e("采集名称"),rules:[{required:!0,message:e("采集名称必填")}],name:"name",key:"name"},y.createElement(F,{placeholder:e("请输入采集配置的名称")})),y.createElement($.Item,{label:e("端口协议"),rules:[{required:!0,message:e("端口协议必填")}],name:"protocol",key:"protocol",initialValue:qa.TCP},y.createElement(ce.Group,{buttonStyle:"solid"},y.createElement(ce.Button,{value:qa.TCP},"TCP"),y.createElement(ce.Button,{value:qa.UDP},"UDP"))),y.createElement($.Item,{label:e("端口号"),rules:[{required:!0,message:e("端口号必填")}],name:"port",key:"port"},y.createElement(he,{style:{width:150},placeholder:e("请输入端口号")})),y.createElement($.Item,{label:e("连接超时"),rules:[{required:!0,message:e("连接超时必填")}],initialValue:10,name:"timeout",key:"timeout"},y.createElement(bn,null)),y.createElement($.Item,{label:e("采集频率"),rules:[{required:!0,message:e("采集频率必填")}],initialValue:15,name:"step",key:"step"},y.createElement(Cn,null)),y.createElement($.Item,{label:e("附加标签"),style:{marginTop:20},name:"append_tags"},y.createElement(j,{mode:"tags",onChange:t=>Nn(t,e),placeholder:e("格式为key=value回车分隔")})),y.createElement($.Item,{label:e("备注"),name:"note",key:"note"},y.createElement(F,null)),y.createElement($.Item,{noStyle:!0,name:"type",key:"type"}),y.createElement($.Item,{noStyle:!0,name:"id",key:"id"}))}),On=(e,t,a,n=!0,l=!1)=>({customizeButton:n?l?y.createElement("div",{className:"table-operator-area-normal"},e("克隆")):y.createElement(w,{type:"primary"},e("创建插件采集")):y.createElement("div",{className:"table-active-text"},null==t?void 0:t.name),modalName:e(n?"创建插件采集":"插件采集详情"),handlePromiseOk:n?sa:oa,formLayout:"horizontal",setFields:async e=>{if(!n||l){let n;console.log(t,"setFields");try{n=JSON.parse((null==t?void 0:t.data)||"{}"),console.log(n)}catch(a){n={}}n.env&&e.setFieldsValue({env:null==n?void 0:n.env}),e.setFieldsValue(o(i({},t),{timeout:(null==n?void 0:n.timeout)||"",path:(null==n?void 0:n.path)||"",params:(null==n?void 0:n.params)||"",stdin:(null==n?void 0:n.stdin)||"",prefix_match:(null==t?void 0:t.prefix_match)===Oa.Need||!1}))}else e.setFieldsValue(i({},t))},beforePromiseOk:e=>(e.data=JSON.stringify({path:e.path,params:e.params,stdin:e.stdin,env:e.env,timeout:e.timeout}),e.prefix_match=e.prefix_match?Oa.Need:Oa.UnNeed,e),modalProps:{width:800},afterPromiseOk:()=>{a&&a(),R.success(`${e(n?"创建":"更新")}${e("插件采集成功")}`)},children:y.createElement(y.Fragment,null,y.createElement($.Item,{label:e("所属资源分组"),rules:[{required:!0,message:e("资源分组必填")}],name:"classpath_id",key:"classpath_id"},y.createElement("div",null,(null==t?void 0:t.classpath_name)||"")),y.createElement($.Item,{valuePropName:"checked",label:e("前缀匹配"),name:"prefix_match",key:"prefix_match"},y.createElement(le,null)),y.createElement($.Item,{label:e("采集名称"),rules:[{required:!0,message:e("采集名称必填")}],name:"name",key:"name"},y.createElement(F,{placeholder:e("请输入采集配置的名称")})),y.createElement($.Item,{label:e("插件路径"),rules:[{required:!0,message:e("插件路径必填")}],name:"path",key:"path"},y.createElement(F,{placeholder:e("插件路径")})),y.createElement($.Item,{label:e("参数"),name:"params",key:"params"},y.createElement(F,{placeholder:e("请输入参数")})),y.createElement($.Item,{label:e("环境变量"),name:"env",key:"env"},y.createElement(gn,{placeText:e("变量"),isKeyValue:!1})),y.createElement($.Item,{label:e("标准输入(Stdin)"),name:"stdin",key:"stdin"},y.createElement(fn,null)),y.createElement($.Item,{label:e("执行超时"),rules:[{required:!0,message:e("连接超时必填")}],initialValue:15,name:"timeout",key:"timeout"},y.createElement(bn,null)),y.createElement($.Item,{label:e("采集频率"),rules:[{required:!0,message:e("采集频率必填")}],initialValue:60,name:"step",key:"step"},y.createElement(Cn,null)),y.createElement($.Item,{label:e("备注"),name:"note",key:"note"},y.createElement(F,null)),y.createElement($.Item,{noStyle:!0,name:"type",key:"type"}),y.createElement($.Item,{noStyle:!0,name:"id",key:"id"}))}),Tn=(e,t,a,n=!0,l=!1)=>{const r=[{value:"count",key:"count",label:e("count(对符合规则的日志进行计数)"),children:null},{value:"histogram",key:"histogram",label:e("histogram(对符合规则的日志抓取出的数字计算统计值)"),children:null}];return{customizeButton:n?l?y.createElement("div",{className:"table-operator-area-normal"},e("克隆")):y.createElement(w,{type:"primary"},e("创建日志采集")):y.createElement("div",{className:"table-active-text"},null==t?void 0:t.name),modalProps:{width:800},modalName:e(n?"创建日志采集":"日志采集详情"),handlePromiseOk:n?sa:oa,formLayout:"horizontal",setFields:async e=>{var a;let r;if(t.name&&(r=null==(a=null==t?void 0:t.name)?void 0:a.slice(4)),!n||l){let a;try{a=JSON.parse((null==t?void 0:t.data)||"{}")}catch(s){a={}}e.setFieldsValue(o(i({},t),{name:r,file_path:(null==a?void 0:a.file_path)||"",func:(null==a?void 0:a.func)||"",pattern:(null==a?void 0:a.pattern)||"",tags_pattern:(null==a?void 0:a.tags_pattern)||{},append_tags:""==(null==t?void 0:t.append_tags)?[]:(null==t?void 0:t.append_tags).split(" "),prefix_match:(null==t?void 0:t.prefix_match)===Oa.Need||!1}))}else e.setFieldsValue(i({},t))},beforePromiseOk:e=>(e.data=JSON.stringify({file_path:e.file_path,func:e.func,pattern:e.pattern,tags_pattern:e.tags_pattern}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?Oa.Need:Oa.UnNeed,e.name="log_"+e.name,e),afterPromiseOk:()=>{a&&a(),R.success(`${e(n?"创建":"更新")}${e("采集规则成功")}`)},children:a=>y.createElement(y.Fragment,null,y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("所属资源分组"),rules:[{required:!0,message:e("资源分组必填")}],name:"classpath_id",key:"classpath_id"},y.createElement("div",null,(null==t?void 0:t.classpath_name)||"")))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{valuePropName:"checked",label:e("前缀匹配"),name:"prefix_match",key:"prefix_match"},y.createElement(le,null)))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("指标名称"),rules:[{required:!0,message:e("指标名称必填")}],name:"name",key:"name"},y.createElement(F,{addonBefore:"log_",placeholder:e("请输入采集配置的名称")})))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("计算方法"),rules:[{required:!0,message:e("计算方法必填")}],name:"func",key:"func"},y.createElement(j,{placeholder:r[0].label,options:r})))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("日志路径"),rules:[{required:!0,message:e("日志路径必填")}],name:"file_path",key:"file_path"},y.createElement(F,{placeholder:e("请输入日志路径，支持*通配符")}))),y.createElement(W,{style:{lineHeight:"32px"},className:"tooltip-col"})),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("匹配正则"),name:"pattern",key:"pattern",rules:[{required:!0,message:e("匹配正则必填")}]},y.createElement(F,{placeholder:e("请输入正则表达式匹配日志关键字，histogram会提取第一个括号内的值")}))),y.createElement(W,{className:"tooltip-col",style:{lineHeight:"32px"}})),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("标签"),name:"tags_pattern",key:"tags_pattern"},y.createElement(gn,{isKeyValue:!1,placeText:e("标签")}))),y.createElement(W,{style:{lineHeight:"32px"},className:"tooltip-col"})),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("验证"),name:"valiate",key:"valiate"},y.createElement(F,{placeholder:e("请输入一行待监控的完整日志")})))),y.createElement(J,{style:{marginTop:"-12px",marginBottom:"12px",marginRight:"30px"}},y.createElement(W,{offset:6},y.createElement(w,{onClick:()=>{const t=a.getFieldsValue();(function(e){return vt(`${Nt}/api/n9e/log/check`,{method:ft.Post,data:e})})(o(i({},t.tags_pattern),{func:t.func||"",re:t.pattern||"",log:t.valiate||""})).then((t=>{const{dat:a,success:n}=t;if(n){const{success:t,tags:n}=a;vn({icon:t?y.createElement(ge,{style:{color:"#52c41a"}}):y.createElement(ve,{style:{color:"red"}}),zIndex:2001,title:`${e("验证")}${e(t?"通过":"失败")}`,content:y.createElement("div",null,y.createElement($,null,n.map(((e,t)=>y.createElement($.Item,{label:Object.keys(e)[0]},e[Object.keys(e)[0]]))))),okText:e("确定"),cancelText:e("取消")})}}))}},e("验证")))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("附加标签"),style:{marginTop:20},name:"append_tags"},y.createElement(j,{mode:"tags",onChange:t=>Nn(t,e),placeholder:e("格式为key=value回车分隔")})))),y.createElement(J,null,y.createElement(W,{span:23},y.createElement($.Item,{label:e("备注"),name:"note",key:"note"},y.createElement(F,null)))),y.createElement($.Item,{noStyle:!0,name:"type",key:"type"}),y.createElement($.Item,{noStyle:!0,name:"id",key:"id"}))}},Dn=new Map([["port",Fn],["process",Pn],["script",On],["log",Tn]]),Ln=(e,t,a,n,l)=>({muteTimePromiseOK:()=>ra({ids:t,btime:0,etime:0}),customizeButton:y.createElement("div",null,l||n("屏蔽时间")),modalName:n("屏蔽时间"),handlePromiseOk:({pickerData:e})=>ra(i({ids:t},e)),afterPromiseOk:()=>{a&&a()},setFields:async t=>{t.setFieldsValue({pickerData:{btime:e.btime,etime:e.etime}})},modalProps:{width:700},children:y.createElement(y.Fragment,null,y.createElement($.Item,{label:n("选择时间"),name:"pickerData",wrapperCol:{span:24}},y.createElement(hn,{value:e})))}),qn=(e,t,a)=>({customizeButton:y.createElement("a",{style:{marginRight:8,color:"#000"},type:"primary",onClick:()=>{}},a("克隆到其他资源分组")),modalName:a("选择资源分组"),handlePromiseOk:e=>{let t=[];return e.classpath_ids.forEach((a=>{e.res_idents.forEach((e=>{e.classpath_id=a,t.push(JSON.parse(JSON.stringify(e)))}))})),ia(t)},afterPromiseOk:e=>{R.success(a("克隆成功"))},formLayout:"vertical",setFields:async t=>{t.setFieldsValue({res_idents:e})},children:e=>y.createElement(y.Fragment,null,y.createElement($,{form:e,layout:"vertical",preserve:!1},y.createElement($.Item,{name:"classpath_ids",label:a("资源分组"),rules:[{required:!0,message:a("分组不可为空")}]},y.createElement(j,{mode:"multiple",allowClear:!0,size:"middle"},t.map((e=>y.createElement(yn,{key:e.id,title:e.path,value:e.id},e.path))))),y.createElement($.Item,{name:"res_idents"})))}),Rn=(e,t,a)=>({customizeButton:y.createElement("div",null,a("修改备注")),modalName:a("修改备注"),handlePromiseOk:({note:t})=>na({ids:e,note:t}),afterPromiseOk:()=>{t&&t()},setFields:async e=>{},modalProps:{width:700},children:y.createElement(y.Fragment,null,y.createElement($.Item,{label:a("备注"),name:"note",wrapperCol:{span:24}},y.createElement(F,null)))}),Vn=(e,t,a,n)=>({customizeButton:y.createElement("div",null,n("修改标签")),modalName:n("修改标签"),handlePromiseOk:({tags:e})=>la({ids:t,tags:e.join(" ")}),afterPromiseOk:()=>{a&&a()},setFields:async t=>{t.setFieldsValue({tags:e})},modalProps:{width:700},children:y.createElement(y.Fragment,null,y.createElement($.Item,{label:n("标签"),name:"tags",wrapperCol:{span:24}},y.createElement(j,{mode:"tags",placeholder:n("格式为key=value回车分隔"),dropdownStyle:{display:"none"}})))}),Gn=function(e,t=1){return vt(`${Nt}/api/n9e/alert-rule-groups`,{method:ft.Get,params:{query:e,p:t,limit:15}})},An=function(e){return vt(`${Nt}/api/n9e/alert-rule-groups`,{method:ft.Post,data:e})},Mn=function(e){return vt(`${Nt}/api/n9e/alert-rule-group/${e}`,{method:ft.Delete})},Un=function(e){return vt(`${Nt}/api/n9e/alert-rule-group/${e.id}`,{method:ft.Put,data:e})},Hn=function(e){return vt(`${Nt}/api/n9e/alert-rule-group/${e.id}/alert-rules`,{method:ft.Get})},Bn=function(e){return vt(`${Nt}/api/n9e/alert-rule-group/${e}/favorites`,{method:ft.Post,data:{id:e}})},Kn=function(e){return vt(`${Nt}/api/n9e/alert-rule-group/${e}/favorites`,{method:ft.Delete,data:{id:e}})},jn=function(e){return vt(`${Nt}/api/n9e/tag-keys`,{method:ft.Post,data:e})},zn=function(e){return vt(`${Nt}/api/n9e/tag-values`,{method:ft.Post,data:e})},Yn=function(e,t){let a=`${Nt}/api/n9e/alert-rules`;return t&&(a=`${Nt}/api/n9e/alert-rule/${t}`),vt(a,{method:t?ft.Put:ft.Post,data:t?e[0]:e})},Jn=function(e){return vt(`${Nt}/api/n9e/alert-rule/${e}`,{method:ft.Delete})},Wn=function(e){return vt(`${Nt}/api/n9e/alert-events`,{method:ft.Get,params:e})},Qn=function(e){return vt(`${Nt}/api/n9e/alert-events`,{method:ft.Delete,data:{ids:e}})},Xn=function(e,t){return vt(`${Nt}/api/n9e/alert-rules/status`,{method:ft.Put,data:{ids:e,status:t}})},{Option:Zn}=j,el=(e,t,a,n,l)=>({customizeButton:e?y.createElement("a",{type:"primary"},a("strategy.create")):y.createElement(K,{title:a("刷新"),style:{marginLeft:"8px",fontSize:"14px"}}),modalName:a(e?"新建策略分组":"编辑策略组"),setFields:e=>{"string"==typeof(null==n?void 0:n.user_group_ids)&&(n.user_group_ids=n.user_group_ids.length>0?n.user_group_ids.split(" ").map((e=>Number(e))):[]),e.setFieldsValue(n)},handlePromiseOk:e?An:Un,beforePromiseOk:e=>(Array.isArray(e.user_group_ids)&&(e.user_group_ids=e.user_group_ids.join(" ")),e),formLayout:"horizontal",afterPromiseOk:(e,t,a)=>{a({type:"strategy/getGroup",sign:"refresh"}),l&&l()},children:y.createElement(y.Fragment,null,y.createElement($.Item,{name:"name",key:"name",label:a("策略组名称"),rules:[{required:!0,message:a("策略组名称必填")}]},y.createElement(F,{placeholder:a("请填写策略组名称")})),y.createElement($.Item,{name:"user_group_ids",key:"user_group_ids",label:a("管理团队")},y.createElement(j,{mode:"multiple",placeholder:a("请选择团队")},t.map((e=>y.createElement(Zn,{key:e.id,value:e.id},e.name))))),y.createElement($.Item,{name:"id",key:"id",noStyle:!0}))}),tl=function(e={}){return vt(`${Nt}/api/n9e/users`,{method:ft.Get,params:e})},al=function(e={}){return vt(`${Nt}/api/n9e/user-groups`,{method:ft.Get,params:e})},nl=function(e){return vt(`${Nt}/api/n9e/user-group/${e}`,{method:ft.Get}).then((e=>e&&e.dat))},ll=function(e,t){return vt(`${Nt}/api/n9e/user/${e}/status`,{method:ft.Put,data:t}).then((e=>e&&e.dat))},rl=function(){return vt(`${Nt}/api/n9e/notify-channels`,{method:ft.Get}).then((e=>e&&e.dat))},sl=function(){return vt(`${Nt}/api/n9e/contact-channels`,{method:ft.Get}).then((e=>e&&e.dat))};function il(e,t){let a=[],n=e.filter((e=>l(e,t)));function l(e,t){if(e){return(e.children&&e.children.filter((e=>l(e,t)))).length>0?(e.children=e.children&&e.children.filter((e=>l(e,t))),e.children.length>0&&(a.push(e.key),!0)):!!e.title.includes(t)&&(a.push(e.key),!0)}}return a=Array.from(new Set(a)),{queryTree:n,defaultExpandedKeys:a}}const{Option:ol}=j,cl=({treeType:e,isretry:t,query:a,treeHeight:n})=>{const[l,r]=f.exports.useState(!1),[s,i]=f.exports.useState(!1),[o,c]=f.exports.useState([]),[m,u]=f.exports.useState(),[d,p]=f.exports.useState(!1),[h,v]=f.exports.useState([]),[k,b]=f.exports.useState([]),[C,N]=f.exports.useState(),[S,_]=f.exports.useState(!0),[I,O]=f.exports.useState(!1),[T,L]=f.exports.useState(!1),q=g(),{t:G,i18n:A}=E(),[M]=$.useForm(),U=P();f.exports.useEffect((()=>{i(!0),Promise.all([zt(),jt(2e3,1)]).then((e=>{let t=e[0].dat,n=e[1].dat.list;v(n),n=n.map((e=>{let a=!1;return t.forEach((t=>{t.id==e.id&&(a=!0)})),e.isFavorite=!!a,e}));let l=n.map((e=>({path:e.path,id:e.id,isFavorite:e.isFavorite})));if(l=function(e){e.sort();var t=function(e){if(0==e.length||0==e[0].length)return null;if(1==e.length)return e[0];let t,a,n=e.length;for(let l=1;l<n;l++)if(t=e[l].originTitle.length,a=e[l].originTitle,e[0].substring(0,t)==a)return a;return null};function a(e){if(!e.length)return[];let a=[];return e.forEach((e=>{let n,l,r,s=a,i=0;for(;;){if(n=t([e.path,...s]),l=s.find((e=>e.originTitle==n)),!l){r=i?e.path.slice(i):e.path,r=r.replace(/^[\.|\_|\/|\-]{1}/,""),s.push({title:r,originTitle:e.path,key:e.id,children:[],id:e.id,isFavorite:e.isFavorite,icon:e.isFavorite?y.createElement(ye,{onClick:t=>{t.stopPropagation(),H({id:e.id,isFavorite:e.isFavorite})},className:xe("left-tree-item-icon","left-tree-item-icon-active")}):y.createElement(ke,{onClick:t=>{t.stopPropagation(),H({id:e.id,isFavorite:e.isFavorite})},className:"left-tree-item-icon"})});break}i=l.originTitle.length,s=l.children}})),a}let n=a(e);return i(!1),n}(l),c(l),a){p(!1);const{queryTree:e,defaultExpandedKeys:t}=il(l,a);u(e),b(Array.from(new Set([...t,...k]))),L(!0),setTimeout((()=>{p(!0)}),1)}else p(!1),T?(b([]),L(!1)):b(k),u(l);setTimeout((()=>{p(!0)}),1)}))}),[l,t,a]);const H=t=>{U({type:`${e}/changeGroupFavorite`,id:t.id,favorType:t.isFavorite?xt.Delete:xt.Add})},B=()=>{M.validateFields().then((e=>{let t=M.getFieldsValue(),a={path:t.parentStr+t.des+t.sonStr,node:t.note};Bt(a).then((e=>{e.err||(R.success(G("创建成功")),K(),r(!l))}))}))},K=()=>{O(!1),M.resetFields(),N(void 0),localStorage.removeItem("modalExpandedKey")};return y.createElement(y.Fragment,null,y.createElement(z,{spinning:s,wrapperClassName:"Spin",style:{marginTop:150}},d&&y.createElement(fe,{height:n,className:"mytree",showIcon:!0,onExpand:(e,{expanded:t,node:a})=>{!function t(a){a&&a.children&&a.children.forEach((a=>{-1!=e.indexOf(a.key)&&e.splice(e.indexOf(a.key),1),t(a)}))}(a),b(e),_(!1)},expandedKeys:k,autoExpandParent:S,defaultExpandAll:!0,onSelect:(t,a)=>{q.push({pathname:`/${e}/${a.node.id}`});let n=null==h?void 0:h.find((e=>e.id===a.node.id));U({type:`${e}/chooseGroupItem`,data:n})},treeData:m,blockNode:!0,titleRender:e=>y.createElement(y.Fragment,null,y.createElement(D,{trigger:["contextMenu"],placement:"bottomLeft",overlay:y.createElement(x,null,y.createElement(x.Item,{onClick:t=>{N((()=>{let t=[...k];return t.push(e.key),b(t),_(!1),M.setFieldsValue({parentStr:e.originTitle}),e})),setTimeout((()=>{O(!0)}),1)}},y.createElement("a",null,G("新建子节点"))))},y.createElement("span",null,e.title)))})),y.createElement(V,{title:G("新建资源分组"),visible:I,onOk:B,onCancel:K,footer:[y.createElement(w,{key:"back",onClick:K},G("取消")),y.createElement(w,{key:"link",type:"primary",onClick:()=>{M.validateFields().then((e=>{let t=M.getFieldsValue(),a={path:t.parentStr+t.des+t.sonStr,node:t.note};Bt(a).then((e=>{e.err||(R.success(G("创建成功")),r(!l))}))}))}},G("创建")),y.createElement(w,{key:"submit",type:"primary",onClick:B},G("创建并关闭"))]},y.createElement($,{form:M,layout:"vertical",validateTrigger:["onChange","onBlur"]},y.createElement($.Item,{name:"path",key:"path",label:G("资源分组路径"),wrapperCol:{span:24}},y.createElement(F.Group,{compact:!0,className:"compacts",style:{display:"flex"}},y.createElement($.Item,{name:["parentStr"]},y.createElement(F,{disabled:!0})),y.createElement($.Item,{name:"des",initialValue:"-"},y.createElement(j,{style:{width:"50px",margin:"0 5px"}},y.createElement(ol,{value:"/"},"/"),y.createElement(ol,{value:"."},"."),y.createElement(ol,{value:"_"},"_"),y.createElement(ol,{value:"-"},"-"))),y.createElement($.Item,{name:["sonStr"],style:{flex:1},rules:[{required:!0,message:G("资源分组路径必填")},{pattern:/^[^\.|\_|\/|\-]+$/g,message:G("资源分组路径含有非法字符")}]},y.createElement(F,{placeholder:G("资源分组路径")})))),y.createElement($.Item,{wrapperCol:{span:24},name:"note",key:"note",label:G("资源分组备注")},y.createElement(F,null)))))},ml=y.memo((function({item:e,groupType:t,pathKey:a,treeType:n}){var l,r;E();const[s,c]=f.exports.useState(!1),m=P(),u=h((e=>e[n])),[d,p]=f.exports.useState(""),v=g();f.exports.useEffect((()=>{p(e[a])}),[e[a]]);const x=()=>{m({type:`${n}/changeGroupFavorite`,id:e.id,favorType:e.isFavorite?xt.Delete:xt.Add})};return y.createElement(Tt,null,y.createElement("div",{className:xe("left-tree-item",(null==(l=null==u?void 0:u.currentGroup)?void 0:l.id)===e.id&&(null==(r=null==u?void 0:u.currentGroup)?void 0:r.isBelongIn)===t?"left-tree-item-active":""),onClick:()=>{v.push({pathname:`/${n}/${e.id}`}),m({type:`${n}/chooseGroupItem`,data:e})}},e.isFavorite?y.createElement(ye,{onClick:x,className:xe("left-tree-item-icon","left-tree-item-icon-active")}):y.createElement(ke,{onClick:x,className:"left-tree-item-icon"}),s?y.createElement("input",{autoFocus:!0,className:"left-tree-item-input",onChange:e=>{p(e.target.value)},onBlur:()=>{c(!1),d===e[a]||""===d?p(e[a]):m({type:`${n}/updateGroup`,id:e.id,data:o(i({},e),{[a]:d})})},value:d}):y.createElement("div",{className:"left-tree-item-title",title:e[a]||""},e[a]||"")))})),ul=({pathKey:e="path",treeType:t="resource",typeName:a,pageTitle:n})=>{var l;const{t:r,i18n:s}=E(),[o,c]=f.exports.useState(null!==localStorage.getItem("isTree")&&"false"!==localStorage.getItem("isTree")),[m,u]=f.exports.useState(""),[d,p]=f.exports.useState([]),[g,v]=f.exports.useState(null==(l=document.getElementById("treeList"))?void 0:l.offsetHeight);f.exports.useLayoutEffect((()=>{var e;v(null==(e=document.getElementById("treeList"))?void 0:e.offsetHeight)})),f.exports.useRef(null),f.exports.useEffect((()=>{var e;v(null==(e=document.getElementById("treeList"))?void 0:e.offsetHeight),al().then((e=>{var t;p((null==(t=null==e?void 0:e.dat)?void 0:t.list)||[])}))}),[]);const x=be(),{group:{favorite:k,common:b,commonTotal:C,currentPage:N}}=h((e=>e[t])),S=P();f.exports.useEffect((()=>{_()}),[]),f.exports.useEffect((()=>{I(m)}),[o]);const _=()=>{S({type:`${t}/getGroup`,sign:"init",data:(null==x?void 0:x.id)||""})},I=e=>{"resource"===t&&o&&u(e),o&&"resource"===t||S({type:`${t}/getGroup`,sign:"search",data:e})};return y.createElement("div",{className:"left-tree-area"},y.createElement("div",{className:"left-tree-area-item"},y.createElement("div",{className:"left-tree-area-item-title"},r("收藏的"),a),y.createElement("div",{className:"left-tree-area-item-list",style:{maxHeight:146,overflowY:"auto"}},k.map((n=>y.createElement(ml,{key:n.id,isFavorite:!0,item:n,pathKey:e,treeType:t,typeName:a,groupType:bt.Favorite}))))),y.createElement("div",{className:"left-tree-area-item"},y.createElement(J,null,y.createElement(W,{span:16},y.createElement("div",{className:"left-tree-area-item-title"},r("所有"),a)),y.createElement(W,{style:{lineHeight:"38px",textAlign:"right"},span:8},a===r("策略分组")?y.createElement(Ht,i({},el(!0,d,r))):y.createElement(Ht,i({},$n(r))))),"resource"==t?y.createElement(J,{align:"middle"},y.createElement(W,{span:2},y.createElement("div",{style:{cursor:"pointer",paddingTop:8},onClick:e=>{var t;e.stopPropagation(),o&&v(null==(t=document.getElementById("treeList"))?void 0:t.offsetHeight),c((()=>(localStorage.setItem("isTree",JSON.stringify(!o)),!o)))}},o?y.createElement(w,{className:"treeImg",style:{height:32,marginBottom:8,paddingTop:7,padding:"0 5px"}},y.createElement(Ce,{width:20,preview:!1,src:"/image/list.svg"})):y.createElement(w,{className:"treeImg",style:{height:32,marginBottom:8,paddingTop:7,padding:"0 5px"}},y.createElement(Ce,{style:{boxSizing:"border-box",padding:2},width:20,preview:!1,src:"/image/tree.svg"})))),y.createElement(W,{span:20,offset:2},y.createElement(Ot,{className:"left-tree-area-item-input",onSearch:I}))):y.createElement(Ot,{className:"left-tree-area-item-input",onSearch:I})),y.createElement("div",{id:"treeList",className:"left-tree-area-item",style:{flex:1,overflowY:"auto"}},y.createElement("div",{className:"left-tree-area-item-list"},o&&"resource"===t?y.createElement(cl,{treeHeight:g,query:m,isretry:b,treeType:t}):b.map((n=>y.createElement(ml,{key:n.id,isFavorite:!1,item:n,groupType:bt.Common,pathKey:e,treeType:t,typeName:a})))),o&&"resource"===t?null:15*N<C?y.createElement(Ne,{className:"load-more",onClick:()=>{S({type:`${t}/getGroup`,sign:"append"})}}):null))},{TabPane:dl}=we,{confirm:pl}=V,El=()=>{var e,t;const{t:a}=E(),n=h((e=>e.resource)),[l,r]=f.exports.useState(Sn(a)[0].key),s=P();return y.createElement("div",{className:"resource-table-content"},y.createElement("div",null,y.createElement("div",{className:"resource-table-title"},y.createElement("div",{className:"resource-table-title-label"},(null==(e=null==n?void 0:n.currentGroup)?void 0:e.path)||"",y.createElement(Ht,i({},$n(a,(null==n?void 0:n.currentGroup)||{},!1))),n&&y.createElement(Se,{onClick:e=>{e.stopPropagation(),pl({title:a("是否确定删除资源分组?"),icon:y.createElement(B,null),onOk:()=>{var e;s({type:"resource/deleteGroup",id:null==(e=null==n?void 0:n.currentGroup)?void 0:e.id})},onCancel(){}})},style:{marginLeft:8}})),y.createElement("div",{className:"resource-table-title-sub"},y.createElement(le,{checked:Boolean(n.prefix),onChange:e=>{s({type:"resource/updatePrefix",data:e.target.checked?Oa.Need:Oa.UnNeed})},style:{color:"rgb(102, 102, 102)"}},a("分组名称前缀匹配(聚合展示所有相关分组的内容)")),y.createElement("div",{className:"resource-table-title-sub-item"},a("备注"),"：",(null==(t=null==n?void 0:n.currentGroup)?void 0:t.note)||""))),y.createElement(we,{activeKey:l,onChange:r},Sn(a).map((e=>y.createElement(dl,{tab:e.title,key:e.key},y.createElement(e.component,{currentKey:e.key,activeKey:l,isIdent:!0})))))))};const hl=()=>{const{t:e}=E();return y.createElement(Ft,{title:e("资源管理"),icon:y.createElement(b,null)},y.createElement("div",{className:"resource-content"},y.createElement(ul,{pageTitle:e("资源管理"),typeName:e("资源分组")}),y.createElement(El,null)))};var gl,vl,fl,yl,xl,kl,bl,Cl,Nl,Sl,wl,_l;(vl=gl||(gl={}))[vl.n9e=0]="n9e",vl[vl.prometheus=1]="prometheus",(yl=fl||(fl={}))[yl.Enable=0]="Enable",yl[yl.UnEnable=1]="UnEnable",(kl=xl||(xl={}))[kl.Send=0]="Send",kl[kl.UnSend=1]="UnSend",(Cl=bl||(bl={}))[Cl.First=1]="First",Cl[Cl.Second=2]="Second",Cl[Cl.Third=3]="Third",(Sl=Nl||(Nl={}))[Sl.Favorite=0]="Favorite",Sl[Sl.Common=1]="Common",(_l=wl||(wl={})).add="add",_l.edit="edit";const Il=e=>{var t=e,{text:a}=t,n=c(t,["text"]);return E(),Array.from(a).reduce(((e,t)=>e+t.charCodeAt(0)),0),y.createElement(H,i({color:"blue"},n),a)};const{TextArea:$l}=F;var Pl,Fl;function Ol(e){const{t:t}=E(),a=f.exports.useRef(null),{status:n,title:l,exportData:r,description:s,onClose:i,onSubmit:o}=e,[c]=$.useForm();return y.createElement(V,{title:n===Pl.Export?t("导出")+l:t("导入")+l,destroyOnClose:!0,footer:n===Pl.Import&&y.createElement(y.Fragment,null,y.createElement(w,{key:"delete",onClick:()=>i()},t("取消")),y.createElement(w,{key:"submit",type:"primary",onClick:async()=>{await c.validateFields();const e=c.getFieldsValue();await o(e.import),R.success(t("导入成功")),i()}},t("确定"))),onCancel:()=>i(),visible:"hide"!==n},y.createElement("p",{style:{color:"#999"}},s,n===Pl.Export&&y.createElement("a",{onClick:()=>{Vt([r],"download.json")}},"Download.json")),(()=>{switch(n){case Pl.Export:return y.createElement("div",{contentEditable:"true",suppressContentEditableWarning:!0,ref:a,className:"export-dialog"},y.createElement("pre",null,r));case Pl.Import:return y.createElement($,{form:c,preserve:!1},y.createElement($.Item,{name:"import",rules:[{required:!0,message:t("请输入")+l,validateTrigger:"trigger"}]},y.createElement($l,{placeholder:t("请输入")+l,rows:4})))}})())}(Fl=Pl||(Pl={})).Import="import",Fl.Export="export",Fl.None="hide";const{Option:Tl}=j,{confirm:Dl}=V,Ll=Object.fromEntries(["append_tags","callbacks","create_by","group_id","id","notify_groups","notify_users","update_at","update_by"].map((e=>[e,void 0]))),ql=()=>{var e;const{t:t,i18n:a}=E(),n=g(),l=f.exports.useRef(null),r=P();f.exports.useRef(null);const[s,c]=f.exports.useState(Pl.None),[m,u]=f.exports.useState([]),[d,p]=f.exports.useState(!1),[v,x]=f.exports.useState([]),[k,b]=f.exports.useState([]),[C,N]=f.exports.useState(""),[S,_]=f.exports.useState({}),{currentGroup:I}=h((e=>e.strategy)),[$,F]=f.exports.useState([]),[O,T]=f.exports.useState("");f.exports.useState(!1);const[q,G]=f.exports.useState([]),[A,M]=f.exports.useState(!1),[U,K]=f.exports.useState(""),[z,Y]=f.exports.useState([]),[X,Z]=f.exports.useState(1),[ee,te]=f.exports.useState(0),[ae,ne]=f.exports.useState(""),[re,se]=f.exports.useState([]),[ie,oe]=f.exports.useState([]),[me,ue]=f.exports.useState(""),[de,pe]=f.exports.useState(""),[Ee,he]=f.exports.useState([]),[ge,ve]=f.exports.useState("");f.exports.useEffect((()=>{al().then((e=>{se(e.dat.list)})),tl().then((e=>{oe(e.dat.list)})),rl().then((e=>{he(e)}))}),[]),f.exports.useEffect((()=>{Na("alert_rule").then((e=>{F(e.dat)})),al().then((e=>{var t;u((null==(t=null==e?void 0:e.dat)?void 0:t.list)||[])}))}),[]),f.exports.useEffect((()=>{(null==I?void 0:I.id)&&(fe(),p(!0))}),[null==I?void 0:I.id]);const fe=()=>{var e;(null==I?void 0:I.id)&&(e=I.id,vt(`${Nt}/api/n9e/alert-rule-group/${e}`,{method:ft.Get})).then((e=>{const{success:t,dat:a}=e;t&&_(a)}))},ye=(e,t=!1)=>{(null==I?void 0:I.id)&&n.push(`/strategy/edit/${e}${t?"?mode=clone":""}`)},xe=()=>{l.current.refreshList()},ke=[{title:t("级别"),dataIndex:"priority",render:e=>y.createElement(H,{color:Lt[e-1]},"P",e)},{title:t("名称"),dataIndex:"name",render:(e,t)=>y.createElement("div",{className:"table-active-text",onClick:()=>{ye(t.id)}},e)},{title:t("告警接收者"),dataIndex:"notify_users_detail",render:(e,t)=>{const a=e.concat(t.notify_groups_detail).filter((e=>!!e));return a.length&&a.map(((e,t)=>y.createElement(Il,{text:e.nickname||e.username||e.name,key:t})))||y.createElement("div",null)}},{title:t("附加标签"),dataIndex:"append_tags",render:e=>{const t=e?e.split(" "):[];return t.length&&t.map(((e,t)=>y.createElement(Il,{text:e,key:t})))||y.createElement("div",null)}},{title:t("更新时间"),dataIndex:"update_at",render:e=>Q(1e3*Number(e)).format("YYYY-MM-DD HH:mm:ss")},{title:t("状态"),dataIndex:"status",render:(e,t)=>y.createElement(_e,{checked:e===fl.Enable,size:"small",onChange:()=>{const{id:e,status:a}=t;Xn([e],a===fl.Enable?fl.UnEnable:fl.Enable).then((()=>{xe()}))}})},{title:t("操作"),dataIndex:"operator",render:(e,a)=>y.createElement("div",{className:"table-operator-area"},y.createElement("div",{className:"table-operator-area-normal",onClick:()=>{ye(a.id,!0)}},t("克隆")),y.createElement("div",{className:"table-operator-area-warning",onClick:()=>{Dl({title:t("是否删除该告警规则?"),onOk:()=>{Jn(a.id).then((()=>{R.success(t("删除成功")),xe()}))},onCancel(){}})}},t("删除")))}],be=f.exports.useCallback((()=>el(!1,m,t,o(i({},S),{id:null==I?void 0:I.id}),(()=>{fe()}))),[m,S,null==I?void 0:I.id]),Ce=(e,t,a=!1)=>{if(a){let a=e.map((e=>e[t].split(" ")));return Array.from(new Set(a.toString().replace(/\,+/g," ").trim().split(" "))).join(" ")}{let a=new Set(e.map((e=>e[t])).join(" ").split(" "));return Array.from(a).join(" ").trim().replace(/\s+/g," ")}},Ne=(e,a)=>{if(0==v.length)return void R.warning(t("请先选择策略"));console.log(q);let n=[];q.forEach(((e,t)=>{-1!==v.indexOf(e.id)&&n.push(e)}));let l=n.map((e=>e.id)),r=Ce(n,"notify_users"),s=Ce(n,"notify_groups"),i=Ce(n,"notify_channels",!0),o=Ce(n,"append_tags",!0);console.log(s,"notifyGroups"),Y(l),ne(r),ue(s),pe(i),ve(o),te(a),K(e),M(!0)},we=re.map(((e,t)=>y.createElement(Tl,{value:e.id,key:t},e.name))),Ie=ie.map(((e,t)=>y.createElement(Tl,{value:e.id,key:t},e.username))),$e=Ee.map(((e,t)=>y.createElement(le,{value:e,key:t},e))),Pe=(e,t)=>{ue(e.join(" "))},Fe=(e,t)=>{ne(e.join(" "))},Oe=e=>{console.log(e),pe(e.join(" "))},Te=e=>{let a=e[e.length-1];if(a&&!/\w+=\w+/.test(a)){let a=e.pop();R.error(`"${a}"${t("不符合输入规范(格式为key=value)")}`)}ve(e.join(" "))},De=f.exports.useMemo((()=>y.createElement("ul",{className:"ant-dropdown-menu"},y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>c(Pl.Import)},y.createElement("span",null,t("导入"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{if(k.length){const e=k.map((e=>i(i({},e),Ll)));N(JSON.stringify(e,null,2)),c(Pl.Export)}else R.warning(t("未选择任何采集策略"))}},y.createElement("span",null,t("导出"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{v.length?Dl({title:t("是否批量删除告警规则?"),onOk:()=>{(function(e,t){return vt(`${Nt}/api/n9e/alert-rule-group/${e}/alert-rules`,{method:ft.Delete,data:{ids:t}})})(null==I?void 0:I.id,v).then((()=>{R.success(t("删除成功")),xe()}))},onCancel(){}}):R.warning(t("未选择任何采集策略"))}},y.createElement("span",null,t("批量删除"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{Ne(t("修改告警接受者"),1)}},y.createElement("span",null,t("修改告警接受者"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{Ne(t("通知媒介"),2)}},y.createElement("span",null,t("修改通知媒介"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{Ne(t("策略启用控制"),3)}},y.createElement("span",null,t("策略启用控制"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>{Ne(t("附加标签"),4)}},y.createElement("span",null,t("修改附加标签"))))),[v,q,t]),Le=y.createElement("ul",{className:"ant-dropdown-menu"},$.map(((e,t)=>y.createElement("li",{className:"ant-dropdown-menu-item",key:t},y.createElement("span",{onClick:()=>qe(e)},e))))),qe=async e=>{let{dat:t}=await Sa("alert_rule",e);await Yn(t.map((e=>o(i({},e),{group_id:null==I?void 0:I.id})))),xe()};return y.createElement("div",{className:"strategy-table-content"},y.createElement("div",{className:"strategy-table-title"},y.createElement("div",{className:"strategy-table-title-label"},(null==I?void 0:I.name)||"",y.createElement(Ht,i({},be())),I&&y.createElement(Se,{onClick:e=>{e.stopPropagation(),Dl({title:t("是否确定删除该策略分组?"),icon:y.createElement(B,null),onOk:()=>{r({type:"strategy/deleteGroup",id:null==I?void 0:I.id})},onCancel(){}})},style:{marginLeft:8}})),y.createElement("div",{className:"strategy-table-title-sub"},y.createElement("div",{className:"strategy-table-title-sub-item"},t("管理团队"),"：",(null==(e=null==S?void 0:S.user_groups)?void 0:e.map((e=>e.name)).join(" "))||"-"))),y.createElement("div",{className:"strategy-table-search table-handle"},y.createElement("div",{className:"strategy-table-search-left"},y.createElement(on,{className:"strategy-table-search-left-refresh",onClick:()=>{xe()}}),y.createElement(Ot,{className:"searchInput",placeholder:t("请输入告警策略名称"),onSearch:T,allowClear:!0})),y.createElement("div",{className:"strategy-table-search-right"},y.createElement(w,{type:"primary",onClick:()=>{(null==I?void 0:I.id)&&n.push(`/strategy/add/${I.id}`)},className:"strategy-table-search-right-create"},t("新建告警策略")),y.createElement("div",{className:"table-more-options"},y.createElement(D,{overlay:Le,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation()},t("导入内置策略"),y.createElement(L,{style:{marginLeft:2}}))),y.createElement(D,{overlay:De,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation()},t("更多操作"),y.createElement(L,{style:{marginLeft:2}})))))),y.createElement(da,{ref:l,rowKey:"id",columns:ke,fetchParams:{id:(null==I?void 0:I.id)||"",query:O},onFetchList:e=>{G(e)},fePaging:!0,autoFetch:!1,initFetch:d,feQueryParams:["name"],fetchHandle:Hn,rowSelection:{selectedRowKeys:v,onChange:(e,t)=>{x(e),console.log(e,"selectedRowKeys"),b(t)}}}),y.createElement(Ol,{status:s,onClose:()=>c(Pl.None),onSubmit:e=>{try{let t=JSON.parse(e);return Yn(t.map((e=>o(i({},e),{group_id:null==I?void 0:I.id})))).then((()=>xe()))}catch(t){return Promise.reject(t)}},title:t("策略"),exportData:C}),y.createElement(V,{title:U,visible:A,onOk:()=>{switch(ee){case 1:(function(e,t,a){return vt(`${Nt}/api/n9e/alert-rules/notify-groups`,{method:ft.Put,data:{ids:e,notify_groups:t,notify_users:a}})})([...z],me,ae).then((()=>{M(!1),R.success(t("修改接受者成功")),xe()}));break;case 2:(function(e,t){return vt(`${Nt}/api/n9e/alert-rules/notify-channels`,{method:ft.Put,data:{ids:e,notify_channels:t}})})([...z],de).then((()=>{M(!1),R.success(t("修改媒介成功")),xe()}));break;case 3:Xn([...z],X===fl.Enable?fl.UnEnable:fl.Enable).then((()=>{M(!1),R.success(t("修改启停成功")),xe()}));break;case 4:(function(e,t){return vt(`${Nt}/api/n9e/alert-rules/append-tags`,{method:ft.Put,data:{ids:e,append_tags:t}})})([...z],ge).then((()=>{M(!1),R.success(t("修改附加标签成功")),xe()}))}},onCancel:()=>{M(!1)}},(()=>{switch(ee){case 1:return y.createElement(y.Fragment,null,y.createElement(J,{align:"middle"},y.createElement(W,{span:4,style:{textAlign:"center"}},y.createElement("span",null,t("报警接收团队"),":")),y.createElement(W,{span:20},y.createElement(j,{value:me?me.split(" ").map((e=>Number(e))):[],mode:"multiple",onChange:Pe,style:{width:"90%",marginLeft:10}},we))),y.createElement(J,{style:{marginTop:10},align:"middle"},y.createElement(W,{span:4,style:{textAlign:"center"}},y.createElement("span",null,t("报警接收人"),":")),y.createElement(W,{span:20},y.createElement(j,{value:ae?ae.split(" ").map((e=>Number(e))):[],mode:"multiple",onChange:Fe,style:{width:"90%",marginLeft:10}},Ie))));case 2:return y.createElement(y.Fragment,null,y.createElement(J,{align:"middle"},y.createElement(W,{span:4},y.createElement("span",null,t("修改通知媒介"),":")),y.createElement(W,{span:20},y.createElement(le.Group,{style:{marginLeft:10},defaultValue:de.split(" "),onChange:Oe},$e))));case 3:return y.createElement(y.Fragment,null,y.createElement(J,{align:"middle"},y.createElement(W,{span:4,style:{textAlign:"center"}},y.createElement("span",null,t("是否启停"),":")),y.createElement(W,{span:20},y.createElement(ce.Group,{style:{marginLeft:10,textAlign:"center"},onChange:e=>{Z(e.target.value)},value:X},y.createElement(ce,{value:fl.Enable},t("否")),y.createElement(ce,{value:fl.UnEnable},t("是"))))));case 4:return y.createElement(y.Fragment,null,y.createElement(J,{align:"middle"},y.createElement(W,{span:4,style:{textAlign:"center"}},y.createElement("span",null,t("append_tags"),":")),y.createElement(W,{span:20},y.createElement(j,{style:{width:"90%",marginLeft:10},mode:"tags",value:ge?ge.split(" "):[],onChange:Te,placeholder:t("请输入附加标签，格式为key=value")}))));default:return null}})()))};const Rl=()=>{const{t:e}=E();return y.createElement(Ft,{title:e("告警策略"),icon:y.createElement(C,null)},y.createElement("div",{className:"strategy-content"},y.createElement(ul,{typeName:e("策略分组"),pathKey:"name",treeType:"strategy"}),y.createElement(ql,null)))};function Vl(){const{t:e}=E(),[t]=$.useForm(),a=()=>{const{oldpass:a,newpass:n}=t.getFieldsValue();(function(e,t){return vt(`${Nt}/api/n9e/self/password`,{method:ft.Put,data:{oldpass:e,newpass:t}})})(a,n).then((t=>{console.log(t),R.success(e("修改密码成功"))}))};return y.createElement($,{form:t,layout:"vertical",requiredMark:!0},y.createElement($.Item,{label:y.createElement("span",null,e("旧密码"),":"),required:!0,name:"oldpass",rules:[{required:!0,message:e("请输入旧密码")}]},y.createElement(F,{placeholder:e("请输入旧密码")})),y.createElement($.Item,{label:y.createElement("span",null,e("新密码"),":"),required:!0,name:"newpass",rules:[{required:!0,message:e("请输入新密码")}]},y.createElement(F,{placeholder:e("请输入新密码")})),y.createElement($.Item,{label:y.createElement("span",null,e("确认密码"),": "),required:!0,name:"newpassagain",rules:[{required:!0,message:e("再次输入新密码")}]},y.createElement(F,{placeholder:e("再次输入新密码")})),y.createElement($.Item,null,y.createElement(w,{type:"primary",onClick:async()=>{try{await t.validateFields(),a()}catch{console.log(e("输入有误"))}}},e("确认修改"))))}const{Option:Gl}=j;function Al(){const{t:e}=E(),[t]=$.useForm(),[a,n]=f.exports.useState(!1),[l,r]=f.exports.useState([]);let{profile:s}=h((e=>e.account));const[m,u]=f.exports.useState(s.portrait||"/image/avatar1.png"),[d,p]=f.exports.useState(""),g=P();f.exports.useEffect((()=>{const{id:e,nickname:a,email:n,phone:l,contacts:r,portrait:i}=s;t.setFieldsValue({nickname:a,email:n,phone:l,contacts:r}),i.startsWith("http")&&p(i)}),[s]),f.exports.useEffect((()=>{sl().then((e=>{r(e)}))}),[]);const v=async()=>{try{await t.validateFields(),x()}catch(a){console.log(e("输入有误"),a)}},x=()=>{const{nickname:a,email:n,phone:l,moreContacts:r}=t.getFieldsValue();let{contacts:c}=t.getFieldsValue();r&&r.length>0&&r.forEach((e=>{const{key:t,value:a}=e;t&&a&&(c?c[t]=a:c={[t]:a})}));for(let e in c)c[e]||delete c[e];g({type:"account/updateProfile",data:o(i({},s),{portrait:d||m,nickname:a,email:n,phone:l,contacts:c})}),R.success(e("信息保存成功"))},k=new Array(8).fill(0).map(((e,t)=>t+1));return y.createElement(y.Fragment,null,y.createElement($,{form:t,layout:"vertical"},y.createElement(J,{gutter:16,style:{marginBottom:"24px"}},y.createElement(W,{span:20},y.createElement(J,{gutter:16,style:{marginBottom:"24px"}},y.createElement(W,{span:4},y.createElement("div",null,y.createElement("label",null,e("用户名"),"："),y.createElement("span",null,s.username))),y.createElement(W,{span:4},y.createElement("div",null,y.createElement("label",null,e("角色"),"："),y.createElement("span",null,s.roles.join(", "))))),y.createElement($.Item,{label:y.createElement("span",null,e("显示名"),"："),name:"nickname"},y.createElement(F,{placeholder:e("请输入显示名")})),y.createElement($.Item,{label:y.createElement("span",null,e("邮箱"),"："),name:"email"},y.createElement(F,{placeholder:e("请输入邮箱")})),y.createElement($.Item,{label:y.createElement("span",null,e("手机"),"："),name:"phone"},y.createElement(F,{placeholder:e("请输入手机号")})),s.contacts&&Object.keys(s.contacts).sort().map(((t,a)=>{let n=l.find((e=>e.key===t));return y.createElement(y.Fragment,null,n?y.createElement($.Item,{label:n.label+"：",name:["contacts",t],key:a},y.createElement(F,{placeholder:`${e("请输入")}${t}`})):null)})),y.createElement($.Item,{label:e("更多联系方式")},y.createElement($.List,{name:"moreContacts"},((t,{add:a,remove:n})=>y.createElement(y.Fragment,null,t.map((t=>{var a=t,{key:r,name:s,fieldKey:m}=a,u=c(a,["key","name","fieldKey"]);return y.createElement(Ie,{key:r,style:{display:"flex"},align:"baseline"},y.createElement($.Item,o(i({style:{width:"180px"}},u),{name:[s,"key"],fieldKey:[m,"key"],rules:[{required:!0,message:e("联系方式不能为空")}]}),y.createElement(j,{placeholder:e("请选择联系方式")},l.map(((e,t)=>y.createElement(Gl,{value:e.key,key:t},e.label))))),y.createElement($.Item,o(i({},u),{style:{width:"330px"},name:[s,"value"],fieldKey:[m,"value"],rules:[{required:!0,message:e("值不能为空")}]}),y.createElement(F,{placeholder:e("请输入值")})),y.createElement(pe,{className:"control-icon-normal",onClick:()=>n(s)}))})),y.createElement(Ee,{className:"control-icon-normal",onClick:()=>a()}))))),y.createElement($.Item,null,y.createElement(w,{type:"primary",onClick:v},e("确认修改")))),y.createElement(W,{span:4},y.createElement("div",{className:"avatar"},y.createElement("img",{src:s.portrait||"/image/avatar1.png"}),y.createElement(w,{type:"primary",className:"update-avatar",onClick:()=>n(!0)},e("更换头像")))))),y.createElement(V,{title:e("更换头像"),visible:a,onOk:()=>{if(d){if(!d.startsWith("http"))return void R.error(e("自定义头像需以http开头"));fetch(d).then((e=>{n(!1),v()})).catch((t=>{R.error(e("自定义头像")+t)}))}else n(!1),v()},onCancel:()=>{n(!1)},wrapClassName:"avatar-modal"},y.createElement("div",{className:"avatar-content"},k.map((e=>y.createElement("div",{key:e,className:`/image/avatar${e}.png`===m?"avatar active":"avatar",onClick:()=>(e=>{u(`/image/avatar${e}.png`)})(e)},y.createElement("img",{src:`/image/avatar${e}.png`}))))),y.createElement(F,{addonBefore:y.createElement("span",null,e("头像URL"),":"),onChange:e=>p(e.target.value),value:d})))}const Ml=function(e){return vt(`${Nt}/api/n9e/self/profile`,{method:ft.Put,data:e})},Ul=function(){return vt(`${Nt}/api/n9e/self/profile`,{method:ft.Get})},Hl="api/n9e/self/token";function Bl(){const{t:e}=E(),[t,a]=f.exports.useState([]);f.exports.useEffect((()=>{l()}),[]);const n=async t=>{await function(e){return vt(`${Nt}/${Hl}`,{method:ft.Put,data:e})}({token:t}),R.success(e("Token更新成功")),l()},l=()=>{vt(`${Nt}/${Hl}`,{method:ft.Get}).then((e=>{e.err||a(e.dat)}))},r=[{title:"Token",dataIndex:"token"},{title:e("操作"),key:"action",render:(t,a)=>y.createElement(Ie,{size:"middle"},y.createElement("a",{onClick:()=>n(a.token)},e("重新生成")))}];return y.createElement(y.Fragment,null,y.createElement(A,{columns:r,dataSource:t,pagination:!1,rowKey:e=>e.token}),t.length<2&&y.createElement(w,{onClick:async()=>{await vt(`${Nt}/${Hl}`,{method:ft.Post}),R.success(e("Token创建成功")),l()},style:{marginTop:10}},e("生成")))}const{TabPane:Kl}=we;function jl(){const{t:e}=E(),{tab:t}=be(),a=g();return y.createElement(Ft,{title:e("个人中心")},y.createElement(we,{activeKey:t,className:"profile",onChange:e=>{a.push("/account/profile/"+e)}},y.createElement(Kl,{tab:e("personalInfo"),key:"info"},y.createElement(Al,null)),y.createElement(Kl,{tab:e("修改密码"),key:"pwd"},y.createElement(Vl,null)),y.createElement(Kl,{tab:e("秘钥管理"),key:"secret"},y.createElement(Bl,null))))}const{confirm:zl}=V;function Yl(){const{t:e}=E(),[t]=$.useForm(),a=f.exports.useRef(null),n=g(),[l,r]=f.exports.useState(!1),[s,c]=f.exports.useState(Pl.None),[m,u]=f.exports.useState([]),[d,h]=f.exports.useState(""),[v,x]=f.exports.useState(!1),[k,b]=f.exports.useState(""),[C,N]=f.exports.useState([]),[S,_]=f.exports.useState(""),[I,P]=f.exports.useState();f.exports.useEffect((()=>{Na("dashboard").then((e=>{N(e.dat)}))}),[]);const O=async()=>{let{name:e,tags:a}=t.getFieldsValue();return n={name:e,tags:a&&a.length>0?a.join(" "):""},vt(`${Nt}/api/n9e/dashboards`,{method:ft.Post,data:n});var n},T=async()=>{if(null==I?void 0:I.id){const{dat:a}=await ya(null==I?void 0:I.id);let{name:n,tags:l}=t.getFieldsValue();return e=Object.assign(I,{name:n,tags:l&&l.length>0?l.join(" "):""},{configs:a.configs}),vt(`${Nt}/api/n9e/dashboards-clone`,{method:ft.Post,data:e})}throw new Error("没有选择大盘");var e},G=[{title:e("大盘名称"),dataIndex:"name",render:(e,t)=>(E(),y.createElement("div",{className:"table-active-text",onClick:()=>n.push("/dashboard/"+t.id)},e))},{title:e("分类标签"),dataIndex:"tags",render:e=>y.createElement(y.Fragment,null,e.split(" ").map(((e,t)=>e?y.createElement(H,{color:"blue",key:t,style:{cursor:"pointer"},onClick:()=>(e=>{(k.length>0?k.split(" "):[]).includes(e)||(b((t=>t+" "+e)),_((t=>t+" "+e)))})(e)},e):null)))},{title:e("更新时间"),dataIndex:"update_at",render:e=>Q(1e3*e).format("YYYY-MM-DD HH:mm:ss")},{title:e("发布人"),dataIndex:"create_by"},{title:e("操作"),width:"240px",render:(n,l)=>y.createElement("div",{className:"table-operator-area"},y.createElement("div",{className:"table-operator-area-normal",onClick:()=>(e=>{const{id:a,name:n,tags:l}=e,s="Copy of "+n;t.setFieldsValue({name:s,tags:l.length>0?l.split(" "):[]}),P({id:a}),r(!0),x(!0)})(l)},e("克隆")),y.createElement("div",{className:"table-operator-area-warning",onClick:async()=>{zl({title:`${e("是否删除大盘")}?${l.name}`,onOk:async()=>{var t,n;await(n=l.id,vt(`${Nt}/api/n9e/dashboard/${n}`,{method:ft.Delete})),R.success(e("删除大盘成功")),null==(t=null==a?void 0:a.current)||t.refreshList()},onCancel(){}})}},e("删除")))}],A=y.createElement("ul",{className:"ant-dropdown-menu"},y.createElement("li",{className:"ant-dropdown-menu-item",onClick:()=>c(Pl.Import)},y.createElement("span",null,e("导入"))),y.createElement("li",{className:"ant-dropdown-menu-item",onClick:async()=>{if(m.length){let e=await(t=m,vt(`${Nt}/api/n9e/dashboards/export`,{method:ft.Post,data:{ids:t}}));h(JSON.stringify(e.dat,null,2)),c(Pl.Export)}else R.warning(e("未选择任何大盘"));var t}},y.createElement("span",null,e("导出")))),M=y.createElement("ul",{className:"ant-dropdown-menu"},C.map(((e,t)=>y.createElement("li",{className:"ant-dropdown-menu-item",key:t},y.createElement("span",{onClick:()=>(async e=>{var t;let{dat:n}=await Sa("dashboard",e);await fa(n),null==(t=null==a?void 0:a.current)||t.refreshList()})(e)},e)))));return y.createElement(Ft,{title:e("监控大盘"),icon:y.createElement($e,null)},y.createElement("div",{className:"dashboard"},y.createElement("div",{className:"table-handle"},y.createElement("div",{className:"table-handle-search"},y.createElement(F,{onPressEnter:e=>{let t=e.target.value;_(t)},className:"searchInput",value:k,onChange:e=>b(e.target.value),prefix:y.createElement(q,null),placeholder:e("大盘名称")})),y.createElement("div",{className:"table-handle-buttons"},y.createElement(w,{type:"primary",onClick:()=>{r(!0)}},e("新建大盘")),y.createElement("div",{className:"table-more-options"},y.createElement(D,{overlay:M,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation()},e("导入内置大盘"),y.createElement(L,{style:{marginLeft:2}}))),y.createElement(D,{overlay:A,trigger:["click"]},y.createElement(w,{onClick:e=>e.stopPropagation()},e("更多操作"),y.createElement(L,{style:{marginLeft:2}})))))),y.createElement(da,{ref:a,fetchHandle:va,fetchParams:{query:S},className:"dashboard-table",columns:G,rowKey:"id",rowSelection:{selectedRowKeys:m,onChange:e=>{u(e)}}})),y.createElement(V,{title:e(v?"克隆监控大盘":"创建新监控大盘"),visible:l,onOk:async()=>{var n;await t.validateFields(),v?(await T(),R.success(e("克隆大盘成功"))):(await O(),R.success(e("新建大盘成功"))),null==(n=null==a?void 0:a.current)||n.refreshList(),r(!1),x(!1)},onCancel:()=>{r(!1)}},y.createElement($,o(i({},{labelCol:{span:4},wrapperCol:{span:16}}),{form:t}),y.createElement($.Item,{label:e("大盘名称"),name:"name",wrapperCol:{span:24},rules:[{required:!0,message:e("请输入大盘名称")}]},y.createElement(F,null)),y.createElement($.Item,{wrapperCol:{span:24},label:e("分类标签"),name:"tags"},y.createElement(j,{mode:"tags",dropdownStyle:{display:"none"},placeholder:e("请输入分类标签(请用回车分割)")})))),y.createElement(Ol,{status:s,onClose:()=>c(Pl.None),onSubmit:t=>{try{let e=JSON.parse(t);return fa(e).then((()=>{var e;return null==(e=null==a?void 0:a.current)?void 0:e.refreshList()}))}catch(n){return p.error({message:(null==n?void 0:n.message)||e("您的网络发生异常，无法连接服务器")}),Promise.reject(n)}},title:e("大盘"),exportData:d}))}function Jl(){const{t:e}=E(),{ids:t}=be(),[a,n]=f.exports.useState(),[l,r]=f.exports.useState(),[s,c]=f.exports.useState(15);f.exports.useEffect((()=>{m()}),[]);const m=()=>{(function(e){return vt(`${Nt}/api/n9e/charts/tmps?ids=${e}`,{method:ft.Get})})(t).then((e=>{try{let t=e.dat.filter((e=>!!e)).map((e=>JSON.parse(e.configs)));n(t)}catch(t){console.log(t)}}))};return y.createElement("div",{className:"chart-container"},a&&a.length>0?y.createElement(y.Fragment,null,y.createElement("div",{className:"chart-container-header"},y.createElement(nn,{onChange:e=>{r(e)},initValue:a[0].options.range}),y.createElement(mn,{onChange:e=>c(e),initialValue:s}),y.createElement(on,{onClick:()=>{m()},className:"reload-icon"})),a.map(((e,t)=>{const a=l?o(i({},e.options),{range:l}):e.options;return y.createElement(rn,{key:t,options:o(i({},a),{step:s}),title:e.title})}))):y.createElement("h2",{className:"holder"},y.createElement(Pe,{style:{fontSize:"30px"}}),y.createElement("span",null,e("该分享链接无图表数据"))))}const Wl=Fe.exports.WidthProvider(Fe.exports.Responsive),{Panel:Ql}=Te,{confirm:Xl}=V,Zl={lg:[{x:0,y:0,w:6,h:6,i:"0"},{x:6,y:0,w:6,h:6,i:"1"},{x:12,y:0,w:6,h:6,i:"2"}],sm:[{x:0,y:0,w:6,h:6,i:"0"},{x:6,y:0,w:6,h:6,i:"1"},{x:12,y:0,w:6,h:6,i:"2"}],md:[{x:0,y:0,w:6,h:6,i:"0"},{x:6,y:0,w:6,h:6,i:"1"},{x:12,y:0,w:6,h:6,i:"2"}],xs:[{x:0,y:0,w:6,h:6,i:"0"},{x:6,y:0,w:6,h:6,i:"1"},{x:12,y:0,w:6,h:6,i:"2"}],xxs:[{x:0,y:0,w:6,h:6,i:"0"},{x:6,y:0,w:6,h:6,i:"1"},{x:12,y:0,w:6,h:6,i:"2"}]};function er(e){const{t:t}=E(),{groupInfo:a,range:n,step:l,variableConfig:r,onAddChart:s,onUpdateChart:c,onDelChartGroup:m,onDelChart:u,onUpdateChartGroup:d,onMoveUpChartGroup:p,onMoveDownChartGroup:h}=e,[g,v]=f.exports.useState([]),[k,b]=f.exports.useState(Zl),[N,S]=f.exports.useState(!1);f.exports.useEffect((()=>{_()}),[a.updateTime]);const _=()=>{var e;S(!1),(e=a.id,vt(`${Nt}/api/n9e/chart-group/${e}/charts`,{method:ft.Get})).then((e=>{const t=(e.dat?e.dat.map((e=>{let t=e.configs?JSON.parse(e.configs):{};return{id:e.id,configs:t,weight:e.weight}})):[]).filter((e=>e.configs.metric||e.configs.prome_ql)),a=t.map(((e,a)=>e.configs.layout?(e.configs.layout.i=""+a,e.configs.layout):I(t.slice(0,a).map((e=>e.configs.layout)),Number(a))));b({lg:a,sm:a,md:a,xs:a,xxs:a}),v(t),S(!0)}))},I=function(e,t){const a=new Array;e.forEach((e=>{if(e){const{w:t,h:n,x:l,y:r}=e;for(let e=0;e<n;e++){void 0===a[e+r]&&(a[e+r]=new Array(24).fill(0));for(let n=0;n<t;n++)a[e+r][n+l]=1}}}));let n=-1,l=-1;for(let s=0;s<a.length;s++)void 0===a[s]&&(a[s]=new Array(24).fill(0));function r(e,t){let n=!0;for(let l=e;l<e+6;l++)for(let e=t;e<t+2;e++)a[l]&&a[l][e]&&(n=!1);return n}for(let s=0;s<a.length-1;s++)for(let e=0;e<=18;e++)if(r(s,e)){l=s,n=e;break}return-1===n&&(n=0,l=a.length),{w:6,h:2,x:n,y:l,i:""+t}},$=async e=>{let t=g.map(((t,a)=>{const{h:n,w:l,x:r,y:s,i:i}=e[a];return t.configs.layout={h:n,w:l,x:r,y:s,i:i},t}));ba(t)};function P(e){e.domEvent.stopPropagation(),((e,t=24/e,n=2)=>{let l=0,r=0;const s=[];[...k.lg].forEach(((a,o)=>{let c=i({},a);if(o+1>e){let t=(o+1)/e;r=Math.trunc(t)*n}c.w=t,c.h=n,c.x=l,c.y=r,l+=c.w,(o+1)%e==0&&(l=0),s.push(c)}));let o=g.map(((e,t)=>{const{h:a,w:n,x:l,y:r,i:i}=s[t];return e.configs.layout={h:a,w:n,x:l,y:r,i:i},e}));ba(o),b({lg:[...s],sm:[...s],md:[...s],xs:[...s],xxs:[...s]}),v(o),a.updateTime=Date.now()})(Number(e.key))}function F(){const{t:e}=E();let t=[];for(let a=1;a<=4;a++){let n=y.createElement(x.Item,{key:a},a,e("列"));t.push(n)}return y.createElement(x,{onClick:P},t)}const O=f.exports.useCallback((()=>(E(),y.createElement("div",{style:{width:"100%"}},g&&g.length>0?y.createElement(Wl,{cols:{lg:24,sm:24,md:24,xs:24,xxs:24},layouts:k,onLayoutChange:$,measureBeforeMount:!1,useCSSTransforms:!1,preventCollision:!1,isBounded:!0,draggableHandle:".chart-title"},g&&g.length>0&&g.map(((e,s)=>{const{metric:m,tags:d={}}=e.configs;let p,E,{prome_ql:h}=e.configs,v=Object.keys(d).filter((e=>d[e])).reduce(((e,t)=>e.concat(d[t].map((e=>({key:t,value:e}))))),[]);return r&&(r.tags.forEach((e=>{if(h)Array.isArray(h)&&(h=h.map((t=>"*"===e.value?t.replaceAll("$"+e.key,".+"):t.replaceAll("$"+e.key,e.value))));else if(!v.find((t=>t.key===e.key))&&"*"!==e.value){const{key:t,value:a}=e;v.push({key:t,value:a})}})),p="*"===r.classpath_id?void 0:r.classpath_id,E="*"===r.classpath_id?void 0:r.classpath_prefix),y.createElement("div",{style:{border:"1px solid #e0dee2"},key:String(s)},y.createElement(rn,{barControl:"multiOrSort",title:g[s].configs.name,rightBar:y.createElement(y.Fragment,null,y.createElement(w,{type:"link",size:"small",onClick:t=>{t.preventDefault(),window.open(e.configs.link)},disabled:!e.configs.link},y.createElement(Oe,null)),y.createElement(D,{trigger:["click"],overlay:y.createElement(x,null,y.createElement(x.Item,{onClick:()=>c(a,e)},t("编辑图表")),y.createElement(x.Item,{danger:!0,onClick:()=>{Xl({title:`${t("是否删除图表")}：${e.configs.name}`,onOk:async()=>{u(a,e)},onCancel(){}})}},t("删除图表")))},y.createElement(w,{type:"link",size:"small",onClick:e=>e.preventDefault()},y.createElement(C,null)))),options:o(i({classpath_id:p,classpath_prefix:void 0===E?void 0:!!E},e.configs),{prome_ql:h,range:n,step:l,tags:v,metric:m,limit:50})}))}))):y.createElement("p",{className:"empty-group-holder"},"Now it is empty")))),[N,a.updateTime,n,r,l]);return y.createElement(Te,{defaultActiveKey:["0"]},y.createElement(Ql,{header:y.createElement("span",{className:"panel-title"},a.name),key:"0",extra:(()=>{const{t:e}=E();return y.createElement(y.Fragment,null,y.createElement(w,{type:"link",size:"small",onClick:e=>{e.stopPropagation(),s(a.id)}},e("新增图表")),y.createElement(De,{type:"vertical"}),y.createElement(D,{overlay:F()},y.createElement(w,{type:"link",size:"small",onClick:e=>{e.stopPropagation()}},e("一键规整"),y.createElement(L,null))),y.createElement(De,{type:"vertical"}),y.createElement(w,{type:"link",size:"small",onClick:e=>{e.stopPropagation(),d(a)}},e("修改")),y.createElement(De,{type:"vertical"}),y.createElement(w,{type:"link",size:"small",onClick:e=>{e.stopPropagation(),p(a)}},e("上移")),y.createElement(De,{type:"vertical"}),y.createElement(w,{type:"link",size:"small",onClick:e=>{e.stopPropagation(),h(a)}},e("下移")),y.createElement(De,{type:"vertical"}),y.createElement(w,{type:"link",size:"small",onClick:t=>{t.stopPropagation(),Xl({title:`${e("是否删除分类")}：${a.name}`,onOk:async()=>{m(a.id)},onCancel(){}})}},e("删除")))})()},O()))}const{Option:tr}=j;function ar(e){const{t:t}=E(),{groupId:a,show:n,onVisibleChange:l,initialValue:r}=e,s=null==r?void 0:r.configs.layout,[m]=$.useForm(),[u,d]=f.exports.useState([]),[p,h]=f.exports.useState([]),[g,v]=f.exports.useState([]),[x,k]=f.exports.useState(),[b,C]=f.exports.useState([]);f.exports.useState();const[N,S]=f.exports.useState([]),[w,_]=f.exports.useState([""]);f.exports.useEffect((()=>{I(),L(),O(),r&&(m.setFieldsValue(r.configs),r.configs.metric&&P(r.configs.metric)),_(m.getFieldValue("prome_ql"))}),[r]);const I=e=>{Ua({limit:150,metric:e}).then((e=>{e.dat.metrics&&d(e.dat.metrics)}))},P=e=>{h(e);let t=e.map((e=>({metric:e})));Ma({limit:200,params:t}).then((e=>{e.dat.tags&&S(Qa(e.dat.tags))}))},O=()=>{Zt().then((e=>{C(e.dat.list||[])}))},T=X.exports.debounce((e=>{e.length>0&&e.length<4||I(e)}),500),D=X.exports.debounce((e=>{L(e)}),500),L=e=>{Kt(e).then((e=>{e.dat.list&&v(e.dat.list)}))},q=async(e,t)=>{let a=await Ca(t);return a.dat.ql_correct?Promise.resolve():Promise.reject(new Error(`${a.dat.parse_error}`))};return y.createElement(V,{title:t(r?"编辑图表":"新建图表"),visible:n,destroyOnClose:!0,onOk:async e=>{try{await m.validateFields();let e=Object.assign(m.getFieldsValue(),{layout:s});r&&r.id?await(t=r.id,n={configs:JSON.stringify(e),weight:0},vt(`${Nt}/api/n9e/chart/${t}`,{method:ft.Put,data:n})):await function(e,t){return vt(`${Nt}/api/n9e/chart-group/${e}/charts`,{method:ft.Post,data:t})}(a,{configs:JSON.stringify(e),weight:0}),l(!0)}catch(i){console.log("Failed:",i)}var t,n},onCancel:()=>{l(!1)}},y.createElement($,o(i({},s),{form:m,preserve:!1}),y.createElement($.Item,{label:t("标题"),name:"name",labelCol:{span:4},wrapperCol:{span:20},rules:[{required:!0,message:t("图表名称")}]},y.createElement(F,null)),y.createElement($.Item,{label:t("配置方式"),name:"mode",initialValue:"nightingale",labelCol:{span:4},wrapperCol:{span:20}},y.createElement(ce.Group,null,y.createElement(ce,{value:"nightingale"},"nightingale"),y.createElement(ce,{value:"prometheus"},"prometheus"))),y.createElement($.Item,{shouldUpdate:!0,wrapperCol:{span:24},style:{marginBottom:"0px"}},(()=>"nightingale"===m.getFieldValue("mode")?y.createElement(y.Fragment,null,y.createElement($.Item,{label:t("指标"),name:"metric",labelCol:{span:4},wrapperCol:{span:20},rules:[{required:!0,message:t("请选择指标")}]},y.createElement(j,{mode:"multiple",style:{width:"100%"},placeholder:t("请输入监控指标(输入4个以上字符发起检索)"),value:p,onChange:P,onSearch:T,filterOption:!1},u.map(((e,t)=>y.createElement(tr,{key:t,value:e.name},e.name," ",e.description))))),y.createElement($.Item,{label:t("资源分组"),name:"classpath_id",labelCol:{span:4},wrapperCol:{span:20}},y.createElement(j,{style:{width:"100%"},placeholder:t("请选择资源分组"),value:x,onChange:e=>k(e),onSearch:D,filterOption:!1,showSearch:!0,allowClear:!0},g.map(((e,t)=>y.createElement(tr,{key:t,value:e.id},e.path))))),y.createElement($.Item,{label:t("前缀匹配"),name:"classpath_prefix",labelCol:{span:4},wrapperCol:{span:20},valuePropName:"checked"},y.createElement(le,null)),N.map(((e,t)=>y.createElement($.Item,{key:t,label:e.tagKey,name:["tags",e.tagKey],labelCol:{span:4},wrapperCol:{span:20}},y.createElement(j,{style:{width:"100%"},allowClear:!0,mode:"multiple"},e.tagValue.map(((e,t)=>y.createElement(tr,{key:t,value:e},e)))))))):y.createElement($.Item,{label:"Promql",labelCol:{span:4},style:{marginBottom:0}},y.createElement($.List,{name:"prome_ql",initialValue:w},((e,{add:a,remove:n},{errors:l})=>y.createElement(y.Fragment,null,e.length?e.map(((l,r)=>{var s=l,{key:i,name:o,fieldKey:u}=s;c(s,["key","name","fieldKey"]);return y.createElement(Ie,{key:o,style:{display:"flex",marginBottom:8},align:"baseline"},y.createElement($.Item,{name:[o],validateTrigger:["onChange","onBlur"],rules:[{validator:q}]},y.createElement(F,{placeholder:t("请输入Promql"),onChange:()=>{_(m.getFieldValue("prome_ql").filter((e=>void 0!==e)))},style:{width:"340px"}})),e.length>1?y.createElement(pe,{onClick:()=>{n(o),_(m.getFieldValue("prome_ql").filter((e=>void 0!==e)))}}):null,r===e.length-1&&y.createElement(Ee,{onClick:()=>{a()}}))})):y.createElement(Ee,{onClick:()=>{a()}}),y.createElement($.ErrorList,{errors:l}))))))),y.createElement($.Item,{label:t("阈值"),name:"yplotline",labelCol:{span:4},wrapperCol:{span:20}},y.createElement(he,null)),y.createElement($.Item,{label:t("下钻链接"),name:"link",labelCol:{span:4},wrapperCol:{span:20}},y.createElement(F,null))))}const nr=f.exports.createContext({}),lr={path:"*",id:-1,isFavorite:!1,create_at:0,create_by:0,update_at:0,update_by:0,isBelongIn:bt.Common,note:"",preset:0},rr=e=>{let t=[],a=[],n=[],l=[],r=[],s=!1;const i=new Map,o=new Map;e.forEach(((e,t)=>{const{tagName:r,key:c,value:m}=e,u=i.get(r);void 0===u?i.set(r,[t]):i.set(r,[...u,t]);const d=o.get(c);void 0===d?o.set(c,[t]):o.set(c,[...d,t]),""===r&&a.push(t),"classpath"!==c&&"classpath_prefix"!==c||(s=!0),/^\w+$/g.test(r)||n.push(t),""!==c&&""!==m||l.push(t)}));for(let c of i.values())Array.isArray(c)&&c.length>1&&(t=t.concat(c));for(let c of o.values())Array.isArray(c)&&c.length>1&&(r=r.concat(c));return{duplicateList:t,duplicateKeyList:r,nonNameList:a,invalidList:n,hasClassPath:s,requireList:l}},sr=function(e,t){switch(t.type){case"init_data":return o(i(i({},e),t.data),{hasInit:!0});case"add_item":{const t=[...e.tagList,{tagName:"var",key:"",value:"*",prefix:!1}];return i(o(i({},e),{tagList:t}),rr(t))}case"update_item":{const a=e.tagList;return a[t.index]=t.data,i(o(i({},e),{tagList:a}),rr(a))}case"delete_item":return e.tagList.splice(t.index,1),i(o(i({},e),{tagList:e.tagList}),rr(e.tagList));default:return e}},{Option:ir}=j,or=({tagData:e,index:t,isEditing:a})=>{const{t:n}=E(),l=n("必须要有一个变量名"),r=n("变量名重复"),s=n("变量名包含非法字符"),c=n("key, value必填"),m=n("key重复"),u="*",d="classpath",p="classpath",h="classpath_prefix",[g,v]=f.exports.useContext(nr),[x,k]=f.exports.useState([p]),[b,C]=f.exports.useState((()=>e.key===p||e.key===h?[lr]:[u])),[N,S]=f.exports.useState(!1),[w,_]=f.exports.useState(!1),[I,$]=f.exports.useState(!1),[P,O]=f.exports.useState("");f.exports.useEffect((()=>{let e="";Array.isArray(g.nonNameList)&&g.nonNameList.includes(t)?e=l:Array.isArray(g.requireList)&&g.requireList.includes(t)?e=c:Array.isArray(g.invalidList)&&g.invalidList.includes(t)?e=s:Array.isArray(g.duplicateList)&&g.duplicateList.includes(t)?e=r:Array.isArray(g.duplicateKeyList)&&g.duplicateKeyList.includes(t)&&(e=m),O(e)}),[JSON.stringify(g.duplicateList),JSON.stringify(g.duplicateKeyList),JSON.stringify(g.nonNameList),JSON.stringify(g.invalidList),JSON.stringify(g.requireList),n]),f.exports.useEffect((()=>{e.key!==p&&e.key!==h||1!==b.length||V()}),[e.value,e.key]);const T=a=>{$(!0),C([u]),v({type:"update_item",index:t,data:o(i({},e),{key:a,value:u})})},D=a=>{const n=a.target.value;v({type:"update_item",index:t,data:o(i({},e),{tagName:n})}),n&&P===l&&O("")},L=()=>{R("")},q=X.exports.debounce((e=>{R(e)}),500),R=(a="")=>{const n=!g.tagList.find(((e,a)=>a!==t&&e.key.includes(d)))&&0===d.indexOf(a);S(!0),function(e){return vt(`${Nt}/api/n9e/tag-keys`,{method:ft.Post,data:e})}({limit:150,tag_key:a,params:[{metric:e.metric}]}).then((e=>{e.dat.keys&&k(n?[p,h,...e.dat.keys]:[...e.dat.keys])})).finally((()=>{S(!1)}))},V=(t="")=>new Promise((a=>{if(e.key)if(_(!0),e.key===p||e.key===h)Kt(t).then((e=>{C([lr,...e.dat.list])})).finally((()=>{_(!1)}));else{const n=g.tagList.filter((t=>"*"!==t.value&&t.key!==e.key&&!t.key.includes(d))).map((({key:e,value:t})=>({key:e,value:t})));(function(e){return vt(`${Nt}/api/n9e/tag-values`,{method:ft.Post,data:e})})({limit:150,tag_key:e.key,tag_value:t,params:[{metric:e.metric}],tags:n.length>0?n:void 0}).then((e=>{e.dat.values&&(a(""),C([u,...e.dat.values]))})).finally((()=>{_(!1)}))}})),G=X.exports.debounce((e=>{e?V(e):C([u])}),500),A=a=>{v({type:"update_item",index:t,data:o(i({},e),{value:a})})},M=()=>{1===b.length&&V().then((()=>{$(!1)}))},U=()=>{v({type:"delete_item",index:t})},H=a=>{v({type:"update_item",index:t,data:o(i({},e),{value:"",key:"",metric:a})})};return y.createElement(y.Fragment,null,a?y.createElement(J,{gutter:[6,6],className:"tag-content-item"},y.createElement(W,{span:3},y.createElement(F,{value:e.tagName,onChange:D})),y.createElement(W,{span:6},y.createElement(Ka,{onChange:H,multiple:!1,value:e.metric})),y.createElement(W,{span:4},y.createElement(j,{style:{width:"100%"},disabled:!e.metric,onSearch:q,onChange:T,defaultActiveFirstOption:!1,showSearch:!0,loading:N,value:e.key,onClick:L,dropdownClassName:"overflow-230",placeholder:n("任意标签/资源分组")},x.map(((e,t)=>y.createElement(ir,{key:t,value:e},e))))),y.createElement(W,{span:4},y.createElement(j,{style:{width:"100%"},disabled:!e.metric,onSearch:G,onChange:A,defaultActiveFirstOption:!1,showSearch:!0,loading:w,value:e.value,placeholder:n("任意标签/资源分组"),onClick:M,dropdownClassName:"overflow-586"},e.key===p||e.key===h?b.map(((e,t)=>y.createElement(ir,{key:t+1e3,value:e.id},e.path))):b.map(((e,t)=>y.createElement(ir,{key:t,value:e},e))))),y.createElement(W,{span:1},y.createElement(Se,{onClick:U,className:"icon"})),P&&y.createElement(W,{span:5},y.createElement("div",{className:"error-tips"},y.createElement("span",null,P)))):y.createElement("div",{className:"tag-content-close-item"},y.createElement("div",{className:"tag-content-close-item-tagName"},"$",e.tagName),y.createElement(j,{style:{width:"180px"},onSearch:G,onChange:A,defaultActiveFirstOption:!1,showSearch:!0,loading:w,value:e.value,placeholder:n("任意标签/资源分组"),onClick:M,dropdownClassName:"overflow-586"},e.key===p||e.key===h?b.map(((e,t)=>y.createElement(ir,{key:t+1e3,value:e.id},e.path))):b.map((e=>y.createElement(ir,{key:e,value:e},e))))))};var cr=y.forwardRef((({isOpen:e=!1,onChange:t},a)=>{const{t:n}=E(),[l,r]=f.exports.useState(e),[s,i]=f.exports.useReducer(sr,{tagList:[],duplicateList:[],invalidList:[],nonNameList:[],duplicateKeyList:[],requireList:[],hasClassPath:!1,hasInit:!1});f.exports.useEffect((()=>{if(!l&&s.hasInit){const e=c();t&&t(e)}}),[JSON.stringify(s.tagList)]);const o=e=>{const t=m(e);i({type:"init_data",data:t})},c=()=>{const{tagList:e}=s,t=[];let a;return e.forEach((e=>{const{key:n}=e;"classpath"!==n&&"classpath_prefix"!==n?t.push(e):a=e})),a?{tags:t,metric:a.metric,classpath_tagName:(null==a?void 0:a.tagName)||"",classpath_id:(null==a?void 0:a.value)?null==a?void 0:a.value:0,classpath_prefix:"classpath_prefix"===(null==a?void 0:a.key)?1:"classpath"===(null==a?void 0:a.key)?0:void 0}:{tags:t}},m=e=>{let t;try{const a=JSON.parse(e),{tags:n,classpath_id:l,classpath_prefix:r,classpath_tagName:s,metric:i}=a;t=void 0!==l&&void 0!==r&&void 0!==s?{tagList:n.concat({tagName:s,key:"classpath",value:l,metric:i,prefix:1===r}),hasClassPath:!0}:{tagList:n}}catch(a){t={tagList:[]}}return t},u=()=>{r(!0)},d=f.exports.useMemo((()=>{if(!s)return!0;const{duplicateList:e,nonNameList:t,invalidList:a,duplicateKeyList:n,requireList:l}=s;return 0===e.length&&0===n.length&&0===l.length&&0===t.length&&0===a.length}),[JSON.stringify(s.duplicateList),JSON.stringify(s.duplicateKeyList),JSON.stringify(s.nonNameList),JSON.stringify(s.invalidList),JSON.stringify(s.requireList)]);return f.exports.useImperativeHandle(a,(()=>({setInitData:o}))),y.createElement(nr.Provider,{value:[s,i]},y.createElement("div",{className:"tag-area"},l?y.createElement(J,{gutter:[6,6],className:"tag-header"},y.createElement(W,{span:3},n("变量名")),y.createElement(W,{span:6},"Filter metric"),y.createElement(W,{span:4},n("标签或资源分组")),y.createElement(W,{span:4},n("默认值"))):null,y.createElement("div",{className:xe("tag-content",l?"":"tag-content-close")},s.tagList.map(((e,t)=>y.createElement(or,{isEditing:l,key:t,tagData:e,index:t}))),l?null:Array.isArray(s.tagList)&&s.tagList.length?y.createElement(K,{className:"icon",onClick:u}):y.createElement("div",{className:"add-variable-tips",onClick:u},n("添加大盘变量"))),l?y.createElement("div",{className:"tag-control-area"},y.createElement(w,{onClick:function(){i({type:"add_item"})},icon:y.createElement(Le,null)},n("添加变量")),y.createElement(w,{type:"primary",disabled:!d,onClick:()=>{r(!1);const e=c();t&&t(e)}},n("完成"))):null))}));const mr={labelCol:{span:4},wrapperCol:{span:16}};let ur,dr=!0;function pr(){const{t:e}=E(),{id:t}=be(),[a]=$.useForm(),n=g(),l=f.exports.useRef(null),[r,s]=f.exports.useState({create_by:"",favorite:0,id:0,name:"",tags:"",update_at:0,update_by:""}),[c,m]=f.exports.useState(15),[u,d]=f.exports.useState(!1),[p,h]=f.exports.useState([]),[v,x]=f.exports.useState(null),[k,b]=f.exports.useState(!1),[C,N]=f.exports.useState(!1),[S,_]=f.exports.useState(),[I,P]=f.exports.useState({start:0,end:0});f.exports.useEffect((()=>{O()}),[]);const O=()=>{ya(t).then((e=>{s(e.dat),e.dat.configs&&(x(JSON.parse(e.dat.configs)),l.current&&l.current.setInitData(e.dat.configs))})),function(e){return vt(`${Nt}/api/n9e/dashboard/${e}/chart-groups`,{method:ft.Get})}(t).then((e=>{let t=e.dat||[];h(t.sort(((e,t)=>e-t)).map((e=>(e.updateTime=Date.now(),e))))}))},D=e=>{ur=e,N(!0)},L=(e,t)=>{ur=e.id,_(t),N(!0)},q=(e,t)=>{ur=e.id,function(e){vt(`${Nt}/api/n9e/chart/${e}`,{method:ft.Delete})}(t.id),H()},G=e=>{ur=e.id,dr=!1,b(!0)},A=async e=>{const{weight:t}=e;let a=p.find((e=>e.weight===t-1));a&&(a.weight=t,e.weight=t-1,await ka([a,e]),O())},M=async e=>{const{weight:t}=e;let a=p.find((e=>e.weight===t+1));a&&(a.weight=t,e.weight=t+1,await ka([a,e]),O())},U=async t=>{await function(e){return vt(`${Nt}/api/n9e/chart-group/${e}`,{method:ft.Delete})}(t),R.success(e("删除分组成功")),O(),b(!1)},H=()=>{let e=p.findIndex((e=>e.id===ur));if(e<0)return;let t=[...p];t[e].updateTime=Date.now(),h(t)};return y.createElement(Ft,{customArea:y.createElement("div",{className:"dashboard-detail-header"},y.createElement("div",{className:"dashboard-detail-header-left"},y.createElement(T,{className:"back",onClick:()=>n.push("/dashboard")}),u?y.createElement(F,{defaultValue:r.name,onPressEnter:async e=>{await xa(t,o(i({},r),{name:e.target.value})),await O(),d(!1)}}):y.createElement("div",{className:"title"},r.name),y.createElement(K,{className:"edit",onClick:()=>{d(!u)}})),y.createElement("div",{className:"dashboard-detail-header-right"},y.createElement(nn,{onChange:e=>{P(e)}}),y.createElement(mn,{onChange:e=>m(e),initialValue:c}),y.createElement(on,{onClick:()=>{O()}})))},y.createElement("div",{className:"dashboard-detail-content"},y.createElement("div",{className:"variable-area"},y.createElement(w,{type:"link",icon:y.createElement(qe,null),style:{paddingRight:0},onClick:()=>b(!0)},e("新增图表分组")),y.createElement(De,{type:"vertical",style:{height:32}}),y.createElement(cr,{ref:l,onChange:e=>{xa(t,o(i({},r),{configs:JSON.stringify(e)})),x(e)}})),y.createElement("div",{className:"charts"},p.map(((e,t)=>y.createElement(er,{key:t,step:c,groupInfo:e,onAddChart:D,onUpdateChart:L,onUpdateChartGroup:G,onMoveUpChartGroup:A,onMoveDownChartGroup:M,onDelChart:q,onDelChartGroup:U,range:I,variableConfig:v}))))),y.createElement(V,{title:e(dr?"新建分组":"更新分组名称"),visible:k,onOk:async()=>{await a.validateFields();let e=a.getFieldsValue();if(dr){let a=p.map((e=>e.weight)),n=Math.max(...a)+1;await function(e,t){return vt(`${Nt}/api/n9e/dashboard/${e}/chart-groups`,{method:ft.Post,data:t})}(t,o(i({},e),{weight:n}))}else{let t=p.find((e=>e.id===ur));await ka([i(i({},t),e)])}O(),dr=!0,b(!1)},onCancel:()=>{b(!1)}},y.createElement($,o(i({},mr),{form:a}),y.createElement($.Item,{label:e("分组名称"),name:"name",rules:[{required:!0,message:e("请输入名称")}]},y.createElement(F,null)))),C&&y.createElement(ar,{initialValue:S,groupId:ur,show:C,onVisibleChange:e=>{N(!1),_(null),e&&H()}}))}const Er={labelCol:{span:4},wrapperCol:{span:20}},{Option:hr}=j,gr=y.forwardRef(((e,t)=>{const{t:a}=E(),{userId:n}=e,[l]=$.useForm(),[r,s]=f.exports.useState(),[m,u]=f.exports.useState(!0),[d,p]=f.exports.useState([]),h=[{value:"Admin",label:a("管理员")},{value:"Standard",label:a("普通用户")},{value:"Guest",label:a("游客")}];f.exports.useImperativeHandle(t,(()=>({form:l}))),f.exports.useEffect((()=>{n?v(n):u(!1),g()}),[]);const g=()=>{sl().then((e=>{p(e)}))},v=e=>{(function(e){return vt(`${Nt}/api/n9e/user/${e}/profile`,{method:ft.Get}).then((e=>e&&e.dat))})(e).then((e=>{let t=[];e.contacts&&Object.keys(e.contacts).forEach((a=>{let n={key:a,value:e.contacts[a]};t.push(n)})),s(Object.assign({},e,{contacts:t})),u(!1)}))};return m?null:y.createElement($,o(i({},Er),{form:l,initialValues:r,preserve:!1}),!n&&y.createElement($.Item,{label:a("用户名"),name:"username",rules:[{required:!0,message:a("用户名不能为空！")}]},y.createElement(F,null)),y.createElement($.Item,{label:a("显示名"),name:"nickname"},y.createElement(F,null)),!n&&y.createElement(y.Fragment,null,y.createElement($.Item,{name:"password",label:a("密码"),rules:[{required:!0,message:a("请输入密码!")}],hasFeedback:!0},y.createElement(F.Password,null)),y.createElement($.Item,{name:"confirm",label:a("确认密码"),dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:a("请确认密码!")},({getFieldValue:e})=>({validator:(t,a)=>a&&e("password")!==a?Promise.reject(new Error("密码不一致!")):Promise.resolve()})]},y.createElement(F.Password,null))),y.createElement($.Item,{label:a("角色"),name:"roles",rules:[{required:!0,message:a("角色不能为空！")}]},y.createElement(j,{mode:"multiple"},h.map(((e,t)=>y.createElement(hr,{value:e.value,key:t},e.value))))),y.createElement($.Item,{label:a("邮箱"),name:"email"},y.createElement(F,null)),y.createElement($.Item,{label:a("手机"),name:"phone"},y.createElement(F,null)),y.createElement($.Item,{label:a("更多联系方式")},y.createElement($.List,{name:"contacts"},((e,{add:t,remove:n})=>y.createElement(y.Fragment,null,e.map((e=>{var t=e,{key:l,name:r,fieldKey:s}=t,m=c(t,["key","name","fieldKey"]);return y.createElement(Ie,{key:l,style:{display:"flex"},align:"baseline"},y.createElement($.Item,o(i({style:{width:"180px"}},m),{name:[r,"key"],fieldKey:[s,"key"],rules:[{required:!0,message:a("联系方式不能为空")}]}),y.createElement(j,{placeholder:a("请选择联系方式")},d.map(((e,t)=>y.createElement(hr,{value:e.key,key:t},e.label))))),y.createElement($.Item,o(i({},m),{style:{width:"330px"},name:[r,"value"],fieldKey:[s,"value"],rules:[{required:!0,message:a("值不能为空")}]}),y.createElement(F,{placeholder:a("请输入值")})),y.createElement(pe,{className:"control-icon-normal",onClick:()=>n(r)}))})),y.createElement(Ee,{className:"control-icon-normal",onClick:()=>t()}))))))})),vr=y.forwardRef(((e,t)=>{const{t:a}=E(),{teamId:n}=e,[l]=$.useForm(),[r,s]=f.exports.useState(),[c,m]=f.exports.useState(!0);f.exports.useImperativeHandle(t,(()=>({form:l}))),f.exports.useEffect((()=>{n?u(n):m(!1)}),[]);const u=e=>{nl(e).then((e=>{s(e.user_group),m(!1)}))};return c?null:y.createElement($,o(i({},Er),{form:l,initialValues:r,preserve:!1}),y.createElement($.Item,{label:a("团队名称"),name:"name",rules:[{required:!0,message:a("团队名称不能为空！")}]},y.createElement(F,null)),y.createElement($.Item,{label:a("备注"),name:"note"},y.createElement(F,null)))})),fr=y.forwardRef(((e,t)=>{const{t:a}=E(),[n]=$.useForm();return f.exports.useImperativeHandle(t,(()=>({form:n}))),y.createElement($,o(i({},Er),{form:n}),y.createElement($.Item,{name:"password",label:a("密码"),rules:[{required:!0,message:a("请输入密码!")}],hasFeedback:!0},y.createElement(F.Password,null)),y.createElement($.Item,{name:"confirm",label:a("确认密码"),dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:a("请确认密码!")},({getFieldValue:e})=>({validator:(t,a)=>a&&e("password")!==a?Promise.reject(new Error("密码不一致!")):Promise.resolve()})]},y.createElement(F.Password,null)))}));const yr=e=>{const{t:t}=E(),{teamId:a,onSelect:n}=e,[l,r]=f.exports.useState(),[s,i]=f.exports.useState([]),[o,c]=f.exports.useState([]),[m,u]=f.exports.useState(""),d=[{title:t("用户名"),dataIndex:"username",ellipsis:!0},{title:t("显示名"),dataIndex:"nickname",ellipsis:!0,render:(e,t)=>t.nickname||"-"},{title:t("邮箱"),dataIndex:"email",render:(e,t)=>t.email||"-"},{title:t("手机"),dataIndex:"phone",render:(e,t)=>t.phone||"-"}];f.exports.useEffect((()=>{p()}),[]);const p=()=>{a&&nl(a).then((e=>{r(e.user_group)}))};return y.createElement("div",null,y.createElement("div",null,y.createElement("span",null,t("团队名称"),"："),l&&l.name),y.createElement("div",{style:{margin:"20px 0 16px"}},s.length>0&&y.createElement("span",null,t("已选择"),s.length,t("项"),"："),o.map(((e,t)=>y.createElement(H,{style:{marginBottom:"4px"},closable:!0,onClose:()=>(e=>{let t=o.filter((t=>t.id!==e.id)),a=t.map((e=>e.id));c(t),i(a)})(e),key:e.id},e.username)))),y.createElement(F,{className:"searchInput",prefix:y.createElement(q,null),value:m,onChange:e=>u(e.target.value),placeholder:t("用户名、邮箱或电话"),onPressEnter:e=>u(m)}),y.createElement(da,{fetchHandle:tl,columns:d,rowKey:"id",needPagination:!0,pageSize:5,fetchParams:{query:m},rowSelection:{selectedRowKeys:s,onChange:(e,t)=>{n(e),i(e),c(t)}}}))};var xr,kr,br,Cr,Nr,Sr;(kr=xr||(xr={})).User="用户",kr.Team="团队",(Cr=br||(br={})).CreateUser="创建用户",Cr.CreateTeam="创建团队",Cr.EditUser="编辑用户信息",Cr.EditTeam="编辑团队信息",Cr.Reset="重置密码",Cr.Disable="禁用",Cr.Undisable="启用",Cr.AddUser="添加成员",(Sr=Nr||(Nr={})).Admin="管理员",Sr.Standard="普通用户",Sr.Guest="游客";const wr=e=>{const{t:t}=E(),{visible:a,userType:n,onClose:l,action:r,userId:s,teamId:c,onSearch:m}=e,[u,d]=f.exports.useState(),p=f.exports.useRef(null),h=f.exports.useRef(null),g=f.exports.useRef(null),v=(r===br.CreateUser||r===br.EditUser)&&n===xr.User,x=(r===br.CreateTeam||r===br.EditTeam)&&n===xr.Team,k=r===br.Reset,b=r===br.AddUser,C=async e=>{if(v){let e=p.current.form;const n=await e.validateFields();let c={};n.contacts&&n.contacts.forEach((e=>{c[e.key]=e.value}));let m=o(i({},n),{contacts:c,confirm:void 0});r===br.CreateUser&&(a=m,vt(`${Nt}/api/n9e/users`,{method:ft.Post,data:a}).then((e=>e&&e.dat))).then((e=>{R.success(t("用户创建成功")),l()})),r===br.EditUser&&s&&function(e,t){return vt(`${Nt}/api/n9e/user/${e}/profile`,{method:ft.Put,data:t}).then((e=>e&&e.dat))}(s,m).then((e=>{R.success(t("用户信息修改成功")),l()}))}var a;if(x){let a=h.current.form;const n=await a.validateFields();let s=i({},n);r===br.CreateTeam&&function(e){return vt(`${Nt}/api/n9e/user-groups`,{method:ft.Post,data:e}).then((e=>e&&e.dat))}(s).then((a=>{R.success(t("团队创建成功")),l(!0),"search"===e&&m(s.name)})),r===br.EditTeam&&c&&function(e,t){return vt(`${Nt}/api/n9e/user-group/${e}`,{method:ft.Put,data:t}).then((e=>e&&e.dat))}(c,s).then((e=>{R.success(t("团队信息修改成功")),l()}))}if(k&&s){let e=g.current.form;const a=await e.validateFields();let n=i({},a);(function(e,t){return vt(`${Nt}/api/n9e/user/${e}/password`,{method:ft.Put,data:t}).then((e=>e&&e.dat))})(s,n).then((e=>{R.success(t("密码重置成功")),l()}))}if(b&&c){(function(e,t){return vt(`${Nt}/api/n9e/user-group/${e}/members`,{method:ft.Post,data:t}).then((e=>e&&e.dat))})(c,{ids:u}).then((e=>{R.success(t("添加成功")),l()}))}};return y.createElement(V,{title:r===br.CreateUser?t("创建用户"):r===br.CreateTeam?t("创建团队"):r===br.EditUser?t("编辑用户信息"):r===br.EditTeam?t("编辑团队信息"):r===br.Reset?t("重置密码"):r===br.Disable?t("禁用"):r===br.Undisable?t("启用"):r===br.AddUser?t("添加成员"):void 0,visible:a,width:700,onCancel:l,destroyOnClose:!0,footer:[y.createElement(w,{key:"back",onClick:l},t("取消")),y.createElement(w,{key:"submit",type:"primary",onClick:()=>C()},t("确定")),r===br.CreateTeam&&y.createElement(w,{type:"primary",onClick:()=>C("search")},t("确认并搜索"))]},v&&y.createElement(gr,{ref:p,userId:s}),x&&y.createElement(vr,{ref:h,teamId:c}),k&&y.createElement(fr,{ref:g,userId:s}),b&&y.createElement(yr,{teamId:c,onSelect:e=>d(e)}))};const{confirm:_r}=V,Ir=()=>{const{t:e}=E(),{type:t}=be(),[a,n]=f.exports.useState(xr.User),[l,r]=f.exports.useState(!1),[s,i]=f.exports.useState(),[o,c]=f.exports.useState(""),[m,u]=f.exports.useState(""),[d,p]=f.exports.useState(""),[g,v]=f.exports.useState([]),[x,k]=f.exports.useState(0),[b,C]=f.exports.useState([]),[N,_]=f.exports.useState(),[I,$]=f.exports.useState([]),[P,O]=f.exports.useState(""),[T,D]=f.exports.useState(!1),[L,V]=f.exports.useState(1),[G,M]=f.exports.useState(0),[U,H]=f.exports.useState(""),[B,j]=f.exports.useState(""),z=f.exports.useRef(null);let{profile:Y}=h((e=>e.account));const Q=[{title:e("用户名"),dataIndex:"username",ellipsis:!0},{title:e("显示名"),dataIndex:"nickname",ellipsis:!0,render:(e,t)=>t.nickname||"-"},{title:e("邮箱"),dataIndex:"email",render:(e,t)=>t.email||"-"},{title:e("手机"),dataIndex:"phone",render:(e,t)=>t.phone||"-"}],X=[...Q,{title:e("角色"),dataIndex:"roles",render:(e,t)=>e.join(", ")},{title:e("启用"),width:"80px",render:(e,t)=>y.createElement(_e,{checked:0===t.status,disabled:!Y.roles.includes("Admin"),size:"small",onChange:()=>se(t.status,t.id)})},{title:e("操作"),width:"240px",render:(t,a)=>y.createElement(y.Fragment,null,y.createElement(w,{className:"oper-name",type:"link",onClick:()=>le(br.EditUser,a.id)},e("编辑")),y.createElement(w,{className:"oper-name",type:"link",onClick:()=>le(br.Reset,a.id)},e("重置密码")),y.createElement("a",{style:{color:"red",marginLeft:"16px"},onClick:()=>{_r({title:e("是否删除该用户"),onOk:()=>{var t;(t=a.id,vt(`${Nt}/api/n9e/user/${t}`,{method:ft.Delete}).then((e=>e&&e.dat))).then((t=>{R.success(e("用户删除成功")),re()}))},onCancel:()=>{}})}},e("删除")))}];Y.roles.includes("Admin")||X.pop();const Z=[...Q,{title:e("操作"),width:"100px",render:(t,a)=>y.createElement("a",{style:{color:"red"},onClick:()=>{let t={ids:[a.id]};_r({title:e("是否删除该成员"),onOk:()=>{var a,n;(a=m,n=t,vt(`${Nt}/api/n9e/user-group/${a}/members`,{method:ft.Delete,data:n}).then((e=>e&&e.dat))).then((t=>{R.success(e("成员删除成功")),re()}))},onCancel:()=>{}})}},e("删除"))}];f.exports.useEffect((()=>{switch(t){case"user":n(xr.User);break;case"group":n(xr.Team);break;default:n(xr.User)}}),[t]),f.exports.useEffect((()=>{ee()}),[a]),f.exports.useEffect((()=>{a===xr.Team&&m&&ae(m)}),[m]);const ee=(e=!1)=>{a===xr.User?z.current.refreshList():(e&&V(1),te(void 0,e?1:void 0,void 0,e))},te=(e=!1,t,a,n)=>{al({query:void 0===a?U:a,p:t||L,limit:20,isAppend:e}).then((t=>{$(e?I.concat(t.dat.list||[]):t.dat.list||[]),M(t.dat.total),m&&!n||u(t.dat.list[0].id)}))},ae=e=>{D(!0),nl(e).then((e=>{_(e.user_group),v(e.users),C(e.users),k(e.users.length),D(!1)}))},ne=(e,t)=>{if("team"===e)te(!1,1,t);else if(t){D(!0);let e=b.filter((e=>-1!==e.username.indexOf(t)||-1!==e.id.toString().indexOf(t)||-1!==e.phone.indexOf(t)||-1!==e.email.indexOf(t)));v(e),D(!1)}else ae(m)},le=(e,t,n)=>{t?a===xr.User?c(t):u(t):a===xr.User?c(""):u(""),p(n||""),i(e),r(!0)},re=(e=!1)=>{r(!1),U?ne("team",U):ee(e),m&&!e&&ae(m)},se=(t,a)=>{if(0===t){ll(a,{status:1}).then((t=>{R.success(e("禁用成功")),re()}))}else{ll(a,{status:0}).then((t=>{R.success(e("启用成功")),re()}))}};return y.createElement(Ft,{title:a===xr.User?e("用户管理"):e("团队管理"),icon:y.createElement(S,null)},y.createElement("div",{className:"user-manage-content"},a===xr.User&&y.createElement("div",{className:"user-content"},y.createElement(J,{className:"event-table-search"},y.createElement("div",{className:"event-table-search-left"},y.createElement(F,{className:"searchInput",prefix:y.createElement(q,null),onPressEnter:e=>{let t=e.target.value;O(t)},placeholder:e("用户名、邮箱或手机")})),y.createElement("div",{className:"event-table-search-right"},a===xr.User&&Y.roles.includes("Admin")&&y.createElement("div",{className:"user-manage-operate"},y.createElement(w,{type:"primary",onClick:()=>le(a===xr.User?br.CreateUser:e("创建团队"))},e("创建用户"))))),y.createElement(da,{ref:z,fetchHandle:tl,columns:X,rowKey:"id",needPagination:!0,fetchParams:{query:P}})),a===xr.Team&&y.createElement("div",{style:{display:"flex",height:"100%"}},y.createElement("div",{className:"left-tree-area"},y.createElement("div",{className:"sub-title"},e("团队列表"),y.createElement(w,{style:{height:"30px"},size:"small",type:"link",onClick:()=>{le(br.CreateTeam)}},e("新建团队"))),y.createElement("div",{style:{display:"flex",margin:"5px 0px 12px"}},y.createElement(F,{prefix:y.createElement(q,null),value:U,onChange:e=>{H(e.target.value)},placeholder:e("搜索团队名称"),onPressEnter:e=>{V(1),te(!1,1,e.target.value)}})),y.createElement(Re,{style:{marginBottom:"12px",flex:1,overflow:"auto"},dataSource:I,size:"small",renderItem:e=>y.createElement(Re.Item,{key:e.id,className:m===e.id?"is-active":"",onClick:()=>u(e.id)},e.name)}),20*L<G?y.createElement(Ne,{className:"load-more",onClick:()=>{V(L+1),te(!0,L+1)}}):null),y.createElement("div",{className:"resource-table-content"},y.createElement(J,{className:"team-info"},y.createElement(W,{span:"24",style:{color:"#000",fontSize:"14px",fontWeight:"bold",display:"inline"}},N&&N.name,y.createElement(K,{title:e("刷新"),style:{marginLeft:"8px",fontSize:"14px"},onClick:()=>le(br.EditTeam,m)}),y.createElement(Se,{style:{marginLeft:"8px",fontSize:"14px"},onClick:()=>{_r({title:e("是否删除该团队"),onOk:()=>{var t;(t=m,vt(`${Nt}/api/n9e/user-group/${t}`,{method:ft.Delete}).then((e=>e&&e.dat))).then((t=>{R.success(e("团队删除成功")),re(!0)}))},onCancel:()=>{}})}})),y.createElement(W,{style:{marginTop:"8px",color:"#666"}},e("备注"),"：",N&&N.note?N.note:"-")),y.createElement(J,{justify:"space-between",align:"middle"},y.createElement(W,{span:"12"},y.createElement(F,{prefix:y.createElement(q,null),value:B,className:"searchInput",onChange:e=>j(e.target.value),placeholder:e("成员名、邮箱或手机"),onPressEnter:e=>ne("member",B)})),y.createElement(w,{type:"primary",onClick:()=>{le(br.AddUser,m)}},e("添加成员"))),y.createElement(A,{rowKey:"id",columns:Z,dataSource:g,loading:T}))),y.createElement(wr,{visible:l,action:s,userType:a,onClose:re,onSearch:e=>{H(e),ne("team",e)},userId:o,teamId:m,memberId:d})))},$r=function(e){return vt(`${Nt}/api/n9e/metric-descriptions`,{method:ft.Get,params:e})};const{confirm:Pr}=V,{TextArea:Fr}=F,Or=()=>{const{t:e}=E(),[t]=$.useForm(),a=f.exports.useRef(null),n=f.exports.useRef(null),[l,r]=f.exports.useState(!1),[s,o]=f.exports.useState("create"),[c,m]=f.exports.useState([]),[u,d]=f.exports.useState({}),[p,h]=f.exports.useState(""),g={import:e("导入"),edit:e("编辑"),export:e("导出"),create:e("创建")},v=()=>{r(!1)},x=t=>{var n;(n=[t.id],vt(`${Nt}/api/n9e/metric-descriptions`,{method:ft.Delete,data:{ids:n}})).then((async t=>{await a.current.refreshList(),R.success(e("删除指标成功"))}))},[k,b]=f.exports.useState(e("更多操作")),C=t=>{switch(t){case"import":r(!0),o("import");break;case"export":c.length<=0?R.warning(e("请勾选需要导出的指标")):(r(!0),o("export"),setTimeout((()=>{n.current&&n.current.focus()})))}b(t)},N=(e,t,a,n)=>t.id===u.id?y.createElement(F,{defaultValue:e,onPressEnter:()=>S("save"),onChange:e=>((e,t,a,n)=>{let l=Object.assign({},t);l[n]=e.target.value,d(l)})(e,t,0,n)}):y.createElement("span",null,e),S=async(t="")=>{if("save"===t){let t=u.id||-1;await function(e,t){return vt(`${Nt}/api/n9e/metric-description/${e}`,{method:ft.Put,data:t})}(t,{description:u.description,metric:u.metric}),R.success(e("编辑成功")),a.current.refreshList()}d({})},_=[{title:e("指标名称"),dataIndex:"metric",key:"metric",render:e=>y.createElement("a",{style:{color:"black"}},e)},{title:e("释义"),dataIndex:"description",width:"40%",key:"description",render:(e,t,a)=>N(e,t,0,"description")},{title:e("操作"),dataIndex:"",key:"operations",width:"15%",render:(t,a)=>y.createElement("div",{className:"operations"},a.id!==u.id?y.createElement("div",null,y.createElement("span",{className:"operation-item edit",onClick:()=>(e=>{d(e)})(a)},e("编辑")),y.createElement("div",{className:"table-operator-area-warning",style:{display:"inline-block",marginLeft:10},onClick:()=>{Pr({title:e("确定删除该指标?"),icon:y.createElement(B,null),onOk:()=>{x(a)}})}},e("删除"))):y.createElement("div",null,y.createElement("span",{className:"operation-item edit-save",onClick:()=>S("save")},e("保存")),y.createElement("span",{className:"operation-item edit-cancel",onClick:()=>S("cancel")},e("取消"))))}],I={onChange:(e,t)=>{let a=[];t.map((e=>{a.push(`${e.metric}:${e.description}`)})),m(a)}};return y.createElement(Ft,{title:e("指标释义"),icon:y.createElement(Ve,null)},y.createElement("div",{className:"indicator-index"},y.createElement("div",{className:"indicator-operations"},y.createElement(F,{className:"searchInput",onPressEnter:e=>{let t=e.target.value;h(t)},prefix:y.createElement(q,null),placeholder:e("指标名称或释义")}),y.createElement("div",{className:"operations"},y.createElement(w.Group,null,y.createElement(w,{size:"middle",type:"default",icon:y.createElement(Ge,null),onClick:()=>C("import")},e("导入")),y.createElement(w,{size:"middle",type:"default",icon:y.createElement(Ae,null),onClick:()=>C("export")},e("导出"))))),y.createElement("div",{className:"indicator-main"},y.createElement(da,{fetchHandle:$r,ref:a,fetchParams:{query:p},rowSelection:i({},I),rowKey:e=>e.id,columns:_}))),y.createElement(V,{title:g[s],destroyOnClose:!0,footer:"export"!==s&&[y.createElement(w,{key:"delete",onClick:v},e("取消")),y.createElement(w,{key:"submit",type:"primary",onClick:async()=>{try{const l=await t.validateFields();(n=l.metrics||"",vt(`${Nt}/api/n9e/metric-descriptions`,{method:ft.Post,data:{data:n}})).then((async t=>{t&&t.success&&(await a.current.refreshList(),r(!1),R.success(e("创建指标成功")))}))}catch(l){}var n}},e("确定"))],onCancel:v,visible:l},y.createElement("p",{style:{color:"#999"}},"export"===s?y.createElement("a",{onClick:()=>{Vt(c)}},"Download.txt"):y.createElement("span",null,e("一行一个"))),(()=>{switch(s){case"export":return y.createElement("div",{contentEditable:"true",suppressContentEditableWarning:!0,ref:n,style:{height:"200px",border:"1px solid #d9d9d9",overflow:"auto",padding:"10px"}},c.map(((e,t)=>y.createElement("div",{key:t},e))));case"import":case"create":return y.createElement($,{name:s+"-dialog",form:t,preserve:!1},y.createElement($.Item,{name:"metrics",key:"metrics",rules:[{required:!0,message:e("不能为空"),validateTrigger:"trigger"}]},y.createElement(Fr,{placeholder:"name:description",rows:4})))}})()))},Tr=e=>({all:{label:e("周期内所有点"),meaning:e("在统计周期 $n 秒内（初次上报的指标，统计周期内只有一个值，如要限制点数，可选择happen函数）每个值都 $v"),meaningEn:"duration $n s, every value $v",params:[],defaultValue:[]},happen:{label:e("发生次数"),meaning:e("统计周期 $n 秒内至少有 $m 次值 $v"),meaningEn:"duration $n s, $m times value $v",params:["m"],defaultValue:[1]},max:{label:e("最大值"),meaning:e("统计周期 $n 秒内的最大值 $v"),meaningEn:"duration $n s, max $v",params:[],defaultValue:[]},min:{label:e("最小值"),meaning:e("统计周期 $n 秒内的最小值 $v"),meaningEn:"duration $n s, min $v",params:[],defaultValue:[]},avg:{label:e("均值"),meaning:e("统计周期 $n 秒内的均值 $v"),meaningEn:"duration $n s, avg $v",params:[],defaultValue:[]},sum:{label:e("求和"),meaning:e("统计周期 $n 秒内的所有值求和 $v"),meaningEn:"duration $n s, sum $v",params:[],defaultValue:[]},diff:{label:e("突增突降值"),meaning:e("最新值与其之前 $n 秒内的任意值之差 (区分正负) $v"),params:[],defaultValue:[]},pdiff:{label:e("突增突降率"),meaning:e("(最新值与其之前 $n 秒的任意值之差)除以对应历史值 (区分正负) $v ％"),params:[],defaultValue:[]},c_avg_rate_abs:{label:e("同比变化率"),meaning:e("最近 $n 秒平均值相对 $m 天前同周期平均值变化率 $v ％"),params:["m"],defaultValue:[86400]},c_avg_rate:{label:e("同比变化率(区分正负)"),meaning:e("最近 $n 秒平均值相对 $m 天前同周期平均值变化率 $v ％"),params:["m"],defaultValue:[86400]},c_avg_abs:{label:e("同比变化值"),meaning:e("最近 $n 秒平均值相对 $m 天前同周期平均值变化值 $v"),params:["m"],defaultValue:[86400]},c_avg:{label:e("同比变化值(区分正负)"),meaning:e("最近 $n 秒平均值相对 $m 天前同周期平均值变化值 $v"),params:["m"],defaultValue:[86400]},stddev:{label:e("3-sigma离群点检测"),meaning:e("统计周期 $n 秒内波动值过大，超过了 $m 个标准差范围"),meaningEn:"within $n seconds, the fluctuation value exceeds the $m standard deviation range",params:["m"],defaultValue:[3]}}),Dr=[{value:"InClasspath",multiple:!0},{value:"NotInClasspath",multiple:!0},{value:"InClasspathPrefix",multiple:!1},{value:"NotInClasspathPrefix",multiple:!1},{value:"InResourceList",multiple:!0},{value:"NotInResourceList",multiple:!0},{value:"HasPrefixString",multiple:!1},{value:"NoPrefixString",multiple:!1},{value:"HasSuffixString",multiple:!1},{value:"NoSuffixString",multiple:!1},{value:"ContainsString",multiple:!1},{value:"NotContainsString",multiple:!1},{value:"MatchRegexp",multiple:!1},{value:"NotMatchRegexp",multiple:!1}],Lr=[{value:"InList",multiple:!0},{value:"NotInList",multiple:!0},{value:"HasPrefixString",multiple:!1},{value:"NoPrefixString",multiple:!1},{value:"HasSuffixString",multiple:!1},{value:"NoSuffixString",multiple:!1},{value:"ContainsString",multiple:!1},{value:"NotContainsString",multiple:!1},{value:"MatchRegexp",multiple:!1},{value:"NotMatchRegexp",multiple:!1}],qr=e=>{const{t:t,i18n:a}=E(),{field:n,expression:l,alertDuration:r,form:s,openDrawer:i,index:o}=e,[c,m]=f.exports.useState((null==l?void 0:l.func)||"all"),[u,d]=f.exports.useState((null==l?void 0:l.params)||[]),[p,h]=f.exports.useState(void 0!==(null==l?void 0:l.threshold)?null==l?void 0:l.threshold:60),[g,v]=f.exports.useState(null==l?void 0:l.metric),[x,k]=f.exports.useState(""),[b,C]=f.exports.useState([]),[N,S]=f.exports.useState((null==l?void 0:l.optr)||"="),{Option:w}=j;f.exports.useEffect((()=>{g&&Ua({limit:1,metric:g}).then((e=>{var t,a,n,l,r,s;k((null==(n=null==(a=null==(t=null==e?void 0:e.dat)?void 0:t.metrics)?void 0:a[0])?void 0:n.description)||(null==(s=null==(r=null==(l=null==e?void 0:e.dat)?void 0:l.metrics)?void 0:r[0])?void 0:s.name)||"")}))}),[]);const _=Object.keys(Tr(t)).map((e=>y.createElement(w,{key:e,value:e},Tr(t)[e].label))),I=f.exports.useCallback((()=>Tr(t)[c].params.map(((e,t)=>y.createElement(f.exports.Fragment,{key:t},y.createElement(W,{span:1,style:{lineHeight:"32px",color:"rgb(255, 183, 39)"}},e,"："),y.createElement(W,{span:2},P(t)))))),[c,Tr(t)[c].params]),P=e=>{const t=["diff","pdiff"].indexOf(c)>-1?2:1;let a;return 0===e&&("c_avg_rate_abs"!==c&&"c_avg_rate"!==c&&"c_avg_abs"!==c&&"c_avg"!==c||(a=y.createElement(j,null,y.createElement(w,{value:86400,key:86400},"1"),y.createElement(w,{value:604800,key:604800},"7"))),"happen"!==c&&"ndiff"!==c&&"stddev"!==c||(a=y.createElement(he,{min:t,style:{width:"100%"}}))),y.createElement($.Item,{name:[n.name,"params",0],fieldKey:[n.fieldKey,"params"],initialValue:null==l?void 0:l.params[e],style:{marginBottom:0}},a)};f.exports.useEffect((()=>()=>{e.handleMetricChange()}),[]);const F=y.useMemo((()=>Me.debounce((e=>{e.length>0&&e.length<4||Ua({metric:e}).then((e=>{var t;C(null==(t=null==e?void 0:e.dat)?void 0:t.metrics)}))}),500)),[]);return y.createElement(Y,{style:{width:"100%",marginBottom:20,background:"rgb(244, 245, 248)"}},y.createElement(J,{gutter:[10,10]},y.createElement(W,{span:10},y.createElement($.Item,{name:[n.name,"metric"],fieldKey:[n.fieldKey,"metric"],initialValue:null==l?void 0:l.metric,style:{marginBottom:0}},y.createElement(oe,{onFocus:()=>{var e;let t=null==(e=s.getFieldValue("trigger_conditions")[n.name])?void 0:e.metric;t&&t.length>0&&t.length<4||Ua({metric:t}).then((e=>{var t;C(null==(t=null==e?void 0:e.dat)?void 0:t.metrics)}))},onChange:t=>{e.handleMetricChange(),v(t);let a=b.find((e=>e.name===t));a&&k(a.description||a.name)},onSearch:F,placeholder:t("请输入监控指标(输入4个以上字符发起检索)")},b&&b.map(((e,t)=>y.createElement(w,{key:t,value:e.name},(e=>e.name+" "+e.description)(e))))))),y.createElement(W,{span:3},y.createElement($.Item,{name:[n.name,"func"],fieldKey:[n.fieldKey,"func"],initialValue:(null==l?void 0:l.func)||"all",style:{marginBottom:0}},y.createElement(j,{onChange:e=>{m(e)},dropdownClassName:"overflow-230"},_))),I(),y.createElement(W,{span:1,style:{lineHeight:"32px",color:"rgb(255, 111, 39)"}},"v："),y.createElement(W,{span:2},y.createElement($.Item,{name:[n.name,"optr"],fieldKey:[n.fieldKey,"optr"],initialValue:(null==l?void 0:l.optr)||"=",style:{marginBottom:0}},y.createElement(j,{onChange:e=>{S(e)}},y.createElement(w,{value:"=",key:"equal"},"="),y.createElement(w,{value:">",key:"greater"},">"),y.createElement(w,{value:">=",key:"greaterEqual"},">="),y.createElement(w,{value:"<",key:"less"},"<"),y.createElement(w,{value:"<=",key:"lessEqual"},"<="),y.createElement(w,{value:"!=",key:"notEqual"},"!=")))),y.createElement(W,{span:5},y.createElement(J,null,y.createElement(W,{span:21},y.createElement($.Item,{name:[n.name,"threshold"],fieldKey:[n.fieldKey,"threshold"],initialValue:(null==l?void 0:l.threshold)||60,style:{marginBottom:0}},y.createElement(he,{style:{width:"100%"},placeholder:t("请输入百分比"),onChange:e=>{h(e)}}))),y.createElement(W,{span:1,offset:2},y.createElement(M,{title:t("预览"),overlayClassName:"trigger-condition-preview"},y.createElement(Ue,{style:{lineHeight:"33px"},className:"openDrawer-icon",onClick:()=>{i(o)}}))))),y.createElement(W,{span:24},(()=>{var e;const a=Tr(t)[c].meaning,l=a.indexOf("$n"),i=a.indexOf("$m"),o=a.lastIndexOf("$v"),m=a.substring(0,l),d=a.substring(o+2);let E;if("c_avg_rate_abs"===c||"c_avg_rate"===c||"c_avg_abs"===c||"c_avg"===c){let t=null==(e=s.getFieldValue("trigger_conditions")[n.name])?void 0:e.params;E=t.length>0&&1!==t[0]?t[0]/86400:1}else E=u[0]||1;let h=y.createElement("strong",{style:{color:"#2DB7F5"}},r);const g=y.createElement("strong",{style:{color:"#FFB727"}},E),v=y.createElement("strong",{style:{color:"#FF6F27"}},N&&void 0!==p?N+" "+p:"${v}");["diff","pdiff"].indexOf(c)>-1&&(h=y.createElement("strong",{style:{color:"#2DB7F5"}},r));let f=y.createElement("span",null,m,h),k=a.substring(l+2);if(i>-1){const e=a.substring(l+2,i);f=y.createElement("span",null,f,e,g),k=a.substring(i+2)}if("stddev"!==c){const e=i>-1?i:l,t=a.substring(e+2,o);f=y.createElement("span",null,f,t,v,d)}else f=y.createElement("span",null,f,k);return y.createElement("div",null,y.createElement("span",{style:{color:"#999"}},t("预览"),"："),y.createElement("span",{style:{paddingRight:5}},x||"${metric}"),f)})())))},Rr=["InResourceList","NotInResourceList"],Vr=e=>{E();const{Option:t}=j,{classpathes:a,field:n,initObj:l,onFuncChange:r,form:s}=e,[i,o]=f.exports.useState();f.exports.useEffect((()=>{Zt().then((e=>{o(null==e?void 0:e.dat.list)}))}),[]);const c=Dr.map((e=>y.createElement(t,{key:e.value,value:e.value},e.value))),m=a.map((e=>y.createElement(t,{key:e.id,value:e.path},e.path))),u=i?i.map((e=>y.createElement(t,{key:e.id,value:e.ident},e.ident+" "+e.alias))):[],[d,p]=f.exports.useState(Dr[0].value);f.exports.useEffect((()=>{p(null==l?void 0:l.func)}),[null==l?void 0:l.func]);const h=Dr.filter((e=>e.multiple)).map((e=>e.value));return y.createElement(y.Fragment,null,y.createElement(W,{span:8},y.createElement($.Item,{name:[n.name,"func"],initialValue:"InClasspathPrefix"},y.createElement(j,{value:d,onChange:e=>{r(n.name),p(e)}},c))),y.createElement(W,{span:14},h.includes(s.getFieldValue(["res_filters",n.name,"func"]))?y.createElement($.Item,{name:[n.name,"params"],initialValue:null==l?void 0:l.params},y.createElement(j,{mode:"multiple",value:null==l?void 0:l.params},Rr.includes(s.getFieldValue(["res_filters",n.name,"func"]))?u:m)):y.createElement($.Item,{name:[n.name,"params",0],initialValue:null==l?void 0:l.params},y.createElement(F,{value:null==l?void 0:l.params}))))},Gr=Lr.filter((e=>e.multiple)).map((e=>e.value)),Ar=e=>{const{t:t}=E(),{Option:a}=j,{tagKeys:n,field:l,form:r,curMetric:s}=e;console.log("curMetric",s);const[i,o]=f.exports.useState([]),[c,m]=f.exports.useState([]),[u,d]=f.exports.useState([]),[p,h]=f.exports.useState(""),[g,v]=f.exports.useState("");f.exports.useState();const x=Lr.map((e=>y.createElement(a,{key:e.value,value:e.value},e.value)));f.exports.useEffect((()=>{0!==(null==n?void 0:n.length)&&zn({tag_key:n[0],params:s.map((e=>({metric:e}))),limit:50}).then((e=>{var t;o((null==(t=null==e?void 0:e.dat)?void 0:t.values)||[])}))}),[]);const k=f.exports.useCallback(Me.debounce((e=>{e&&zn({tag_key:e,params:s.map((e=>({metric:e}))),limit:50}).then((e=>{var t;o((null==(t=null==e?void 0:e.dat)?void 0:t.values)||[])}))}),1e3),[]),b=f.exports.useCallback(Me.debounce((e=>{h(e);const t={params:s.map((e=>({metric:e}))),limit:50,tag_key:e};jn(t).then((e=>{m(e.dat.keys.map((e=>({value:e}))))}))}),1e3),[]),C=f.exports.useCallback(Me.debounce((e=>{e&&(v(e),zn({tag_key:e,params:s.map((e=>({metric:e}))),limit:50}).then((e=>{d(e.dat.values.map((e=>({value:e}))))})))}),1e3),[]),N=e=>{C(e)};return y.createElement(y.Fragment,null,y.createElement(W,{span:8},y.createElement($.Item,{name:[l.name,"key"],initialValue:null==n?void 0:n[0]},y.createElement(oe,{placeholder:t("请输入标签key"),onChange:e=>{Gr.includes(r.getFieldValue(["tags_filters",l.name,"func"]))?r.setFields([{name:["tags_filters",l.name,"params"],value:[]}]):r.setFields([{name:["tags_filters",l.name,"params",0],value:""}])},onSearch:e=>{b(e)},options:p?c:n.map((e=>({value:e})))}))),y.createElement(W,{span:7},y.createElement($.Item,{name:[l.name,"func"],initialValue:Lr[0].value},y.createElement(j,null,x))),y.createElement(W,{span:7},Gr.includes(r.getFieldValue(["tags_filters",l.name,"func"]))?y.createElement($.Item,{name:[l.name,"params"],initialValue:null==i?void 0:i[0]},y.createElement(j,{mode:"tags",placeholder:t("请输入标签value"),onSearch:N,onFocus:e=>{C(r.getFieldValue(["tags_filters",l.name,"key"]))}},g?u.map((e=>y.createElement(a,{key:e.value,value:e.value},e.value))):(i||[]).map((e=>y.createElement(a,{key:e,value:e},e))))):y.createElement($.Item,{name:[l.name,"params",0]},y.createElement(oe,{onSearch:N,onFocus:e=>{k(r.getFieldValue(["tags_filters",l.name,"key"]))},options:g?u:(i||[]).map((e=>({value:e})))}))))};function Mr(e){const{t:t,i18n:a}=E(),[n,l]=f.exports.useState([]),[r,s]=f.exports.useState(1),[c,m]=f.exports.useState([]),[u,d]=f.exports.useState({start:0,end:0}),[p,h]=f.exports.useState(15),[g,v]=f.exports.useState({range:{start:0,end:0},limit:50,metric:"",description:""});f.exports.useEffect((()=>{l(e.metrics)}),[e.metrics]);const{visible:x,onChange:k}=e,b=(e={},t)=>{let a=t||u;v(o(i(i({},g),e),{range:a}))};return y.createElement(G,{title:t("预览图"),placement:"right",onClose:()=>{k(!1)},visible:x,className:"my-drawer",drawerStyle:{minWidth:850}},y.createElement("div",{className:"header"},y.createElement("div",{className:"header-left"},y.createElement(nn,{onChange:e=>{d(e),b({},e)}}),y.createElement(mn,{onChange:e=>h(e),initialValue:p}),y.createElement(on,{onClick:()=>{b()},className:"reload-icon"}))),y.createElement("div",{className:"chart-list"},y.createElement(J,{gutter:15,style:{width:"100%"}},n.length>0?n.map(((t,a)=>y.createElement(W,{key:a,span:24/r},y.createElement(rn,{options:o(i({},g),{idents:c.length>0?c:void 0,step:p,metric:t.name,description:t.description,prome_ql:t.promql,yplotline:e.yplotline>0?e.yplotline:void 0})})))):y.createElement("h2",{className:"holder"},y.createElement(me,{style:{fontSize:"30px"}}),y.createElement("span",null,"选择监控指标添加图表")))))}const Ur=({value:e,onChange:t})=>{const{t:a}=E();return y.createElement(y.Fragment,null,y.createElement(he,{value:e,onChange:t})," ",a("秒"))},{TextArea:Hr}=F,{confirm:Br}=V,Kr=({onChange:e,value:t})=>{const{t:a}=E();return y.createElement(y.Fragment,null,y.createElement(he,{onChange:e,value:t})," ",a("秒"))},jr=[1,2,3,4,5,6,7];const{Option:zr}=j,Yr=()=>{const{t:e,i18n:t}=E(),a=g(),[n]=$.useForm(),l=new URLSearchParams(v().search).get("mode"),[r,s]=f.exports.useState(60);f.exports.useState({});const[c,m]=f.exports.useState([]),[u,d]=f.exports.useState([]),[p,h]=f.exports.useState([]),[x,k]=f.exports.useState([]);f.exports.useState(!1);const[b,C]=f.exports.useState([]),[N,S]=f.exports.useState([]),[_,I]=f.exports.useState([]),[P,O]=f.exports.useState([]),[T,D]=f.exports.useState([]),[L,q]=f.exports.useState([]),[V,G]=f.exports.useState(!0),[A,U]=f.exports.useState({}),[H,B]=f.exports.useState([]),[K,Q]=f.exports.useState(),[Z,ee]=f.exports.useState(!1),[te,ae]=f.exports.useState(0),ne=()=>{const e=Promise.resolve(null);return se?vt(`${Nt}/api/n9e/alert-rule/${se}`,{method:ft.Get}):e},re=be(),se=re.id,ie=re.group_id;f.exports.useEffect((()=>{Promise.all([Kt(),al(),tl(),rl(),ne()]).then((([t,a,r,s,i])=>{var o,c,u,p,E,g,v,f,y,x,b,C,N,S,w,_;let $=null==i?void 0:i.dat;U($);let P=[(F="",{optr:"=",func:Object.keys(Tr(e))[0],metric:F,params:[],threshold:60})];var F;let T=[],L=[""],R=s||[];if(n.setFieldsValue({type:0,priority:1,alert_duration:60,status:0,enable_days_of_week:jr,enable_time:[ue("00:00","HH:mm"),ue("23:59","HH:mm")],recovery_duration:0,recovery_notify:false,notify_channels:[],notify_groups:[],notify_users:[],runbook_url:"",note:""}),$){if((null==(c=null==(o=null==$?void 0:$.expression)?void 0:o.trigger_conditions)?void 0:c.length)>0){P=null==(u=null==$?void 0:$.expression)?void 0:u.trigger_conditions;const e=null==(p=null==$?void 0:$.expression)?void 0:p.trigger_conditions.map((e=>e.metric));B(e),oe(e)}(null==(g=null==(E=null==$?void 0:$.expression)?void 0:E.res_filters)?void 0:g.length)>0&&(T=null==(v=null==$?void 0:$.expression)?void 0:v.res_filters,n.setFieldsValue({res_filters:T})),(null==$?void 0:$.callbacks)&&(L=null==$?void 0:$.callbacks.split(" ")),(null==$?void 0:$.expression.together_or_any)&&n.setFieldsValue({together_or_any:null==$?void 0:$.expression.together_or_any}),(null==(f=null==$?void 0:$.expression)?void 0:f.evaluation_interval)&&n.setFieldsValue({evaluation_interval:null==(y=null==$?void 0:$.expression)?void 0:y.evaluation_interval}),(null==(x=null==$?void 0:$.expression)?void 0:x.promql)&&n.setFieldsValue({promql:null==(b=null==$?void 0:$.expression)?void 0:b.promql}),$.group_id&&Q($.group_id),n.setFieldsValue({id:$.id,name:l?"Copy of "+$.name:$.name,priority:$.priority,type:$.type,alert_duration:$.alert_duration,status:$.status,enable_days_of_week:$.enable_days_of_week.split(" ").map((e=>Number(e))),enable_time:[ue($.enable_stime,"HH:mm"),ue($.enable_etime,"HH:mm")],recovery_duration:$.recovery_duration,recovery_notify:$.recovery_notify,notify_channels:$.notify_channels.split(" "),notify_groups:$.notify_groups.length>0?$.notify_groups.split(" ").map((e=>Number(e))):[],notify_users:$.notify_users.length>0?$.notify_users.split(" ").map((e=>Number(e))):[],runbook_url:$.runbook_url,note:$.note,append_tags:$.append_tags?$.append_tags.split(" "):[]})}m(P),d(T),k(L),q(R);let V=(null==(C=null==a?void 0:a.dat)?void 0:C.list)||[];O(V);let A=(null==(N=null==r?void 0:r.dat)?void 0:N.list)||[];D(A),I(t.dat.list),G(!1);let M=[];return $&&(null==(w=null==(S=null==$?void 0:$.expression)?void 0:S.tags_filters)?void 0:w.length)>0&&(M=null==(_=null==$?void 0:$.expression)?void 0:_.tags_filters),h(M),n.setFieldsValue({tags_filters:M}),$}))}),[]);const oe=e=>{const t=e||H.filter((e=>e));if(0===t.length)return;const a=t.map((e=>({metric:e})));jn({limit:50,params:a}).then((e=>{var t;C((null==(t=null==e?void 0:e.dat)?void 0:t.keys)||[])}))},me=X.exports.debounce((()=>{let e=n.getFieldValue("trigger_conditions").map((e=>e.metric));B(e),h([]),n.setFieldsValue({tags_filters:[]})}),500),de={wrapperCol:{offset:2}},he=[e("周一"),e("周二"),e("周三"),e("周四"),e("周五"),e("周六"),e("周日")].map(((e,t)=>y.createElement(zr,{value:t+1,key:t},`${e}`))),ge=P.map((e=>y.createElement(zr,{value:e.id,key:e.id},e.name))),ve=T.map((e=>y.createElement(zr,{value:e.id,key:e.id},e.username))),fe=L.map((e=>y.createElement(le,{value:e,key:e},e))),ye=e=>{const{res_filters:t}=n.getFieldsValue();console.log(t),t[e].params=[],n.setFieldsValue({res_filters:t})},xe=X.exports.debounce(((e,t,a)=>{Ca(t).then((e=>{e.dat.ql_correct?a():a(e.dat.parse_error)}))}),1e3),ke=function(t){let a=n.getFieldValue("type");if(0===a){let a=n.getFieldValue("trigger_conditions");if(!a[t].metric)return void R.warning(e("请先输入指标"));let l=[{name:a[t].metric,description:""}];ae(a[t].threshold),S(l)}else if(1===a){let t=n.getFieldValue("promql");if(!t)return void R.warning(e("请先输入指标"));S([{name:"",promql:t,description:""}])}ee(!0)},Ce=y.createElement(z,{spinning:V},y.createElement($,o(i({},{labelCol:{span:2},wrapperCol:{span:22}}),{form:n,onFinish:t=>{var n;let r=JSON.parse(JSON.stringify(t));const{evaluation_interval:s,promql:i,trigger_conditions:o,res_filters:c,tags_filters:m,together_or_any:u}=r;r.expression=0===r.type?{together_or_any:u,trigger_conditions:o,res_filters:c,tags_filters:m}:{evaluation_interval:s,promql:i},delete r.trigger_conditions,delete r.res_filters,delete r.tags_filters,r.enable_days_of_week=r.enable_days_of_week.join(" "),r.enable_stime=t.enable_time[0].format("HH:mm"),r.enable_etime=t.enable_time[1].format("HH:mm"),delete r.enable_time,r.notify_channels=r.notify_channels.join(" "),r.notify_groups=r.notify_groups.join(" "),r.notify_users=r.notify_users.join(" "),r.callbacks=r.callbacks.map((e=>e.url)).join(" "),r.recovery_notify=+r.recovery_notify,r.group_id=Number(ie||K),(se&&!l?Yn([r],se):Yn([r])).then((t=>{console.log(t),""===t.err?(console.log(e("添加成功"),t),R.success(e(l?"克隆成功":se?"保存成功":"创建成功")),a.push("/strategy")):R.error(e(l?"克隆失败":se?"保存失败":"创建失败"))})),r.append_tags=(null==(n=r.append_tags)?void 0:n.join(" "))||""},onFinishFailed:({values:e,errorFields:t,outOfDate:a})=>{var n;t.length>0&&(null==(n=document.querySelector(`#${t[0].name[0]}`))||n.scrollIntoView())},className:"strategy-form"}),y.createElement(Y,{title:e("基本配置")},y.createElement($.Item,{label:e("策略名称"),name:"name",rules:[{required:!0,message:e("策略名称不能为空")}]},y.createElement(F,{placeholder:e("请输入策略名称")})),y.createElement($.Item,{label:e("告警级别"),name:"priority"},y.createElement(ce.Group,null,y.createElement(ce,{value:1},e("一级报警")),y.createElement(ce,{value:2},e("二级报警")),y.createElement(ce,{value:3},e("三级报警")))),y.createElement($.Item,{label:e("触发模式"),name:"type"},y.createElement(ce.Group,{onChange:function(e){}},y.createElement(ce.Button,{value:0},"nightingale"),y.createElement(ce.Button,{value:1},"prometheus"))),Z&&y.createElement(Mr,{visible:Z,onChange:e=>{ee(e)},yplotline:te,metrics:N}),y.createElement($.Item,{label:e("统计周期"),name:"alert_duration",required:!0},y.createElement(Kr,{onChange:e=>{s(e)},value:r})),y.createElement($.Item,{shouldUpdate:!0,wrapperCol:{span:24}},(()=>0===n.getFieldValue("type")?y.createElement(y.Fragment,null,c.length>0&&y.createElement($.Item,{label:e("触发条件"),required:!0,labelCol:{span:2},wrapperCol:{span:22}},y.createElement($.Item,{name:"together_or_any",initialValue:0},y.createElement(ce.Group,null,y.createElement(ce.Button,{value:0},"And"),y.createElement(ce.Button,{value:1},"Or"))),y.createElement($.List,{name:"trigger_conditions",initialValue:c,rules:[{validator:async(e,t)=>{if(0===t.length)return Promise.reject(new Error("触发条件不能为空"))}}]},((e,{add:t,remove:a},{errors:l})=>y.createElement(y.Fragment,null,e.length?e.map(((l,s)=>y.createElement(J,{gutter:[10,10],key:l.key},y.createElement(W,{span:21},y.createElement(qr,{openDrawer:ke,index:s,field:l,remove:a,form:n,expression:c[l.key],alertDuration:r,handleMetricChange:me})),y.createElement(W,{span:1},y.createElement(pe,{className:"control-icon-high",onClick:()=>a(l.name)})),s===e.length-1&&y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-high",onClick:()=>t()}))))):y.createElement(Ee,{className:"control-icon-high",onClick:()=>t()}),y.createElement($.ErrorList,{errors:l}))))),y.createElement($.Item,{label:e("资源过滤"),labelCol:{span:2},wrapperCol:{span:22}},y.createElement($.List,{name:"res_filters"},((e,{add:t,remove:a})=>y.createElement(y.Fragment,null,e.length?e.map(((e,l)=>y.createElement(J,{gutter:[10,10],key:e.key},y.createElement(Vr,{field:e,classpathes:_,form:n,onFuncChange:ye}),y.createElement(W,{span:1},y.createElement(pe,{className:"control-icon-normal",onClick:()=>a(e.name)})),y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>t()}))))):y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>t()})))))),y.createElement($.Item,{label:e("标签过滤"),labelCol:{span:2},wrapperCol:{span:22}},y.createElement($.List,{name:"tags_filters"},((e,{add:t,remove:a},{errors:l})=>y.createElement(y.Fragment,null,e.length?e.map(((l,r)=>y.createElement(J,{gutter:[10,10],key:l.key},y.createElement(Ar,{field:l,tagKeys:b,form:n,curMetric:H||[]}),y.createElement(W,{span:1},y.createElement(pe,{className:"control-icon-normal",onClick:()=>a(l.name)})),r===e.length-1&&y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>t()}))))):y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>{t(),oe()}}))))))):y.createElement(y.Fragment,null,y.createElement($.Item,{label:e("执行频率"),name:"evaluation_interval",labelCol:{span:2},wrapperCol:{span:22},initialValue:10,required:!0},y.createElement(Ur,null)),y.createElement($.Item,{className:"Promeql-content"},y.createElement($.Item,{label:"PromQL",name:"promql",labelCol:{span:2},wrapperCol:{span:22},rules:[{required:!0,message:e("请输入PromQL")},{validator:xe}]},y.createElement(Hr,{rows:2})),y.createElement(M,{title:e("预览")},y.createElement(Ue,{className:"Promeql-icon-btn",onClick:()=>{ke()}})))))),y.createElement($.Item,{label:e("附加标签"),style:{marginTop:20},name:"append_tags"},y.createElement(j,{mode:"tags",onChange:t=>{let a=t[t.length-1];if(a&&!/\w+=\w+/.test(a)){let a=t.pop();R.error(`"${a}${e('"不符合输入规范（格式为key=value）')}`)}},placeholder:e("请输入附加标签，格式为key=value")}))),y.createElement(Y,{title:e("生效配置"),style:{marginTop:20}},y.createElement($.Item,{label:e("立即启用"),name:"status"},y.createElement(ce.Group,null,y.createElement(ce,{value:0},e("是")),y.createElement(ce,{value:1},e("否")))),y.createElement($.Item,{label:e("生效时间"),name:"enable_days_of_week"},y.createElement(j,{mode:"tags"},he)),y.createElement($.Item,i({name:"enable_time"},de),y.createElement(He.RangePicker,{format:"HH:mm"}))),y.createElement(Y,{title:e("通知配置"),style:{marginTop:20}},y.createElement($.Item,{label:e("静默恢复"),name:"recovery_notify",valuePropName:"checked"},y.createElement(le,null,e("不发送恢复通知"))),y.createElement($.Item,{label:e("通知媒介"),name:"notify_channels"},y.createElement(le.Group,null,fe)),y.createElement($.Item,{label:e("报警接收团队"),name:"notify_groups"},y.createElement(j,{mode:"multiple"},ge)),y.createElement($.Item,{label:e("报警接收人"),name:"notify_users"},y.createElement(j,{mode:"multiple"},ve)),y.createElement($.Item,{label:e("报警回调")},x.length>0&&y.createElement($.List,{name:"callbacks",initialValue:x},((t,{add:a,remove:n},{errors:l})=>y.createElement(y.Fragment,null,t.length?t.map(((e,l)=>y.createElement(J,{gutter:[10,10],key:e.key},y.createElement(W,{span:22},y.createElement($.Item,{name:[e.name,"url"],initialValue:x[e.key]},y.createElement(F,null))),y.createElement(W,{span:1},y.createElement(pe,{className:"control-icon-normal",onClick:()=>n(e.name)})),l===t.length-1&&y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>a()}))))):y.createElement(W,{span:1},y.createElement(Ee,{className:"control-icon-normal",onClick:()=>a()})),y.createElement("span",{style:{fontSize:12,marginTop:4,color:"#ccc"}},e("通知自己开发的系统（请确认是夜莺服务端可访问的地址）"))))))),y.createElement(Y,{title:e("其他配置"),style:{marginTop:20}},y.createElement($.Item,{label:e("预案链接"),name:"runbook_url"},y.createElement(F,null)),y.createElement($.Item,{label:e("备注"),name:"note"},y.createElement(F,null))),y.createElement("div",{className:"bottom-content"},y.createElement($.Item,o(i({},de),{style:{marginTop:20}}),y.createElement(w,{type:"primary",htmlType:"submit"},e(l?"克隆":se?"保存":"创建")),l?[]:se?y.createElement(w,{type:"primary",onClick:()=>{console.log(se),Br({title:e("是否删除该告警规则?"),onOk:()=>{Jn(se).then((()=>{R.success(e("删除成功")),a.push("/strategy")}))},onCancel(){}})}},e("删除")):[],y.createElement(w,{onClick:()=>{a.push("/strategy")}},e("取消"))))));return y.createElement(Ft,{title:e("strategy.single"),showBack:!0},y.createElement(Y,{style:{paddingBottom:0}},Ce))},Jr=function(e){return vt(`${Nt}/api/n9e/mutes`,{method:ft.Get,params:e})};const{confirm:Wr}=V,Qr=()=>{const{t:e}=E(),t=g(),a=f.exports.useRef(null),[n,l]=f.exports.useState(""),r=t=>{(function(e){return vt(`${Nt}/api/n9e/mute/${e}`,{method:ft.Delete})})(t).then((t=>{a.current.refreshList(),R.success(e("解除成功"))}))},s=[{title:e("指标名称"),width:"15%",dataIndex:"metric",render:e=>y.createElement(y.Fragment,null,y.createElement(M,{placement:"topLeft",title:e},y.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e)))},{title:e("资源标识"),width:"20%",dataIndex:"res_filters",render:e=>y.createElement(y.Fragment,null,y.createElement(M,{placement:"topLeft",title:e},y.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e)))},{title:e("标签"),width:"15%",dataIndex:"tags_filters",render:e=>y.createElement(y.Fragment,null,e?e.split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t},e):null)):"")},{title:e("屏蔽原因"),width:"15%",dataIndex:"cause",render:e=>y.createElement(y.Fragment,null,y.createElement(M,{placement:"topLeft",title:e},y.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e)))},{title:e("屏蔽时间"),width:"20%",dataIndex:"btime",render:(t,a)=>y.createElement("div",{className:"shield-time"},y.createElement("div",null,e("开始:"),Q(1e3*(null==a?void 0:a.btime)).format("YYYY-MM-DD HH:mm:ss")),y.createElement("div",null,e("结束:"),Q(1e3*(null==a?void 0:a.etime)).format("YYYY-MM-DD HH:mm:ss")))},{title:e("创建人"),width:"7%",ellipsis:!0,dataIndex:"create_by"},{title:e("操作"),width:"8%",dataIndex:"operation",render:(t,a)=>y.createElement(y.Fragment,null,y.createElement("div",{className:"table-operator-area-warning",style:{cursor:"pointer"},onClick:()=>{Wr({title:e("确定解除该告警屏蔽?"),icon:y.createElement(B,null),onOk:()=>{r(a.id)},onCancel(){}})}},e("解除")))}];return y.createElement(Ft,{title:e("告警屏蔽"),icon:y.createElement(ve,null)},y.createElement("div",{className:"shield-index"},y.createElement("div",{className:"header"},y.createElement("div",{className:"header-left"},y.createElement(F,{onPressEnter:e=>{let t=e.target.value;l(t)},className:"searchInput",prefix:y.createElement(q,null),placeholder:e("指标名称、资源标识、标签、屏蔽原因")})),y.createElement("div",{className:"header-right"},y.createElement(w,{type:"primary",className:"add",onClick:()=>{t.push("/shield/add")}},e("新建告警屏蔽")))),y.createElement(da,{ref:a,fetchParams:{query:n},fetchHandle:Jr,rowKey:"id",columns:s})))},{Option:Xr}=j,{TextArea:Zr}=F,es=/\w+=\w+/,ts=({detail:e,type:t=wl.add})=>{const{t:a}=E(),n={labelCol:{span:2},wrapperCol:{span:22}},l=be(),{currentEdit:r}=h((e=>e.event)),[s,c]=f.exports.useState([]),[m]=$.useForm(null),u=g(),[d,p]=f.exports.useState(!1);f.exports.useEffect((()=>{if(t===wl.add&&"event"===l.from&&(null==r?void 0:r.id)){const{history_points:e,res_ident:t,tags:a}=r;m.setFieldsValue({metric:e[0].metric,res_filters:t,tags_filters:""===a?[]:a.split(" ")})}}),[l.from]);const v=(e,t,n)=>{let l=m.getFieldValue("metric"),r=m.getFieldValue("res_filters"),s=m.getFieldValue("tags_filters");l||r||s?n():n(new Error(a("屏蔽标识、资源标识、屏蔽标签不能同时为空")))},x=async e=>{const{dat:t,error:a}=await Ua({metric:e});c(t.metrics)};f.exports.useEffect((()=>{x()}),[]);const k=t===wl.add?y.createElement($,o(i({form:m},n),{className:"operate-form",onFinish:e=>{p(!0);const t={metric:e.metric,res_filters:e.res_filters,tags_filters:(null==e?void 0:e.tags_filters)?e.tags_filters.join(" "):"",cause:e.cause,btime:e.time.btime,etime:e.time.etime};var n;(n=t,vt(`${Nt}/api/n9e/mutes`,{method:ft.Post,data:n})).then((e=>{R.success(a("新建告警屏蔽成功")),u.push("/shield")})).finally((()=>{p(!1)}))},onFinishFailed:()=>{p(!1)}}),y.createElement(Y,null,y.createElement($.Item,{label:a("屏蔽指标"),name:"metric",rules:[{validator:v}]},y.createElement(oe,{placeholder:a("请输入指标名称"),onSearch:Me.debounce(x,1e3)},s.map((e=>y.createElement(Xr,{key:e.name,value:e.name},e.name," ",e.description))))),y.createElement($.Item,{label:a("资源标识"),name:"res_filters",rules:[{validator:v}]},y.createElement(F,{placeholder:a("请输入资源标识的正则表达式")})),y.createElement($.Item,{label:a("屏蔽标签"),name:"tags_filters",rules:[{validator:v}]},y.createElement(j,{mode:"tags",dropdownStyle:{display:"none"},placeholder:a("请输入屏蔽标签(请用回车分割)"),onChange:e=>{const t=e[e.length-1];t&&!es.test(t)&&(e.pop(),R.error(`${a("不符合输入规范（格式为key=value）")}`))}})),y.createElement($.Item,{label:a("屏蔽时间"),name:"time"},y.createElement(hn,null)),y.createElement($.Item,{label:a("屏蔽原因"),name:"cause",rules:[{required:!0,message:a("请填写屏蔽原因")}]},y.createElement(Zr,{rows:3})),y.createElement($.Item,i({},{wrapperCol:{offset:2}}),y.createElement(J,{gutter:[10,10],align:"middle"},y.createElement(W,{span:1},y.createElement(w,{type:"primary",htmlType:"submit",loading:d},a("创建"))),y.createElement(W,{span:1,style:{marginLeft:40}},y.createElement(w,{onClick:()=>window.history.back()},a("取消"))))))):e?y.createElement($,o(i({},n),{className:"operate-form"}),y.createElement(Y,null,y.createElement($.Item,{label:a("屏蔽指标")},e.metric),y.createElement($.Item,{label:a("资源标识")},e.res_filters||y.createElement("div",null,a("暂无"))),y.createElement($.Item,{label:a("屏蔽标签")},e.tags_filters&&e.tags_filters.split(" ").map(((e,t)=>{let a=Math.random()*Dt.length,n=Dt[Math.floor(a)];return y.createElement(H,{color:n,key:t},e)}))||y.createElement("div",null,a("暂无"))),y.createElement($.Item,{label:a("屏蔽时间")},Q(1e3*e.btime).format("YYYY-MM-DD HH:mm:ss")," -"," ",Q(1e3*e.etime).format("YYYY-MM-DD HH:mm:ss")),y.createElement($.Item,{label:a("屏蔽原因")},e.cause))):y.createElement("div",null);return y.createElement("div",{className:"operate-form-index"},k)},as=()=>{const{t:e}=E();return y.createElement(Ft,{title:e("新建告警屏蔽"),showBack:!0},y.createElement(ts,null))},ns=()=>{const{t:e}=E(),t=be(),[a,n]=f.exports.useState({}),[l,r]=f.exports.useState(!1),s=async e=>{r(!0);const{dat:t,error:a}=await function(e){return vt(`${Nt}/api/n9e/mute/${e}`,{method:ft.Get})}(e);n(t),r(!1)};f.exports.useEffect((()=>{s(t.id)}),[t.id]);const i=l?y.createElement(Y,{style:{height:300,textAlign:"center",lineHeight:"300px"}},y.createElement(z,null)):y.createElement(ts,{detail:a,type:wl.edit});return y.createElement(Ft,{title:e("告警策略详情"),showBack:!0},y.createElement(Y,{style:{background:"#eee"}},i))};var ls,rs,ss,is,os,cs,ms,us;(rs=ls||(ls={}))[rs.First=1]="First",rs[rs.Second=2]="Second",rs[rs.Third=3]="Third",(is=ss||(ss={}))[is.Enable=0]="Enable",is[is.UnEnable=1]="UnEnable",(cs=os||(os={}))[cs.Alert=0]="Alert",cs[cs.Recovery=1]="Recovery",(us=ms||(ms={})).Enable="已触发",us.UnEnable="已屏蔽";const{Option:ds}=j,{confirm:ps}=V,Es=()=>{const{t:e}=E(),t=P(),a=g(),[n,l]=f.exports.useState(""),[r,s]=f.exports.useState(),[i,o]=f.exports.useState();f.exports.useRef(null);const[c,m]=f.exports.useState([]),[u,d]=f.exports.useState(1),[p,h]=f.exports.useState(15),[v,x]=f.exports.useState(0),[k,b]=f.exports.useState(!1),[C,S]=f.exports.useState(!1),[_,I]=f.exports.useState([]),[$,F]=f.exports.useState(!1),[O,T]=f.exports.useState(!1),[D,L]=f.exports.useState([]),[q,V]=f.exports.useState(!1);f.exports.useEffect((()=>{b(!0),Wn({query:n,p:u,limit:p,priority:r,status:i}).then((e=>{m(e.dat.list),x(e.dat.total),b(!1)}))}),[p,n,C,u,i,r]),f.exports.useEffect((()=>{G("none",[])}),[C,i,r,u]);const G=function(e,t=!1){switch(e){case"all":T(!1),F(!0);break;case"indeterminate":console.log("indeterminate"),T(!0),F(!1);break;case"none":T(!1),F(!1)}Array.isArray(t)&&(console.log(e,t),L(t),I(t))};return y.createElement(Ft,{icon:y.createElement(N,null),title:e("未恢复告警事件")},y.createElement("div",{className:"event-content"},y.createElement("div",{className:"event-table-search"},y.createElement("div",{className:"event-table-search-left"},y.createElement(on,{className:"event-table-search-left-refresh",onClick:()=>{S(!C)}}),y.createElement(Ot,{placeholder:e("策略名称、标签、资源分组"),onSearch:l,className:"searchInput",style:{marginRight:8}}),y.createElement(j,{placeholder:e("告警级别"),allowClear:!0,style:{width:90},onChange:e=>{s(void 0!==e?Number(e):void 0)}},y.createElement(ds,{value:ls.First},"P",ls.First),y.createElement(ds,{value:ls.Second},"P",ls.Second),y.createElement(ds,{value:ls.Third},"P",ls.Third)),y.createElement(j,{placeholder:e("告警状态"),allowClear:!0,style:{width:100},onChange:e=>{o(void 0!==e?Number(e):void 0)}},y.createElement(ds,{value:ss.Enable},e("已触发")),y.createElement(ds,{value:ss.UnEnable},e("已屏蔽")))),y.createElement("div",{className:"event-table-search-right"},y.createElement(le,{checked:$,style:{marginRight:21},onChange:function(e){if($)G("none",[]);else{let e=[];c.forEach((t=>{e.push(t.id)})),G("all",e)}},indeterminate:O}),y.createElement(w,{type:"primary",style:{width:102,textAlign:"center",paddingLeft:5,paddingRight:5},disabled:0===_.length,onClick:()=>{ps({title:e("是否批量忽略告警?"),onOk:()=>{console.log(q),q&&_.length==c.length&&(console.log("setcurrennt"),d(u-1)),Qn(_).then((()=>{R.success(e("已忽略告警")),I([]),S(!C)}))},onCancel(){}})}},e("批量忽略")))),y.createElement(z,{spinning:k},y.createElement(le.Group,{style:{width:"100%"},value:D,onChange:function(e){let t=[...e],a=t.length,n=c.length;G(0==a?"none":a==n?"all":"indeterminate",t)}},y.createElement("div",{className:"evenTable"},c.length>0?c.map(((n,l)=>y.createElement("div",{className:"table-item",key:n.id},y.createElement(J,{className:"main_info"},y.createElement(W,{span:21},y.createElement(H,{color:Lt[n.priority-1]},"P",n.priority),y.createElement(De,{type:"vertical"}),y.createElement("span",null,Q(1e3*n.trigger_time).format("YYYY-MM-DD HH:mm:ss")),y.createElement(De,{type:"vertical"}),y.createElement("span",null,n.status===ss.Enable?e("已触发"):e("已屏蔽")),y.createElement(De,{type:"vertical"}),y.createElement("a",{className:"name",onClick:()=>{t({type:"event/editItem",data:n}),a.push("/event/"+n.id)},key:l},n.rule_name),y.createElement(y.Fragment,null,n.notify_user_objs?n.notify_user_objs.map(((e,t)=>e?y.createElement("span",{key:t},y.createElement(De,{type:"vertical"}),y.createElement(Il,{text:e.nickname})):null)):"")),y.createElement(W,{span:3,className:"non-border",style:{textAlign:"right",paddingRight:10}},y.createElement(le,{value:n.id,className:"Checkbox",key:l}),y.createElement(De,{type:"vertical"}),y.createElement("a",{style:{cursor:"pointer",width:35,display:"inline-block"},onClick:()=>{t({type:"event/editItem",data:n}),a.push("/shield/add/event")}},e("屏蔽")),y.createElement(De,{type:"vertical"}),y.createElement("a",{style:{color:"red",cursor:"pointer",width:35,display:"inline-block"},onClick:()=>{ps({title:e("是否忽略告警?"),onOk:()=>{q&&1==c.length&&(console.log("setcurrennt"),d(u-1)),Qn([n.id]).then((()=>{R.success(e("已忽略告警")),S(!C)}))},onCancel(){}})}},e("忽略")))),y.createElement(J,{className:"table-item-scoure"},y.createElement(W,{span:24},y.createElement(J,{className:"item-Row"},y.createElement(W,{span:1},e("标签")," :"),y.createElement(W,{span:22},y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,n.tags?n.tags.trim().split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):""),y.createElement("div",{className:"table-item-title"},n.res_classpaths?y.createElement("span",null,e("资源分组"),":"):""),y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,n.res_classpaths?n.res_classpaths.split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):"")))))))))):y.createElement(Be,{image:Be.PRESENTED_IMAGE_SIMPLE,style:{height:135,border:"1px solid #dbdee3",padding:30}})))),c.length>0?y.createElement("div",{className:"event-Pagination"},y.createElement(Ke,{total:v,showTotal:e=>`Total ${e} items`,defaultPageSize:p,current:u,onChange:function(e,t){v<=e*t&&V(!0),L([]),I([]),d(e),h(t)}})):null))},hs=()=>{const{t:e}=E(),{id:t}=be();f.exports.useState(null);const[a,n]=f.exports.useState(),l=g();be();const[r,s]=f.exports.useState(!1);f.exports.useEffect((()=>{const e=l.location.pathname.includes("event-history");s(e),e?function(e){return vt(`${Nt}/api/n9e/history-alert-event/${e}`,{method:ft.Get})}(t).then((e=>{console.log(e),void 0!==e?e.dat&&(n(e.dat),e.dat):setTimeout((()=>{l.replace("/history-events")}),1e3)})):function(e){return vt(`${Nt}/api/n9e/alert-event/${e}`,{method:ft.Get})}(t).then((e=>{console.log(e),void 0!==e?e.dat&&(n(e.dat),e.dat):setTimeout((()=>{l.replace("/event")}),1e3)}))}),[t]);const i=[{title:e("时间"),dataIndex:"t",render:e=>y.createElement(y.Fragment,null,Q(1e3*e).format("YYYY-MM-DD HH:mm:ss"))},{title:e("值"),dataIndex:"v"}];return y.createElement(Ft,{showBack:!0,title:e("告警详情")},y.createElement("div",{className:"event-detail-content"},y.createElement("div",{className:"event-detail-content-main"},y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("基本信息"),"：")," ",a&&y.createElement(H,{color:Lt[(null==a?void 0:a.priority)-1]},"P",null==a?void 0:a.priority),y.createElement(De,{type:"vertical"}),a&&y.createElement(y.Fragment,null,Q(1e3*a.trigger_time||0).format("YYYY-MM-DD HH:mm:ss")),y.createElement(De,{type:"vertical"}),ss.Enable===(null==a?void 0:a.status)?e("已触发"):e("已屏蔽"),y.createElement(De,{type:"vertical"}),y.createElement("span",{className:xe("event-detail-content-main-active"),onClick:()=>l.push(`/strategy/edit/${null==a?void 0:a.rule_id}`)},null==a?void 0:a.rule_name,y.createElement(y.Fragment,null,a&&a.notify_user_objs?a.notify_user_objs.map(((e,t)=>e?y.createElement("span",{key:t},y.createElement(De,{type:"vertical"}),y.createElement(Il,{text:e.nickname})):null)):""))),(null==a?void 0:a.rule_note)&&y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("备注"),"：")," ",null==a?void 0:a.rule_note),y.createElement("div",null),y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("标签"),"：")," ",y.createElement(y.Fragment,null,a&&a.tags?a.tags.trim().split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):"")),(null==a?void 0:a.res_classpaths)&&y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("资源分组"),"：")," ",y.createElement(y.Fragment,null,a&&a.res_classpaths?a.res_classpaths.split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):"")),r&&void 0!==(null==a?void 0:a.runbook_url)&&y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("通知类型"),"：")," ",(null==a?void 0:a.is_recovery)===os.Alert?"告警":"恢复"),(null==a?void 0:a.readable_expression)&&y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("表达式"),"：")," ",null==a?void 0:a.readable_expression),(null==a?void 0:a.runbook_url)&&y.createElement("div",null,y.createElement("span",{className:"event-detail-content-main-label"},e("预案链接"),"：")," ",null==a?void 0:a.runbook_url),null==a?void 0:a.history_points.map(((t,n)=>{const{metric:l,tags:r}=t;let s={limit:50,metric:l,xplotline:a.trigger_time,tags:Object.keys(r).map((e=>({key:e,value:r[e]}))),range:{start:Q(1e3*a.trigger_time).subtract(1,"hour").unix(),end:Math.min(Q(1e3*a.trigger_time).add(1,"hour").unix(),Q().unix())}};return a.is_prome_pull&&(s.prome_ql=a.readable_expression),y.createElement("div",{key:n,className:"event-detail-content-main-chart-and-table"},t.metric&&y.createElement("div",null,y.createElement("span",{style:{width:"60px"}},e("现场值:")),t.metric),y.createElement(A,{columns:i,rowKey:"t",pagination:!1,dataSource:t.points||[]}),y.createElement(rn,{title:t.metric||a.readable_expression,options:s}))})))))},gs=je({scriptUrl:"/font/iconfont.js"}),vs=e=>{const{t:t}=E(),{list:a}=e;return y.createElement("div",{className:"statistics_con"},y.createElement(J,{justify:"space-around"},null==a?void 0:a.map(((e,a)=>y.createElement(W,{key:a},y.createElement(ze,{to:null==e?void 0:e.url},y.createElement(Ie,{align:"center"},y.createElement(gs,{type:null==e?void 0:e.icon,className:"statistics_icon",style:{fontSize:"48px"}}),y.createElement("div",null,y.createElement("p",{className:"name"},null==e?void 0:e.name),y.createElement("p",null,y.createElement("span",{className:"num"},null==e?void 0:e.num),y.createElement("span",{className:"unit"},t("个")))))))))))},fs=e=>[{name:e("资源总量"),id:"resource_total",num:0,icon:"icon-ziyuanzongliang",url:"/resource"},{name:e("策略总量"),id:"alert_rule_total",num:0,icon:"icon-celvezongliang",url:"/strategy"},{name:e("大盘总量"),id:"dashboard_total",num:0,icon:"icon-dapanzongliang",url:"/dashboard"},{name:e("用户总量"),id:"user_total",num:0,icon:"icon-yonghuzongliang",url:"/manage/user"},{name:e("团队总量"),id:"user_group_total",num:0,icon:"icon-tuanduizongliang",url:"/manage/group"}],ys={labelCol:{span:4},wrapperCol:{span:16}},xs=({modalVisible:e,modalData:t,editClose:a,editOk:n})=>{const{t:l}=E(),[r,s]=f.exports.useState(!0),[o,c]=f.exports.useState(!1),[m]=$.useForm();return f.exports.useEffect((()=>()=>{s(!1)}),[]),f.exports.useEffect((()=>{c(e)}),[e]),f.exports.useEffect((()=>{var e,a,n;const l=JSON.parse(JSON.stringify(t)),r=Object.assign({},{name:(null==(e=null==l?void 0:l.editData)?void 0:e.name)||"",promql:(null==(a=null==l?void 0:l.editData)?void 0:a.promql)||"",warning:(null==(n=null==l?void 0:l.editData)?void 0:n.warning)||99});m.setFieldsValue(r)}),[t]),y.createElement(V,{title:l("编辑"),centered:!0,forceRender:!0,visible:o,afterClose:function(){a()},destroyOnClose:!0,getContainer:()=>document.getElementById("overview_con")||document.body,onOk:()=>{m.validateFields().then((e=>{n({index:null==t?void 0:t.index,editData:m.getFieldsValue(!0)}),c(!1)}))},onCancel:()=>{c(!1)}},y.createElement($,i({form:m,name:"dynamic_rule"},ys),y.createElement($.Item,{name:"name",label:l("标题"),rules:[{required:!0,message:l("请输入标题")}]},y.createElement(F,{placeholder:l("请输入标题")})),y.createElement($.Item,{name:"promql",label:l("promql"),rules:[{required:!0,message:l("请输入promql")}]},y.createElement(F,{placeholder:l("请输入promql")})),y.createElement($.Item,{name:"warning",label:l("预警值"),rules:[{required:!1}]},y.createElement(he,{placeholder:l("请输入预警值")}))))},ks=localStorage.getItem("indicatorEditorUser")||"[]",bs=JSON.parse(ks).length>0?JSON.parse(ks):[{name:"cpu使用率",promql:"topk(20, max(system_cpu_util) by (ident))",warning:50},{name:"内存使用率",promql:"topk(20, max(system_mem_used_percent) by (ident))",warning:75},{name:"磁盘使用率",promql:"topk(20, max(system_disk_used_percent) by (ident))",warning:75},{name:"io使用率",promql:"topk(20, max(system_io_util) by (ident))",warning:99}],Cs=()=>{const{t:e}=E(),[t,a]=f.exports.useState(!0),[n,l]=f.exports.useState({}),[r,s]=f.exports.useState(bs),[o,c]=f.exports.useState(!1),[m,u]=f.exports.useState({}),d=[{title:"KEY",dataIndex:"metric"},{title:"VALUE",dataIndex:"value",render:(e,t)=>{const a=e>(r.find((e=>e.promql===t.promql))||{warning:99}).warning?"red":"",n=function(e){e:for(var t,a=e.length,n=1,l=-1;n<a;++n)switch(e[n]){case".":l=t=n;break;case"0":0===l&&(l=n),t=n;break;default:if(l>0){if(!+e[n])break e;l=0}}return l>0?e.slice(0,l)+e.slice(t+1):e}(Ye(".5s")(e));return{children:y.createElement("a",{className:a},n)}},fixed:"right",defaultSortOrder:"descend",sortDirections:["ascend","descend","ascend"],sorter:{compare:(e,t)=>e.value-t.value,multiple:3}}],p=async e=>{const a=await function(e={}){return vt(`${Nt}/api/n9e/instant-query`,{method:ft.Post,data:e})}({prome_ql:e.promql});if(a&&a.dat){const r=a.dat.map(((t,a)=>{const n=Object.keys(t.metric).reduce(((e,a,n,l)=>{let r=n>=l.length-1?"":",";return`${e}${a}=${t.metric[a]}${r}`}),"");return Object.assign({},{metric:n,promql:e.promql,value:t.value[t.value.length-1],key:a})}));if(t){const t=e.promql;n[t]=r;const a=i({},n);l(a)}}};return f.exports.useEffect((()=>(r.forEach((e=>{p(e)})),()=>{a(!1)})),[]),y.createElement("div",{className:"part indicator_part"},y.createElement("div",{className:"title"},e("指标TOP")),y.createElement("div",null,y.createElement(J,{justify:"space-between",gutter:18},null==r?void 0:r.map(((e,t)=>y.createElement(W,{key:t,span:6},y.createElement("div",null,y.createElement(F,{addonAfter:y.createElement(C,{onClick:()=>function(e,t){c(!0);const a=Object.assign({},{index:t,editData:e});u(a)}(e,t)}),value:null==e?void 0:e.name}),y.createElement(A,{columns:d,size:"small",dataSource:n[e.promql],pagination:!1}))))))),y.createElement(xs,{modalVisible:o,modalData:m,editClose:function(){c(!1)},editOk:function(e){if(void 0!==e.index){p(e.editData);const t=[...r];t[e.index]=e.editData,s(t),localStorage.setItem("indicatorEditorUser",JSON.stringify(t))}}}))};const{confirm:Ns}=V,Ss=e=>{const{t:t}=E(),{event_total_day:a,event_total_month:n,event_total_week:l}=e,[r,s]=f.exports.useState("");f.exports.useRef(null);const i=P(),o=g(),[c,m]=f.exports.useState([]),[u,d]=f.exports.useState(),[p,h]=f.exports.useState(1),[v,x]=f.exports.useState(15),[k,b]=f.exports.useState(0),[C,N]=f.exports.useState(!1),[S,w]=f.exports.useState(!1);let _;const[I,$]=f.exports.useState(!0);f.exports.useEffect((()=>{N(!0),Wn({query:r,p:p,limit:v,priority:u,status:status}).then((e=>{m(e.dat.list),b(e.dat.total),N(!1),console.log(e)}))}),[v,r,S,p,status,u]),f.exports.useEffect((()=>(I&&(_=setInterval((()=>{w(!S)}),6e4)),()=>{clearInterval(_)})),[]);return y.createElement("div",{className:"part event_part"},y.createElement("div",{className:"event_t"},y.createElement("span",{className:"title"},t("告警事件"))),y.createElement("div",null,y.createElement(J,{justify:"start",gutter:18},y.createElement(W,null,y.createElement("div",{className:"list day_part"},y.createElement("div",{className:"name"},t("近")," 1 ",t("day-events")),y.createElement("div",{className:"num"},a),y.createElement(gs,{className:"list_icon",type:"icon-a-1tianweihuifu"}))),y.createElement(W,null,y.createElement("div",{className:"list week_part"},y.createElement("div",{className:"name"},t("近")," 7 ",t("天未恢复的")),y.createElement("div",{className:"num"},l),y.createElement(gs,{className:"list_icon",type:"icon-a-7tianweihuifu"}))),y.createElement(W,null,y.createElement("div",{className:"list month_part"},y.createElement("div",{className:"name"},t("近")," 30 ",t("天未恢复的")),y.createElement("div",{className:"num"},n),y.createElement(gs,{className:"list_icon",type:"icon-a-30tianweihuifu"})))),y.createElement("div",{className:"refresh_con clearfix"},y.createElement(Ot,{className:"searchInput",placeholder:t("策略名称、标签、资源分组"),onSearch:s}),y.createElement(_e,{style:{marginLeft:"15px",marginRight:"15px"},defaultChecked:!0,onChange:function(e){$(e)}}),t("一分钟自动刷新"),y.createElement("span",{className:"float_r refresh_icon"},y.createElement("a",{className:"enterEventBtn",type:"primary",onClick:function(){o.push("/event")}},t("进入事件管理")))),y.createElement(z,{spinning:C},y.createElement("div",{className:"evenTable"},c.length>0?c.map(((e,a)=>y.createElement("div",{className:"table-item",key:a},y.createElement(J,{className:"main_info"},y.createElement(W,{span:21},y.createElement(H,{color:Lt[e.priority-1]},"P",e.priority),y.createElement(De,{type:"vertical"}),y.createElement("span",null,Q(1e3*e.trigger_time).format("YYYY-MM-DD HH:mm:ss")),y.createElement(De,{type:"vertical"}),y.createElement("span",null,e.status===ss.Enable?t("已触发"):t("已屏蔽")),y.createElement(De,{type:"vertical"}),y.createElement("a",{className:"name",onClick:()=>{i({type:"event/editItem",data:e}),o.push("/event/"+e.id)},key:a},e.rule_name),y.createElement(y.Fragment,null,e.notify_user_objs?e.notify_user_objs.map(((e,t)=>e?y.createElement("span",{key:t},y.createElement(De,{type:"vertical"}),y.createElement(Il,{text:e.nickname})):null)):"")),y.createElement(W,{span:3,className:"non-border",style:{textAlign:"right",paddingRight:10}},y.createElement("a",{style:{cursor:"pointer"},onClick:()=>{i({type:"event/editItem",data:e}),o.push("/shield/add/event")}},t("屏蔽")),y.createElement(De,{type:"vertical"}),y.createElement("a",{style:{color:"red",cursor:"pointer"},onClick:()=>{Ns({title:t("是否忽略告警?"),onOk:()=>{Qn([e.id]).then((()=>{R.success(t("已忽略告警")),w(!S)}))},onCancel(){}})}},t("忽略")))),y.createElement(J,{className:"table-item-scoure"},y.createElement(W,{span:24},y.createElement(J,{className:"item-Row"},y.createElement(W,{span:1},t("标签")," :"),y.createElement(W,{span:22},y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,e.tags?e.tags.trim().split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):""),y.createElement("div",{className:"table-item-title"},e.res_classpaths?y.createElement("span",null,t("资源分组"),":"):""),y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,e.res_classpaths?e.res_classpaths.split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):"")))))))))):y.createElement(Be,{image:Be.PRESENTED_IMAGE_SIMPLE,style:{height:135,border:"1px solid #dbdee3",padding:30}}))),c.length>0?y.createElement("div",{className:"event-Pagination"},y.createElement(Ke,{total:k,showTotal:e=>`Total ${e} items`,defaultPageSize:v,current:p,onChange:function(e,t){h(e),x(t)}})):null))};const ws=()=>{const[e,t]=f.exports.useState(!0),{t:a,i18n:n}=E(),[l,r]=f.exports.useState(fs(a)),[s,c]=f.exports.useState(0),[m,u]=f.exports.useState(0),[d,p]=f.exports.useState(0),h=async()=>{const t=await function(e={}){return vt(`${Nt}/api/n9e/status`,{method:ft.Get,params:e})}();if(null==t?void 0:t.dat){const n=t.dat;let l=fs(a);l.forEach(((e,t)=>{const a=o(i({},e),{num:n[e.id]});l[t]=a}));const s=[...l];e&&(r(s),c(n.event_total_day),u(n.event_total_week),p(n.event_total_month))}};return f.exports.useEffect((()=>()=>{t(!1)}),[]),f.exports.useEffect((()=>{h()}),[a]),y.createElement(Ft,null,y.createElement("div",{className:"overview_con",id:"overview_con"},y.createElement("div",{className:"part"},y.createElement("div",{className:"title"},a("统计数据")),y.createElement(vs,{list:l,spanNum:4})),y.createElement(Cs,null),y.createElement(Ss,{event_total_day:s,event_total_week:m,event_total_month:d})))},{Option:_s}=j,Is=()=>{const{t:e}=E(),t=P(),a=g(),[n,l]=f.exports.useState(""),[r,s]=f.exports.useState(),[i,o]=f.exports.useState(),[c,m]=f.exports.useState([]),[u,d]=f.exports.useState(1),[p,h]=f.exports.useState(15),[v,x]=f.exports.useState(0),[k,b]=f.exports.useState(!1),[C,S]=f.exports.useState(!1),[w,_]=f.exports.useState();f.exports.useEffect((()=>{var e;b(!0),(e={query:n,p:u,limit:p,priority:r,is_recovery:w,status:i},console.log(e),vt(`${Nt}/api/n9e/history-alert-events`,{method:ft.Get,params:e})).then((e=>{m(e.dat.list),x(e.dat.total),b(!1)}))}),[p,n,C,w,u,i,r]);return y.createElement(Ft,{icon:y.createElement(N,null),title:e("全量告警历史")},y.createElement("div",{className:"event-content"},y.createElement("div",{className:"event-table-search"},y.createElement("div",{className:"event-table-search-left"},y.createElement(on,{className:"event-table-search-left-refresh",onClick:()=>{S(!C)}}),y.createElement(Ot,{placeholder:e("策略名称、标签、资源分组"),onSearch:l,className:"searchInput",style:{marginRight:8}}),y.createElement(j,{placeholder:e("告警级别"),allowClear:!0,style:{width:90},onChange:e=>{s(void 0!==e?Number(e):void 0)}},y.createElement(_s,{value:ls.First},"P",ls.First),y.createElement(_s,{value:ls.Second},"P",ls.Second),y.createElement(_s,{value:ls.Third},"P",ls.Third)),y.createElement(j,{placeholder:e("告警状态"),allowClear:!0,style:{width:100},onChange:e=>{o(void 0!==e?Number(e):void 0)}},y.createElement(_s,{value:ss.Enable},e("已触发")),y.createElement(_s,{value:ss.UnEnable},e("已屏蔽"))),y.createElement(j,{placeholder:e("通知类型"),allowClear:!0,style:{width:100},onChange:e=>{_(void 0!==e?Number(e):void 0)}},y.createElement(_s,{value:os.Alert},e("告警")),y.createElement(_s,{value:os.Recovery},e("恢复"))))),y.createElement(z,{spinning:k},y.createElement("div",{className:"evenTable",style:{marginTop:0,paddingTop:10}},c.length>0?c.map(((n,l)=>y.createElement("div",{className:"table-item",key:n.id,style:{marginTop:0}},y.createElement(J,{className:"main_info"},y.createElement(W,{span:21},y.createElement(H,{color:Lt[n.priority-1]},"P",n.priority),y.createElement(De,{type:"vertical"}),y.createElement("span",null,Q(1e3*n.trigger_time).format("YYYY-MM-DD HH:mm:ss")),y.createElement(De,{type:"vertical"}),y.createElement("span",null,n.status===ss.Enable?e("已触发"):e("已屏蔽")),y.createElement(De,{type:"vertical"}),y.createElement("span",null,n.is_recovery===os.Alert?e("告警"):e("恢复")),y.createElement(De,{type:"vertical"}),y.createElement("a",{className:"name",onClick:()=>{t({type:"event/editItem",data:n}),a.push("/event-history/"+n.id)},key:l},n.rule_name),y.createElement(y.Fragment,null,n.notify_user_objs?n.notify_user_objs.map(((e,t)=>e?y.createElement("span",{key:t},y.createElement(De,{type:"vertical"}),y.createElement(Il,{text:e.nickname})):null)):"")),y.createElement(W,{span:3,className:"non-border",style:{textAlign:"right",paddingRight:10}},y.createElement("a",{style:{cursor:"pointer",width:35,display:"inline-block"},onClick:()=>{t({type:"event/editItem",data:n}),a.push("/shield/add/event")}},e("屏蔽")))),y.createElement(J,{className:"table-item-scoure"},y.createElement(W,{span:24},y.createElement(J,{className:"item-Row"},y.createElement(W,{span:1},e("标签")," :"),y.createElement(W,{span:22},y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,n.tags?n.tags.trim().split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):""),y.createElement("div",{className:"table-item-title"},n.res_classpaths?y.createElement("span",null,e("资源分组"),":"):""),y.createElement("div",{className:"table-item-content"},y.createElement(y.Fragment,null,n.res_classpaths?n.res_classpaths.split(" ").map(((e,t)=>e?y.createElement(Il,{text:e,key:t}):null)):"")))))))))):y.createElement(Be,{image:Be.PRESENTED_IMAGE_SIMPLE,style:{height:135,border:"1px solid #dbdee3",padding:30}}))),c.length>0?y.createElement("div",{className:"event-Pagination"},y.createElement(Ke,{total:v,showTotal:e=>`Total ${e} items`,defaultPageSize:p,current:u,onChange:function(e,t){d(e),h(t)}})):null))};function $s(){let{profile:e}=h((e=>e.account));const t=v(),a=P();return e.id||"/login"==t.pathname||t.pathname.startsWith("/chart/")||a({type:"account/getProfile"}),y.createElement("div",{className:"content"},y.createElement(Je,null,y.createElement(We,{path:"/login",component:Pt,exact:!0}),y.createElement(We,{exact:!0,path:"/overview",component:ws}),y.createElement(We,{path:"/metric/explorer",component:dn,exact:!0}),y.createElement(We,{path:"/account/profile/:tab",component:jl}),y.createElement(We,{path:"/manage/:type",component:Ir}),y.createElement(We,{path:"/dashboard/:id",component:pr}),y.createElement(We,{path:"/dashboard",component:Yl}),y.createElement(We,{path:"/chart/:ids",component:Jl}),y.createElement(We,{path:"/resource/:id?",component:hl}),y.createElement(We,{path:"/indicator",component:Or}),y.createElement(We,{path:"/history-events",component:Is}),y.createElement(We,{exact:!0,path:"/strategy/add/:group_id",component:Yr}),y.createElement(We,{exact:!0,path:"/strategy/edit/:id",component:Yr}),y.createElement(We,{exact:!0,path:"/strategy/:id?",component:Rl}),y.createElement(We,{exact:!0,path:"/shield",component:Qr}),y.createElement(We,{exact:!0,path:"/shield/add/:from?",component:as}),y.createElement(We,{exact:!0,path:"/shield/detail/:id",component:ns}),y.createElement(We,{exact:!0,path:"/event",component:Es}),y.createElement(We,{exact:!0,path:"/event/:id",component:hs}),y.createElement(We,{exact:!0,path:"/event-history/:id",component:hs}),y.createElement(We,{path:"/",exact:!0},y.createElement(Qe,{to:"/overview"}))))}const Ps="@@DVA_LOADING/SHOW",Fs="@@DVA_LOADING/HIDE";function Os(e){return()=>t=>a=>{const{type:n}=a;return function(t){if(!t||"string"!=typeof t)return!1;const[a]=t.split("/"),n=e._models.filter((e=>e.namespace===a))[0];if(n&&n.effects&&n.effects[t])return!0;return!1}(n)?new Promise(((e,n)=>{t(i({__dva_resolve:e,__dva_reject:n},a))})):t(a)}}const Ts=new class{constructor(e){this.hooks=e.reduce(((e,t)=>(e[t]=[],e)),{})}use(e){const{hooks:t}=this;for(let a in e)t[a].push(e[a])}get(e){return"extraReducers"===e?Object.assign({},...this.hooks[e]):this.hooks[e]}}(["onEffect","extraReducers"]),Ds=new class{constructor(e){this.noop=e=>{},this._models=[],this.store={},this.plugin=e}addModel(e){const t=this.prefixResolve(e);this._models.push(t)}removeModel(){}prefixResolve(e){return e.reducers&&(e.reducers=this.prefix(e.reducers,e.namespace)),e.effects&&(e.effects=this.prefix(e.effects,e.namespace)),e}prefix(e,t){return Object.keys(e).reduce(((a,n)=>(a[t+"/"+n]=e[n],a)),{})}getReducer(){let e={};for(let a of this._models)e[a.namespace]=function(e=a.state,t){let n=a.reducers[t.type];return n?n(e,t):e};let t=this.plugin.get("extraReducers");return Xe(i(i({},e),t))}getSagas(){let e=[];const t=this;for(let a of this._models)e.push((function*(){for(const e in a.effects){const n=t.getWatcher(e,a.effects[e],a,t.plugin.get("onEffect"));yield nt(n)}}));return e}prefixType(e,t){return-1===e.indexOf("/")?t.namespace+"/"+e:e}getWatcher(e,t,a,n){const l=this,r=e=>rt(o(i({},e),{type:this.prefixType(e.type,a)}));return function*(){yield Ze(e,(function*(s){if(n)for(const l of n)t=l(t,o(i({},lt),{put:r}),a,e);const{__dva_resolve:c=l.noop}=s||{};try{c(yield t(s,o(i({},lt),{put:r})))}catch(m){console.error(m)}}))}}start(){let e=this.getReducer(),t=this.getSagas(),a=et();this.store=tt(Os(this),a)(at)(e),t.forEach(a.run)}}(Ts);Ds.plugin.use(function(){let e={effects:{}};return{onEffect:function(e,{put:t},a,n){const{namespace:l}=a;return function*(...a){try{return yield t({type:Ps,payload:{namespace:l,actionType:n}}),yield e(...a)}finally{yield t({type:Fs,payload:{namespace:l,actionType:n}})}}},extraReducers:{loading(t=e,{type:a,payload:n}){let{actionType:l}=n||{};switch(a){case Ps:return{effects:o(i({},t.effects),{[l]:!0})};case Fs:return{effects:o(i({},t.effects),{[l]:!1})};default:return t}}}}}());const Ls={namespace:"resource",state:{tableData:[],pageNumber:1,group:{favorite:[],common:[],currentPage:1,commonTotal:0},currentGroup:null,prefix:Oa.UnNeed,resourceData:{resourceDetail:null,resourceDetailLoading:!1}},reducers:{saveData:(e,t)=>o(i({},e),{[t.prop]:t.data}),saveResourceGroupData:(e,{data:t})=>o(i({},e),{group:i(i({},e.group),t)}),saveResourceData:(e,{data:t})=>o(i({},e),{resourceData:i(i({},e.resourceData),t)})},effects:{*updatePrefix({data:e},{put:t}){yield t({type:"saveData",prop:"prefix",data:e})},*chooseGroupItem({data:e},{put:t,select:a}){const{currentGroup:n}=yield a((e=>e.resource));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentGroup",data:e})))},*getResourceItem({id:e},{call:t,put:a}){yield a({type:"saveResourceData",data:{resourceDetailLoading:!0}});const{success:n,dat:l}=yield t(aa,e);n&&(yield a({type:"saveResourceData",data:{resourceDetail:l}})),yield a({type:"saveResourceData",data:{resourceDetailLoading:!1}})},*getGroup({sign:e,data:t=""},{put:a,select:n,call:l}){var r,s,c;const{currentGroup:m}=yield n((e=>e.resource));if("init"===e||"refresh"===e){const[n,l]=yield Promise.all([Kt("",1),zt()]);if(n.success){const u=(null==(r=null==l?void 0:l.dat)?void 0:r.map((e=>o(i({},e),{isFavorite:!0,isBelongIn:bt.Favorite}))))||[],d=(null==(s=null==n?void 0:n.dat)?void 0:s.list.map((e=>o(i({},e),{isFavorite:!!u.find((t=>t.id===e.id)),isBelongIn:bt.Common}))))||[],p=(null==(c=null==n?void 0:n.dat)?void 0:c.total)||0;if(yield a({type:"saveResourceGroupData",data:{favorite:u,common:d,commonTotal:p,currentPage:1}}),"init"===e&&t&&""!==t){const e=d.find((e=>e.id===Number(t)));yield a({type:"saveData",prop:"currentGroup",data:e})}else if(m){const e=d.find((e=>e.id===m.id));e?yield a({type:"saveData",prop:"currentGroup",data:e}):yield a({type:"saveData",prop:"currentGroup",data:d[0]})}else yield a({type:"saveData",prop:"currentGroup",data:d[0]})}}else if("search"===e){const{group:{favorite:e}}=yield n((e=>e.resource)),{success:r,dat:s}=yield l(Kt,t);if(r){const t=(null==s?void 0:s.total)||0,n=(null==s?void 0:s.list.map((t=>o(i({},t),{isFavorite:!!e.find((e=>e.id===t.id)),isBelongIn:bt.Common}))))||[];yield a({type:"saveResourceGroupData",data:{common:n,commonTotal:t,currentPage:1}}),(m||m.id)&&e.find((e=>e.id===m.id))&&n.find((e=>e.id===m.id))||(yield a({type:"saveData",prop:"currentGroup",data:n[0]}))}}else if("append"===e){const{group:{common:e,favorite:t,currentPage:r}}=yield n((e=>e.resource)),{success:s,dat:c}=yield l(Kt,"",r+1);if(s){const n=(null==c?void 0:c.total)||0,l=(null==c?void 0:c.list.map((e=>o(i({},e),{isFavorite:!!t.find((t=>t.id===e.id)),isBelongIn:bt.Common}))))||[];yield a({type:"saveResourceGroupData",data:{common:e.concat(l),commonTotal:n,currentPage:r+1}})}}},*changeGroupFavorite({id:e,favorType:t},{put:a,call:n}){const l=t===xt.Add?Yt:Jt,{success:r}=yield n(l,e);r&&(yield a({type:"getGroup",sign:"refresh"}))},*deleteGroup({id:e},{call:t,put:a}){const{success:n}=yield t(Wt,e);n&&(yield a({type:"getGroup",sign:"refresh"}))},*updateGroup({id:e,data:t},{call:a,put:n}){const{success:l}=yield a(Qt,o(i({},t),{id:e}));l&&(yield n({type:"getGroup",sign:"refresh"}))}}},qs={namespace:"account",state:{num:0,profile:{nickname:"",role:"",roles:[],username:"",email:"",phone:"",id:0,portrait:"",contacts:{}},csrfToken:""},reducers:{SET_PROFILE:(e,t)=>o(i({},e),{profile:t.profile})},effects:{*login({username:e,password:t},{put:a,call:n,select:l}){const{dat:r,err:s}=yield n(St,e,t);yield a({type:"SET_PROFILE",profile:r});const{dat:i}=yield n(wt);return localStorage.setItem("csrfToken",i),s},*getProfile({},{put:e,call:t,select:a}){const{dat:n,err:l}=yield t(Ul);return yield e({type:"SET_PROFILE",profile:n}),l},*updateProfile({data:e},{put:t,call:a,select:n}){const{dat:l,err:r}=yield a(Ml,e);return yield t({type:"SET_PROFILE",profile:e}),r}}},Rs={namespace:"strategy",state:{group:{favorite:[],common:[],currentPage:1,commonTotal:0},currentGroup:null},reducers:{saveData:(e,t)=>o(i({},e),{[t.prop]:t.data}),saveStrategyGroupData:(e,{data:t})=>o(i({},e),{group:i(i({},e.group),t)})},effects:{*chooseGroupItem({data:e},{put:t,select:a}){const{currentGroup:n}=yield a((e=>e.strategy));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentGroup",data:e})))},*getGroup({sign:e,data:t=""},{put:a,select:n,call:l}){var r,s,c;const{currentGroup:m}=yield n((e=>e.strategy));if("init"===e||"refresh"===e){const[n,l]=yield Promise.all([Gn("",1),vt(`${Nt}/api/n9e/alert-rule-groups/favorites`,{method:ft.Get})]);if(n.success){const u=(null==(r=null==l?void 0:l.dat)?void 0:r.map((e=>o(i({},e),{isFavorite:!0,isBelongIn:bt.Favorite}))))||[],d=(null==(s=null==n?void 0:n.dat)?void 0:s.list.map((e=>o(i({},e),{isFavorite:!!u.find((t=>t.id===e.id)),isBelongIn:bt.Common}))))||[],p=(null==(c=null==n?void 0:n.dat)?void 0:c.total)||0;if(yield a({type:"saveStrategyGroupData",data:{favorite:u,common:d,commonTotal:p,currentPage:1}}),"init"===e&&t&&""!==t){const e=d.find((e=>e.id===Number(t)));yield a({type:"saveData",prop:"currentGroup",data:e})}else if(m){const e=d.find((e=>e.id===m.id));e?yield a({type:"saveData",prop:"currentGroup",data:e}):yield a({type:"saveData",prop:"currentGroup",data:d[0]})}else yield a({type:"saveData",prop:"currentGroup",data:d[0]})}}else if("search"===e){const{group:{favorite:e}}=yield n((e=>e.strategy)),{success:r,dat:s}=yield l(Gn,t);if(r){const t=(null==s?void 0:s.total)||0,n=(null==s?void 0:s.list.map((t=>o(i({},t),{isFavorite:!!e.find((e=>e.id===t.id)),isBelongIn:bt.Common}))))||[];yield a({type:"saveStrategyGroupData",data:{common:n,commonTotal:t,currentPage:1}}),(m||m.id)&&e.find((e=>e.id===m.id))&&n.find((e=>e.id===m.id))||(yield a({type:"saveData",prop:"currentGroup",data:n[0]}))}}else if("append"===e){const{group:{common:e,favorite:t,currentPage:r}}=yield n((e=>e.strategy)),{success:s,dat:c}=yield l(Gn,"",r+1);if(s){const n=(null==c?void 0:c.total)||0,l=(null==c?void 0:c.list.map((e=>o(i({},e),{isFavorite:!!t.find((t=>t.id===e.id)),isBelongIn:bt.Common}))))||[];yield a({type:"saveStrategyGroupData",data:{common:e.concat(l),commonTotal:n,currentPage:r+1}})}}},*changeGroupFavorite({id:e,favorType:t},{put:a,call:n}){const l=t===xt.Add?Bn:Kn,{success:r}=yield n(l,e);r&&(yield a({type:"getGroup",sign:"refresh"}))},*deleteGroup({id:e},{call:t,put:a}){const{success:n}=yield t(Mn,e);n&&(yield a({type:"getGroup",sign:"refresh"}))},*updateGroup({id:e,data:t},{call:a,put:n}){const{success:l}=yield a(Un,e,t);l&&(yield n({type:"getGroup",sign:"refresh"}))}}},Vs={namespace:"event",state:{currentEdit:null},reducers:{saveData:(e,t)=>o(i({},e),{[t.prop]:t.data})},effects:{*editItem({data:e},{put:t,select:a}){const{currentEdit:n}=yield a((e=>e.event));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentEdit",data:e})))}}};Ds.addModel(Ls),Ds.addModel(qs),Ds.addModel(Rs),Ds.addModel(Vs),Ds.start();var Gs=Ds.store;function As(){const{t:e,i18n:t}=E();return y.createElement("div",{className:"App"},y.createElement(st,{locale:"en"==t.language?it:ot,getPopupContainer:e=>e?e.parentNode:document.body,renderEmpty:()=>y.createElement("div",{style:{padding:20}},y.createElement("img",{src:"/image/empty.png",width:"64"}),y.createElement("div",{className:"ant-empty-description"},e("暂无数据")))},y.createElement(ct,{store:Gs},y.createElement(mt,null,y.createElement(Tt,null,y.createElement($t,null),y.createElement($s,null))))))}ut.render(y.createElement(As,null),document.getElementById("root"));
